function no(T){return T.__esModule&&Object.prototype.hasOwnProperty.call(T,"default")?T.default:T}var io={};(function(){(function(T){var b={};function f(v){if(b[v])return b[v].exports;var h=b[v]={i:v,l:!1,exports:{}};return T[v].call(h.exports,h,h.exports,f),h.l=!0,h.exports}return f.m=T,f.c=b,f.d=function(v,h,o){f.o(v,h)||Object.defineProperty(v,h,{enumerable:!0,get:o})},f.r=function(v){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(v,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(v,"__esModule",{value:!0})},f.t=function(v,h){if(h&1&&(v=f(v)),h&8||h&4&&typeof v=="object"&&v&&v.__esModule)return v;var o=Object.create(null);if(f.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:v}),h&2&&typeof v!="string")for(var r in v)f.d(o,r,(function(s){return v[s]}).bind(null,r));return o},f.n=function(v){var h=v&&v.__esModule?function(){return v.default}:function(){return v};return f.d(h,"a",h),h},f.o=function(v,h){return Object.prototype.hasOwnProperty.call(v,h)},f.p="",f(f.s=40)})([function(T,b,f){var v;v=(function(){function h(r,s){this.isUndef(r)||r===1?this.input=this.context.createGain():1<r&&(this.input=new Array(r)),this.isUndef(s)||s===1?this.output=this.context.createGain():1<s&&(this.output=new Array(r))}var o;return h.prototype.set=function(r,s,u){if(this.isObject(r))u=s;else if(this.isString(r)){var c={};c[r]=s,r=c}t:for(var p in r){s=r[p];var m=this;if(p.indexOf(".")!==-1){for(var g=p.split("."),_=0;_<g.length-1;_++)if((m=m[g[_]])instanceof h){g.splice(0,_+1);var S=g.join(".");m.set(S,s);continue t}p=g[g.length-1]}var k=m[p];this.isUndef(k)||(h.Signal&&k instanceof h.Signal||h.Param&&k instanceof h.Param?k.value!==s&&(this.isUndef(u)?k.value=s:k.rampTo(s,u)):k instanceof AudioParam?k.value!==s&&(k.value=s):k instanceof h?k.set(s):k!==s&&(m[p]=s))}return this},h.prototype.get=function(r){this.isUndef(r)?r=this._collectDefaults(this.constructor):this.isString(r)&&(r=[r]);for(var s={},u=0;u<r.length;u++){var c=r[u],p=this,m=s;if(c.indexOf(".")!==-1){for(var g=c.split("."),_=0;_<g.length-1;_++){var S=g[_];m[S]=m[S]||{},m=m[S],p=p[S]}c=g[g.length-1]}var k=p[c];this.isObject(r[c])?m[c]=k.get():h.Signal&&k instanceof h.Signal||h.Param&&k instanceof h.Param||k instanceof AudioParam?m[c]=k.value:k instanceof h?m[c]=k.get():this.isFunction(k)||this.isUndef(k)||(m[c]=k)}return s},h.prototype._collectDefaults=function(r){var s=[];if(this.isUndef(r.defaults)||(s=Object.keys(r.defaults)),!this.isUndef(r._super))for(var u=this._collectDefaults(r._super),c=0;c<u.length;c++)s.indexOf(u[c])===-1&&s.push(u[c]);return s},h.prototype.toString=function(){for(var r in h){var s=r[0].match(/^[A-Z]$/),u=h[r]===this.constructor;if(this.isFunction(h[r])&&s&&u)return r}return"Tone"},Object.defineProperty(h.prototype,"numberOfInputs",{get:function(){return this.input?this.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(h.prototype,"numberOfOutputs",{get:function(){return this.output?this.isArray(this.output)?this.output.length:1:0}}),h.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this},h.prototype.connect=function(r,s,u){return Array.isArray(this.output)?(s=this.defaultArg(s,0),this.output[s].connect(r,0,u)):this.output.connect(r,s,u),this},h.prototype.disconnect=function(r,s,u){this.isArray(this.output)?this.isNumber(r)?this.output[r].disconnect():(s=this.defaultArg(s,0),this.output[s].disconnect(r,0,u)):this.output.disconnect.apply(this.output,arguments)},h.prototype.connectSeries=function(){if(1<arguments.length)for(var r=arguments[0],s=1;s<arguments.length;s++){var u=arguments[s];r.connect(u),r=u}return this},h.prototype.chain=function(){if(0<arguments.length)for(var r=this,s=0;s<arguments.length;s++){var u=arguments[s];r.connect(u),r=u}return this},h.prototype.fan=function(){if(0<arguments.length)for(var r=0;r<arguments.length;r++)this.connect(arguments[r]);return this},AudioNode.prototype.chain=h.prototype.chain,AudioNode.prototype.fan=h.prototype.fan,h.prototype.defaultArg=function(r,s){if(this.isObject(r)&&this.isObject(s)){var u={};for(var c in r)u[c]=this.defaultArg(s[c],r[c]);for(var p in s)u[p]=this.defaultArg(r[p],s[p]);return u}return this.isUndef(r)?s:r},h.prototype.optionsObject=function(r,s,u){var c={};if(r.length===1&&this.isObject(r[0]))c=r[0];else for(var p=0;p<s.length;p++)c[s[p]]=r[p];return this.isUndef(u)?c:this.defaultArg(c,u)},h.prototype.isUndef=function(r){return r===void 0},h.prototype.isFunction=function(r){return typeof r=="function"},h.prototype.isNumber=function(r){return typeof r=="number"},h.prototype.isObject=function(r){return Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object},h.prototype.isBoolean=function(r){return typeof r=="boolean"},h.prototype.isArray=function(r){return Array.isArray(r)},h.prototype.isString=function(r){return typeof r=="string"},h.noOp=function(){},h.prototype._readOnly=function(r){if(Array.isArray(r))for(var s=0;s<r.length;s++)this._readOnly(r[s]);else Object.defineProperty(this,r,{writable:!1,enumerable:!0})},h.prototype._writable=function(r){if(Array.isArray(r))for(var s=0;s<r.length;s++)this._writable(r[s]);else Object.defineProperty(this,r,{writable:!0})},h.State={Started:"started",Stopped:"stopped",Paused:"paused"},h.prototype.equalPowerScale=function(r){var s=.5*Math.PI;return Math.sin(r*s)},h.prototype.dbToGain=function(r){return Math.pow(2,r/6)},h.prototype.gainToDb=function(r){return Math.log(r)/Math.LN10*20},h.prototype.intervalToFrequencyRatio=function(r){return Math.pow(2,r/12)},h.prototype.now=function(){return h.context.now()},h.now=function(){return h.context.now()},h.extend=function(r,s){function u(){}h.prototype.isUndef(s)&&(s=h),u.prototype=s.prototype,r.prototype=new u,(r.prototype.constructor=r)._super=s},Object.defineProperty(h,"context",{get:function(){return o},set:function(r){o=h.Context&&r instanceof h.Context?r:new h.Context(r),h.Context&&h.Context.emit("init",o)}}),Object.defineProperty(h.prototype,"context",{get:function(){return h.context}}),h.setContext=function(r){h.context=r},Object.defineProperty(h.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(h.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(h,"supported",{get:function(){var r=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),s=window.hasOwnProperty("Promise"),u=window.hasOwnProperty("Worker");return r&&s&&u}}),h.version="r10",window.TONE_SILENCE_VERSION_LOGGING||console.log("%c * Tone.js "+h.version+" * ","background: #000; color: #fff"),h}).call(b,f,b,T),v!==void 0&&(T.exports=v)},function(T,b,f){var v,h;v=[f(0),f(2),f(10)],h=(function(o){return o.Multiply=function(r){this.createInsOuts(2,0),this._mult=this.input[0]=this.output=new o.Gain,this._param=this.input[1]=this.output.gain,this._param.value=this.defaultArg(r,0)},o.extend(o.Multiply,o.Signal),o.Multiply.prototype.dispose=function(){return o.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},o.Multiply}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(6),f(9),f(18),f(10)],h=(function(o){return o.Signal=function(){var r=this.optionsObject(arguments,["value","units"],o.Signal.defaults);this.output=this._gain=this.context.createGain(),r.param=this._gain.gain,o.Param.call(this,r),this.input=this._param=this._gain.gain,this.context.getConstant(1).chain(this._gain)},o.extend(o.Signal,o.Param),o.Signal.defaults={value:0,units:o.Type.Default,convert:!0},o.Signal.prototype.connect=o.SignalBase.prototype.connect,o.Signal.prototype.dispose=function(){return o.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},o.Signal}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){(function(v){f.d(b,"b",function(){return p}),f.d(b,"c",function(){return m});var h=f(22),o=f.n(h),r=f(0),s=f.n(r),u=f(12);f.n(u),v.TONE_SILENCE_VERSION_LOGGING=!0;var c=new window.AudioContext;s.a.setContext(c);function p(){return c}function m(g,_){var S=g;return g instanceof p5.Element?S=g.elt:g instanceof Array&&g[0]instanceof p5.Element&&(S=g.map(function(k){return k.elt})),o()(c,S,_)}b.a=c}).call(this,f(26))},function(T,b,f){var v,h;v=[f(0),f(2),f(10)],h=(function(o){return o.Add=function(r){this.createInsOuts(2,0),this._sum=this.input[0]=this.input[1]=this.output=new o.Gain,this._param=this.input[1]=new o.Signal(r),this._param.connect(this._sum)},o.extend(o.Add,o.Signal),o.Add.prototype.dispose=function(){return o.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this._param.dispose(),this._param=null,this},o.Add}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b){T.exports={recorderProcessor:"recorder-processor",soundFileProcessor:"sound-file-processor",amplitudeProcessor:"amplitude-processor"}},function(T,b,f){var v,h;v=[f(0),f(15)],h=(function(o){return o.WaveShaper=function(r,s){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(r)?this.curve=r:isFinite(r)||this.isUndef(r)?this._curve=new Float32Array(this.defaultArg(r,1024)):this.isFunction(r)&&(this._curve=new Float32Array(this.defaultArg(s,1024)),this.setMap(r))},o.extend(o.WaveShaper,o.SignalBase),o.WaveShaper.prototype.setMap=function(r){for(var s=0,u=this._curve.length;s<u;s++){var c=s/(u-1)*2-1;this._curve[s]=r(c,s)}return this._shaper.curve=this._curve,this},Object.defineProperty(o.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(r){this._curve=new Float32Array(r),this._shaper.curve=this._curve}}),Object.defineProperty(o.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(r){if(["none","2x","4x"].indexOf(r)===-1)throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");this._shaper.oversample=r}}),o.WaveShaper.prototype.dispose=function(){return o.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},o.WaveShaper}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(2),f(19)],h=(function(o){return o.TimelineSignal=function(){var r=this.optionsObject(arguments,["value","units"],o.Signal.defaults);this._events=new o.Timeline(10),o.Signal.apply(this,r),r.param=this._param,o.Param.call(this,r),this._initial=this._fromUnits(this._param.value)},o.extend(o.TimelineSignal,o.Param),o.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Curve:"curve",Set:"set"},Object.defineProperty(o.TimelineSignal.prototype,"value",{get:function(){var r=this.now(),s=this.getValueAtTime(r);return this._toUnits(s)},set:function(r){var s=this._fromUnits(r);this._initial=s,this.cancelScheduledValues(),this._param.value=s}}),o.TimelineSignal.prototype.setValueAtTime=function(r,s){return r=this._fromUnits(r),s=this.toSeconds(s),this._events.add({type:o.TimelineSignal.Type.Set,value:r,time:s}),this._param.setValueAtTime(r,s),this},o.TimelineSignal.prototype.linearRampToValueAtTime=function(r,s){return r=this._fromUnits(r),s=this.toSeconds(s),this._events.add({type:o.TimelineSignal.Type.Linear,value:r,time:s}),this._param.linearRampToValueAtTime(r,s),this},o.TimelineSignal.prototype.exponentialRampToValueAtTime=function(r,s){s=this.toSeconds(s);var u=this._searchBefore(s);u&&u.value===0&&this.setValueAtTime(this._minOutput,u.time),r=this._fromUnits(r);var c=Math.max(r,this._minOutput);return this._events.add({type:o.TimelineSignal.Type.Exponential,value:c,time:s}),r<this._minOutput?(this._param.exponentialRampToValueAtTime(this._minOutput,s-this.sampleTime),this.setValueAtTime(0,s)):this._param.exponentialRampToValueAtTime(r,s),this},o.TimelineSignal.prototype.setTargetAtTime=function(r,s,u){return r=this._fromUnits(r),r=Math.max(this._minOutput,r),u=Math.max(this._minOutput,u),s=this.toSeconds(s),this._events.add({type:o.TimelineSignal.Type.Target,value:r,time:s,constant:u}),this._param.setTargetAtTime(r,s,u),this},o.TimelineSignal.prototype.setValueCurveAtTime=function(r,s,u,c){c=this.defaultArg(c,1);for(var p=new Array(r.length),m=0;m<p.length;m++)p[m]=this._fromUnits(r[m])*c;s=this.toSeconds(s),u=this.toSeconds(u),this._events.add({type:o.TimelineSignal.Type.Curve,value:p,time:s,duration:u}),this._param.setValueAtTime(p[0],s);for(var g=1;g<p.length;g++){var _=s+g/(p.length-1)*u;this._param.linearRampToValueAtTime(p[g],_)}return this},o.TimelineSignal.prototype.cancelScheduledValues=function(r){return r=this.toSeconds(r),this._events.cancel(r),this._param.cancelScheduledValues(r),this},o.TimelineSignal.prototype.setRampPoint=function(r){r=this.toSeconds(r);var s=this._toUnits(this.getValueAtTime(r)),u=this._searchBefore(r);if(u&&u.time===r)this.cancelScheduledValues(r+this.sampleTime);else if(u&&u.type===o.TimelineSignal.Type.Curve&&u.time+u.duration>r)this.cancelScheduledValues(r),this.linearRampToValueAtTime(s,r);else{var c=this._searchAfter(r);c&&(this.cancelScheduledValues(r),c.type===o.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(s,r):c.type===o.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(s,r)),this.setValueAtTime(s,r)}return this},o.TimelineSignal.prototype.linearRampToValueBetween=function(r,s,u){return this.setRampPoint(s),this.linearRampToValueAtTime(r,u),this},o.TimelineSignal.prototype.exponentialRampToValueBetween=function(r,s,u){return this.setRampPoint(s),this.exponentialRampToValueAtTime(r,u),this},o.TimelineSignal.prototype._searchBefore=function(r){return this._events.get(r)},o.TimelineSignal.prototype._searchAfter=function(r){return this._events.getAfter(r)},o.TimelineSignal.prototype.getValueAtTime=function(r){r=this.toSeconds(r);var s=this._searchAfter(r),u=this._searchBefore(r),c=this._initial;if(u===null)c=this._initial;else if(u.type===o.TimelineSignal.Type.Target){var p,m=this._events.getBefore(u.time);p=m===null?this._initial:m.value,c=this._exponentialApproach(u.time,p,u.value,u.constant,r)}else c=u.type===o.TimelineSignal.Type.Curve?this._curveInterpolate(u.time,u.value,u.duration,r):s===null?u.value:s.type===o.TimelineSignal.Type.Linear?this._linearInterpolate(u.time,u.value,s.time,s.value,r):s.type===o.TimelineSignal.Type.Exponential?this._exponentialInterpolate(u.time,u.value,s.time,s.value,r):u.value;return c},o.TimelineSignal.prototype.connect=o.SignalBase.prototype.connect,o.TimelineSignal.prototype._exponentialApproach=function(r,s,u,c,p){return u+(s-u)*Math.exp(-(p-r)/c)},o.TimelineSignal.prototype._linearInterpolate=function(r,s,u,c,p){return s+(p-r)/(u-r)*(c-s)},o.TimelineSignal.prototype._exponentialInterpolate=function(r,s,u,c,p){return(s=Math.max(this._minOutput,s))*Math.pow(c/s,(p-r)/(u-r))},o.TimelineSignal.prototype._curveInterpolate=function(r,s,u,c){var p=s.length;if(r+u<=c)return s[p-1];if(c<=r)return s[0];var m=(c-r)/u,g=Math.floor((p-1)*m),_=Math.ceil((p-1)*m),S=s[g],k=s[_];return _===g?S:this._linearInterpolate(g,S,_,k,m*(p-1))},o.TimelineSignal.prototype.dispose=function(){o.Signal.prototype.dispose.call(this),o.Param.prototype.dispose.call(this),this._events.dispose(),this._events=null},o.TimelineSignal}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(4),f(1),f(2)],h=(function(o){return o.Scale=function(r,s){this._outputMin=this.defaultArg(r,0),this._outputMax=this.defaultArg(s,1),this._scale=this.input=new o.Multiply(1),this._add=this.output=new o.Add(0),this._scale.connect(this._add),this._setRange()},o.extend(o.Scale,o.SignalBase),Object.defineProperty(o.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(r){this._outputMin=r,this._setRange()}}),Object.defineProperty(o.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(r){this._outputMax=r,this._setRange()}}),o.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},o.Scale.prototype.dispose=function(){return o.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},o.Scale}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(16),f(30),f(31),f(12)],h=(function(o){return o.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},o.prototype.toSeconds=function(r){return this.isNumber(r)?r:this.isUndef(r)?this.now():this.isString(r)?new o.Time(r).toSeconds():r instanceof o.TimeBase?r.toSeconds():void 0},o.prototype.toFrequency=function(r){return this.isNumber(r)?r:this.isString(r)||this.isUndef(r)?new o.Frequency(r).valueOf():r instanceof o.TimeBase?r.toFrequency():void 0},o.prototype.toTicks=function(r){return this.isNumber(r)||this.isString(r)?new o.TransportTime(r).toTicks():this.isUndef(r)?o.Transport.ticks:r instanceof o.TimeBase?r.toTicks():void 0},o}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(18),f(9)],h=(function(o){return window.GainNode&&!AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),o.Gain=function(){var r=this.optionsObject(arguments,["gain","units"],o.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new o.Param({param:this._gainNode.gain,units:r.units,value:r.gain,convert:r.convert}),this._readOnly("gain")},o.extend(o.Gain),o.Gain.defaults={gain:1,convert:!0},o.Gain.prototype.dispose=function(){o.Param.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},o.prototype.createInsOuts=function(r,s){r===1?this.input=new o.Gain:1<r&&(this.input=new Array(r)),s===1?this.output=new o.Gain:1<s&&(this.output=new Array(r))},o.Gain}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(7),f(39),f(14),f(12)],h=(function(o){return o.Clock=function(){o.Emitter.call(this);var r=this.optionsObject(arguments,["callback","frequency"],o.Clock.defaults);this.callback=r.callback,this._nextTick=0,this._lastState=o.State.Stopped,this.frequency=new o.TimelineSignal(r.frequency,o.Type.Frequency),this._readOnly("frequency"),this.ticks=0,this._state=new o.TimelineState(o.State.Stopped),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},o.extend(o.Clock,o.Emitter),o.Clock.defaults={callback:o.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(o.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),o.Clock.prototype.start=function(r,s){return r=this.toSeconds(r),this._state.getValueAtTime(r)!==o.State.Started&&this._state.add({state:o.State.Started,time:r,offset:s}),this},o.Clock.prototype.stop=function(r){return r=this.toSeconds(r),this._state.cancel(r),this._state.setStateAtTime(o.State.Stopped,r),this},o.Clock.prototype.pause=function(r){return r=this.toSeconds(r),this._state.getValueAtTime(r)===o.State.Started&&this._state.setStateAtTime(o.State.Paused,r),this},o.Clock.prototype._loop=function(){for(var r=this.now()+this.context.lookAhead+this.context.updateInterval+2*this.context.lag;r>this._nextTick&&this._state;){var s=this._state.getValueAtTime(this._nextTick);if(s!==this._lastState){this._lastState=s;var u=this._state.get(this._nextTick);s===o.State.Started?(this._nextTick=u.time,this.isUndef(u.offset)||(this.ticks=u.offset),this.emit("start",u.time,this.ticks)):s===o.State.Stopped?(this.ticks=0,this.emit("stop",u.time)):s===o.State.Paused&&this.emit("pause",u.time)}var c=this._nextTick;this.frequency&&(this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),s===o.State.Started&&(this.callback(c),this.ticks++))}},o.Clock.prototype.getStateAtTime=function(r){return r=this.toSeconds(r),this._state.getValueAtTime(r)},o.Clock.prototype.dispose=function(){o.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},o.Clock}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(14)],h=(function(o){function r(c,p,m){if(c.input)Array.isArray(c.input)?(o.prototype.isUndef(m)&&(m=0),this.connect(c.input[m])):this.connect(c.input,p,m);else try{c instanceof AudioNode?s.call(this,c,p,m):s.call(this,c,p)}catch(g){throw new Error("error connecting to node: "+c+`
`+g)}}var s,u;return!window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),o.Context=function(c){for(var p in o.Emitter.call(this),c=c||new window.AudioContext,this._context=c,this._context)this._defineProperty(this._context,p);this._latencyHint="interactive",this._lookAhead=.1,this._updateInterval=this._lookAhead/3,this._computedUpdateInterval=0,this._worker=this._createWorker(),this._constants={}},o.extend(o.Context,o.Emitter),o.Emitter.mixin(o.Context),o.Context.prototype._defineProperty=function(c,p){this.isUndef(this[p])&&Object.defineProperty(this,p,{get:function(){return typeof c[p]=="function"?c[p].bind(c):c[p]},set:function(m){c[p]=m}})},o.Context.prototype.now=function(){return this._context.currentTime},o.Context.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var c=new Blob(["var timeoutTime = "+(1e3*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){	timeoutTime = parseInt(msg.data);};function tick(){	setTimeout(tick, timeoutTime);	self.postMessage('tick');}tick();"]),p=URL.createObjectURL(c),m=new Worker(p);return m.addEventListener("message",(function(){this.emit("tick")}).bind(this)),m.addEventListener("message",(function(){var g=this.now();if(this.isNumber(this._lastUpdate)){var _=g-this._lastUpdate;this._computedUpdateInterval=Math.max(_,.97*this._computedUpdateInterval)}this._lastUpdate=g}).bind(this)),m},o.Context.prototype.getConstant=function(c){if(this._constants[c])return this._constants[c];for(var p=this._context.createBuffer(1,128,this._context.sampleRate),m=p.getChannelData(0),g=0;g<m.length;g++)m[g]=c;var _=this._context.createBufferSource();return _.channelCount=1,_.channelCountMode="explicit",_.buffer=p,_.loop=!0,_.start(0),this._constants[c]=_},Object.defineProperty(o.Context.prototype,"lag",{get:function(){var c=this._computedUpdateInterval-this._updateInterval;return c=Math.max(c,0)}}),Object.defineProperty(o.Context.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(c){this._lookAhead=c}}),Object.defineProperty(o.Context.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(c){this._updateInterval=Math.max(c,o.prototype.blockTime),this._worker.postMessage(Math.max(1e3*c,1))}}),Object.defineProperty(o.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(c){var p=c;if(this._latencyHint=c,this.isString(c))switch(c){case"interactive":p=.1,this._context.latencyHint=c;break;case"playback":p=.8,this._context.latencyHint=c;break;case"balanced":p=.25,this._context.latencyHint=c;break;case"fastest":p=.01}this.lookAhead=p,this.updateInterval=p/3}}),o.supported?(s=AudioNode.prototype.connect,u=AudioNode.prototype.disconnect,AudioNode.prototype.connect!==r&&(AudioNode.prototype.connect=r,AudioNode.prototype.disconnect=function(c,p,m){if(c&&c.input&&Array.isArray(c.input))o.prototype.isUndef(m)&&(m=0),this.disconnect(c.input[m],p,m);else if(c&&c.input)this.disconnect(c.input,p,m);else try{u.apply(this,arguments)}catch(g){throw new Error("error disconnecting node: "+c+`
`+g)}}),o.context=new o.Context):console.warn("This browser does not support Tone.js"),o.Context}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(4),f(20),f(2),f(10)],h=(function(o){return o.Subtract=function(r){this.createInsOuts(2,0),this._sum=this.input[0]=this.output=new o.Gain,this._neg=new o.Negate,this._param=this.input[1]=new o.Signal(r),this._param.chain(this._neg,this._sum)},o.extend(o.Subtract,o.Signal),o.Subtract.prototype.dispose=function(){return o.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},o.Subtract}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0)],h=(function(o){return o.Emitter=function(){this._events={}},o.extend(o.Emitter),o.Emitter.prototype.on=function(r,s){for(var u=r.split(/\W+/),c=0;c<u.length;c++){var p=u[c];this._events.hasOwnProperty(p)||(this._events[p]=[]),this._events[p].push(s)}return this},o.Emitter.prototype.off=function(r,s){for(var u=r.split(/\W+/),c=0;c<u.length;c++)if(r=u[c],this._events.hasOwnProperty(r))if(o.prototype.isUndef(s))this._events[r]=[];else for(var p=this._events[r],m=0;m<p.length;m++)p[m]===s&&p.splice(m,1);return this},o.Emitter.prototype.emit=function(r){if(this._events){var s=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(r))for(var u=this._events[r],c=0,p=u.length;c<p;c++)u[c].apply(this,s)}return this},o.Emitter.mixin=function(r){var s=["on","off","emit"];r._events={};for(var u=0;u<s.length;u++){var c=s[u],p=o.Emitter.prototype[c];r[c]=p}},o.Emitter.prototype.dispose=function(){return o.prototype.dispose.call(this),this._events=null,this},o.Emitter}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0)],h=(function(o){return o.SignalBase=function(){},o.extend(o.SignalBase),o.SignalBase.prototype.connect=function(r,s,u){return o.Signal&&o.Signal===r.constructor||o.Param&&o.Param===r.constructor||o.TimelineSignal&&o.TimelineSignal===r.constructor?(r._param.cancelScheduledValues(0),r._param.value=0,r.overridden=!0):r instanceof AudioParam&&(r.cancelScheduledValues(0),r.value=0),o.prototype.connect.call(this,r,s,u),this},o.SignalBase}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(17)],h=(function(o){return o.Time=function(r,s){if(!(this instanceof o.Time))return new o.Time(r,s);this._plusNow=!1,o.TimeBase.call(this,r,s)},o.extend(o.Time,o.TimeBase),o.Time.prototype._unaryExpressions=Object.create(o.TimeBase.prototype._unaryExpressions),o.Time.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(r){return o.Transport.nextSubdivision(r())}},o.Time.prototype._unaryExpressions.now={regexp:/^\+/,method:function(r){return this._plusNow=!0,r()}},o.Time.prototype.quantize=function(r,s){return s=this.defaultArg(s,1),this._expr=(function(u,c,p){return u=u(),c=c.toSeconds(),u+(Math.round(u/c)*c-u)*p}).bind(this,this._expr,new this.constructor(r),s),this},o.Time.prototype.addNow=function(){return this._plusNow=!0,this},o.Time.prototype._defaultExpr=function(){return this._plusNow=!0,this._noOp},o.Time.prototype.copy=function(r){return o.TimeBase.prototype.copy.call(this,r),this._plusNow=r._plusNow,this},o.Time.prototype.toNotation=function(){var r=this.toSeconds(),s=this._toNotationHelper(r,["1m","2n","4n","8n","16n","32n","64n","128n"]),u=this._toNotationHelper(r,["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"]);return u.split("+").length<s.split("+").length?u:s},o.Time.prototype._toNotationHelper=function(r,s){for(var u=this._notationToUnits(s[s.length-1]),c="",p=0;p<s.length;p++){var m=this._notationToUnits(s[p]),g=r/m;if(1-g%1<1e-6&&(g+=1e-6),0<(g=Math.floor(g))){if(c+=g===1?s[p]:g.toString()+"*"+s[p],(r-=g*m)<u)break;c+=" + "}}return c===""&&(c="0"),c},o.Time.prototype._notationToUnits=function(r){for(var s=this._primaryExpressions,u=[s.n,s.t,s.m],c=0;c<u.length;c++){var p=u[c],m=r.match(p.regexp);if(m)return p.method.call(this,m[1])}},o.Time.prototype.toBarsBeatsSixteenths=function(){var r=this._beatsToUnits(1),s=this.toSeconds()/r,u=Math.floor(s/this._timeSignature()),c=s%1*4;return s=Math.floor(s)%this._timeSignature(),3<(c=c.toString()).length&&(c=parseFloat(c).toFixed(3)),[u,s,c].join(":")},o.Time.prototype.toTicks=function(){var r=this._beatsToUnits(1),s=this.valueOf()/r;return Math.floor(s*o.Transport.PPQ)},o.Time.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},o.Time.prototype.toFrequency=function(){return 1/this.toSeconds()},o.Time.prototype.toSeconds=function(){return this.valueOf()},o.Time.prototype.toMilliseconds=function(){return 1e3*this.toSeconds()},o.Time.prototype.valueOf=function(){return this._expr()+(this._plusNow?this.now():0)},o.Time}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0)],h=(function(o){return o.TimeBase=function(r,s){if(!(this instanceof o.TimeBase))return new o.TimeBase(r,s);if(this._expr=this._noOp,r instanceof o.TimeBase)this.copy(r);else if(!this.isUndef(s)||this.isNumber(r)){s=this.defaultArg(s,this._defaultUnits);var u=this._primaryExpressions[s].method;this._expr=u.bind(this,r)}else this.isString(r)?this.set(r):this.isUndef(r)&&(this._expr=this._defaultExpr())},o.extend(o.TimeBase),o.TimeBase.prototype.set=function(r){return this._expr=this._parseExprString(r),this},o.TimeBase.prototype.clone=function(){var r=new this.constructor;return r.copy(this),r},o.TimeBase.prototype.copy=function(r){var s=r._expr();return this.set(s)},o.TimeBase.prototype._primaryExpressions={n:{regexp:/^(\d+)n/i,method:function(r){return(r=parseInt(r))===1?this._beatsToUnits(this._timeSignature()):this._beatsToUnits(4/r)}},t:{regexp:/^(\d+)t/i,method:function(r){return r=parseInt(r),this._beatsToUnits(8/(3*parseInt(r)))}},m:{regexp:/^(\d+)m/i,method:function(r){return this._beatsToUnits(parseInt(r)*this._timeSignature())}},i:{regexp:/^(\d+)i/i,method:function(r){return this._ticksToUnits(parseInt(r))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz/i,method:function(r){return this._frequencyToUnits(parseFloat(r))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(r,s,u){var c=0;return r&&r!=="0"&&(c+=this._beatsToUnits(this._timeSignature()*parseFloat(r))),s&&s!=="0"&&(c+=this._beatsToUnits(parseFloat(s))),u&&u!=="0"&&(c+=this._beatsToUnits(parseFloat(u)/4)),c}},s:{regexp:/^(\d+(?:\.\d+)?s)/,method:function(r){return this._secondsToUnits(parseFloat(r))}},samples:{regexp:/^(\d+)samples/,method:function(r){return parseInt(r)/this.context.sampleRate}},default:{regexp:/^(\d+(?:\.\d+)?)/,method:function(r){return this._primaryExpressions[this._defaultUnits].method.call(this,r)}}},o.TimeBase.prototype._binaryExpressions={"+":{regexp:/^\+/,precedence:2,method:function(r,s){return r()+s()}},"-":{regexp:/^\-/,precedence:2,method:function(r,s){return r()-s()}},"*":{regexp:/^\*/,precedence:1,method:function(r,s){return r()*s()}},"/":{regexp:/^\//,precedence:1,method:function(r,s){return r()/s()}}},o.TimeBase.prototype._unaryExpressions={neg:{regexp:/^\-/,method:function(r){return-r()}}},o.TimeBase.prototype._syntaxGlue={"(":{regexp:/^\(/},")":{regexp:/^\)/}},o.TimeBase.prototype._tokenize=function(r){for(var s=-1,u=[];0<r.length;){var c=p(r=r.trim(),this);u.push(c),r=r.substr(c.value.length)}function p(m,g){for(var _=["_binaryExpressions","_unaryExpressions","_primaryExpressions","_syntaxGlue"],S=0;S<_.length;S++){var k=g[_[S]];for(var O in k){var P=k[O],R=P.regexp,A=m.match(R);if(A!==null)return{method:P.method,precedence:P.precedence,regexp:P.regexp,value:A[0]}}}throw new SyntaxError("Tone.TimeBase: Unexpected token "+m)}return{next:function(){return u[++s]},peek:function(){return u[s+1]}}},o.TimeBase.prototype._matchGroup=function(r,s,u){if(!this.isUndef(r))for(var c in s){var p=s[c];if(p.regexp.test(r.value)&&(this.isUndef(u)||p.precedence===u))return p}return!1},o.TimeBase.prototype._parseBinary=function(r,s){var u;this.isUndef(s)&&(s=2),u=s<0?this._parseUnary(r):this._parseBinary(r,s-1);for(var c=r.peek();c&&this._matchGroup(c,this._binaryExpressions,s);)u=(c=r.next()).method.bind(this,u,this._parseBinary(r,s-1)),c=r.peek();return u},o.TimeBase.prototype._parseUnary=function(r){var s,u;s=r.peek();var c=this._matchGroup(s,this._unaryExpressions);return c?(s=r.next(),u=this._parseUnary(r),c.method.bind(this,u)):this._parsePrimary(r)},o.TimeBase.prototype._parsePrimary=function(r){var s,u;if(s=r.peek(),this.isUndef(s))throw new SyntaxError("Tone.TimeBase: Unexpected end of expression");if(this._matchGroup(s,this._primaryExpressions)){var c=(s=r.next()).value.match(s.regexp);return s.method.bind(this,c[1],c[2],c[3])}if(s&&s.value==="("){if(r.next(),u=this._parseBinary(r),!(s=r.next())||s.value!==")")throw new SyntaxError("Expected )");return u}throw new SyntaxError("Tone.TimeBase: Cannot process token "+s.value)},o.TimeBase.prototype._parseExprString=function(r){this.isString(r)||(r=r.toString());var s=this._tokenize(r);return this._parseBinary(s)},o.TimeBase.prototype._noOp=function(){return 0},o.TimeBase.prototype._defaultExpr=function(){return this._noOp},o.TimeBase.prototype._defaultUnits="s",o.TimeBase.prototype._frequencyToUnits=function(r){return 1/r},o.TimeBase.prototype._beatsToUnits=function(r){return 60/o.Transport.bpm.value*r},o.TimeBase.prototype._secondsToUnits=function(r){return r},o.TimeBase.prototype._ticksToUnits=function(r){return r*(this._beatsToUnits(1)/o.Transport.PPQ)},o.TimeBase.prototype._timeSignature=function(){return o.Transport.timeSignature},o.TimeBase.prototype._pushExpr=function(r,s,u){return r instanceof o.TimeBase||(r=new this.constructor(r,u)),this._expr=this._binaryExpressions[s].method.bind(this,this._expr,r._expr),this},o.TimeBase.prototype.add=function(r,s){return this._pushExpr(r,"+",s)},o.TimeBase.prototype.sub=function(r,s){return this._pushExpr(r,"-",s)},o.TimeBase.prototype.mult=function(r,s){return this._pushExpr(r,"*",s)},o.TimeBase.prototype.div=function(r,s){return this._pushExpr(r,"/",s)},o.TimeBase.prototype.valueOf=function(){return this._expr()},o.TimeBase.prototype.dispose=function(){this._expr=null},o.TimeBase}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(9)],h=(function(o){return o.Param=function(){var r=this.optionsObject(arguments,["param","units","convert"],o.Param.defaults);this._param=this.input=r.param,this.units=r.units,this.convert=r.convert,this.overridden=!1,this._lfo=null,this.isObject(r.lfo)?this.value=r.lfo:this.isUndef(r.value)||(this.value=r.value)},o.extend(o.Param),o.Param.defaults={units:o.Type.Default,convert:!0,param:void 0},Object.defineProperty(o.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(r){if(this.isObject(r)){if(this.isUndef(o.LFO))throw new Error("Include 'Tone.LFO' to use an LFO as a Param value.");this._lfo&&this._lfo.dispose(),this._lfo=new o.LFO(r).start(),this._lfo.connect(this.input)}else{var s=this._fromUnits(r);this._param.cancelScheduledValues(0),this._param.value=s}}}),o.Param.prototype._fromUnits=function(r){if(!this.convert&&!this.isUndef(this.convert))return r;switch(this.units){case o.Type.Time:return this.toSeconds(r);case o.Type.Frequency:return this.toFrequency(r);case o.Type.Decibels:return this.dbToGain(r);case o.Type.NormalRange:return Math.min(Math.max(r,0),1);case o.Type.AudioRange:return Math.min(Math.max(r,-1),1);case o.Type.Positive:return Math.max(r,0);default:return r}},o.Param.prototype._toUnits=function(r){if(!this.convert&&!this.isUndef(this.convert))return r;switch(this.units){case o.Type.Decibels:return this.gainToDb(r);default:return r}},o.Param.prototype._minOutput=1e-5,o.Param.prototype.setValueAtTime=function(r,s){return r=this._fromUnits(r),(s=this.toSeconds(s))<=this.now()+this.blockTime?this._param.value=r:this._param.setValueAtTime(r,s),this},o.Param.prototype.setRampPoint=function(r){r=this.defaultArg(r,this.now());var s=this._param.value;return s===0&&(s=this._minOutput),this._param.setValueAtTime(s,r),this},o.Param.prototype.linearRampToValueAtTime=function(r,s){return r=this._fromUnits(r),this._param.linearRampToValueAtTime(r,this.toSeconds(s)),this},o.Param.prototype.exponentialRampToValueAtTime=function(r,s){return r=this._fromUnits(r),r=Math.max(this._minOutput,r),this._param.exponentialRampToValueAtTime(r,this.toSeconds(s)),this},o.Param.prototype.exponentialRampToValue=function(r,s,u){return u=this.toSeconds(u),this.setRampPoint(u),this.exponentialRampToValueAtTime(r,u+this.toSeconds(s)),this},o.Param.prototype.linearRampToValue=function(r,s,u){return u=this.toSeconds(u),this.setRampPoint(u),this.linearRampToValueAtTime(r,u+this.toSeconds(s)),this},o.Param.prototype.setTargetAtTime=function(r,s,u){return r=this._fromUnits(r),r=Math.max(this._minOutput,r),u=Math.max(this._minOutput,u),this._param.setTargetAtTime(r,this.toSeconds(s),u),this},o.Param.prototype.setValueCurveAtTime=function(r,s,u){for(var c=0;c<r.length;c++)r[c]=this._fromUnits(r[c]);return this._param.setValueCurveAtTime(r,this.toSeconds(s),this.toSeconds(u)),this},o.Param.prototype.cancelScheduledValues=function(r){return this._param.cancelScheduledValues(this.toSeconds(r)),this},o.Param.prototype.rampTo=function(r,s,u){return s=this.defaultArg(s,0),this.units===o.Type.Frequency||this.units===o.Type.BPM||this.units===o.Type.Decibels?this.exponentialRampToValue(r,s,u):this.linearRampToValue(r,s,u),this},Object.defineProperty(o.Param.prototype,"lfo",{get:function(){return this._lfo}}),o.Param.prototype.dispose=function(){return o.prototype.dispose.call(this),this._param=null,this._lfo&&(this._lfo.dispose(),this._lfo=null),this},o.Param}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(9)],h=(function(o){return o.Timeline=function(){var r=this.optionsObject(arguments,["memory"],o.Timeline.defaults);this._timeline=[],this._toRemove=[],this._iterating=!1,this.memory=r.memory},o.extend(o.Timeline),o.Timeline.defaults={memory:1/0},Object.defineProperty(o.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),o.Timeline.prototype.add=function(r){if(this.isUndef(r.time))throw new Error("Tone.Timeline: events must have a time attribute");if(this._timeline.length){var s=this._search(r.time);this._timeline.splice(s+1,0,r)}else this._timeline.push(r);if(this.length>this.memory){var u=this.length-this.memory;this._timeline.splice(0,u)}return this},o.Timeline.prototype.remove=function(r){if(this._iterating)this._toRemove.push(r);else{var s=this._timeline.indexOf(r);s!==-1&&this._timeline.splice(s,1)}return this},o.Timeline.prototype.get=function(r){var s=this._search(r);return s!==-1?this._timeline[s]:null},o.Timeline.prototype.peek=function(){return this._timeline[0]},o.Timeline.prototype.shift=function(){return this._timeline.shift()},o.Timeline.prototype.getAfter=function(r){var s=this._search(r);return s+1<this._timeline.length?this._timeline[s+1]:null},o.Timeline.prototype.getBefore=function(r){var s=this._timeline.length;if(0<s&&this._timeline[s-1].time<r)return this._timeline[s-1];var u=this._search(r);return 0<=u-1?this._timeline[u-1]:null},o.Timeline.prototype.cancel=function(r){if(1<this._timeline.length){var s=this._search(r);if(0<=s)if(this._timeline[s].time===r){for(var u=s;0<=u&&this._timeline[u].time===r;u--)s=u;this._timeline=this._timeline.slice(0,s)}else this._timeline=this._timeline.slice(0,s+1);else this._timeline=[]}else this._timeline.length===1&&this._timeline[0].time>=r&&(this._timeline=[]);return this},o.Timeline.prototype.cancelBefore=function(r){if(this._timeline.length){var s=this._search(r);0<=s&&(this._timeline=this._timeline.slice(s+1))}return this},o.Timeline.prototype._search=function(r){var s=0,u=this._timeline.length,c=u;if(0<u&&this._timeline[u-1].time<=r)return u-1;for(;s<c;){var p=Math.floor(s+(c-s)/2),m=this._timeline[p],g=this._timeline[p+1];if(m.time===r){for(var _=p;_<this._timeline.length;_++)this._timeline[_].time===r&&(p=_);return p}if(m.time<r&&g.time>r)return p;m.time>r?c=p:m.time<r&&(s=p+1)}return-1},o.Timeline.prototype._iterate=function(r,s,u){this._iterating=!0,s=this.defaultArg(s,0),u=this.defaultArg(u,this._timeline.length-1);for(var c=s;c<=u;c++)r(this._timeline[c]);if(this._iterating=!1,0<this._toRemove.length){for(var p=0;p<this._toRemove.length;p++){var m=this._timeline.indexOf(this._toRemove[p]);m!==-1&&this._timeline.splice(m,1)}this._toRemove=[]}},o.Timeline.prototype.forEach=function(r){return this._iterate(r),this},o.Timeline.prototype.forEachBefore=function(r,s){var u=this._search(r);return u!==-1&&this._iterate(s,0,u),this},o.Timeline.prototype.forEachAfter=function(r,s){var u=this._search(r);return this._iterate(s,u+1),this},o.Timeline.prototype.forEachFrom=function(r,s){for(var u=this._search(r);0<=u&&this._timeline[u].time>=r;)u--;return this._iterate(s,u+1),this},o.Timeline.prototype.forEachAtTime=function(r,s){var u=this._search(r);return u!==-1&&this._iterate(function(c){c.time===r&&s(c)},0,u),this},o.Timeline.prototype.dispose=function(){o.prototype.dispose.call(this),this._timeline=null,this._toRemove=null},o.Timeline}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(1),f(2)],h=(function(o){return o.Negate=function(){this._multiply=this.input=this.output=new o.Multiply(-1)},o.extend(o.Negate,o.SignalBase),o.Negate.prototype.dispose=function(){return o.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},o.Negate}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(2),f(1),f(6)],h=(function(o){return o.GreaterThanZero=function(){this._thresh=this.output=new o.WaveShaper(function(r){return r<=0?0:1},127),this._scale=this.input=new o.Multiply(1e4),this._scale.connect(this._thresh)},o.extend(o.GreaterThanZero,o.SignalBase),o.GreaterThanZero.prototype.dispose=function(){return o.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},o.GreaterThanZero}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h,o;(function(r,s){h=[],v=s,o=typeof v=="function"?v.apply(b,h):v,o!==void 0&&(T.exports=o)})(this,function(){var r=function(u,c){this._dragged=!1,this._element=u,this._bindedMove=this._moved.bind(this),this._bindedEnd=this._ended.bind(this,c),u.addEventListener("touchstart",this._bindedEnd),u.addEventListener("touchmove",this._bindedMove),u.addEventListener("touchend",this._bindedEnd),u.addEventListener("mouseup",this._bindedEnd)};function s(u){return u.state==="running"}return r.prototype._moved=function(u){this._dragged=!0},r.prototype._ended=function(u){this._dragged||function(c){var p=c.createBuffer(1,1,c.sampleRate),m=c.createBufferSource();m.buffer=p,m.connect(c.destination),m.start(0),c.resume&&c.resume()}(u),this._dragged=!1},r.prototype.dispose=function(){this._element.removeEventListener("touchstart",this._bindedEnd),this._element.removeEventListener("touchmove",this._bindedMove),this._element.removeEventListener("touchend",this._bindedEnd),this._element.removeEventListener("mouseup",this._bindedEnd),this._bindedMove=null,this._bindedEnd=null,this._element=null},function(u,c,p){var m=new Promise(function(_){(function(S,k){s(S)?k():function O(){s(S)?k():(requestAnimationFrame(O),S.resume&&S.resume())}()})(u,_)}),g=[];return function _(S,k,O){if(Array.isArray(S)||NodeList&&S instanceof NodeList)for(var P=0;P<S.length;P++)_(S[P],k,O);else if(typeof S=="string")_(document.querySelectorAll(S),k,O);else if(S.jquery&&typeof S.toArray=="function")_(S.toArray(),k,O);else if(Element&&S instanceof Element){var R=new r(S,O);k.push(R)}}(c=c||document.body,g,u),m.then(function(){for(var _=0;_<g.length;_++)g[_].dispose();g=null,p&&p()}),m}})},function(T,b,f){var v,h;v=[f(0),f(2),f(32),f(38),f(10)],h=(function(o){return o.CrossFade=function(r){this.createInsOuts(2,1),this.a=this.input[0]=new o.Gain,this.b=this.input[1]=new o.Gain,this.fade=new o.Signal(this.defaultArg(r,.5),o.Type.NormalRange),this._equalPowerA=new o.EqualPowerGain,this._equalPowerB=new o.EqualPowerGain,this._invert=new o.Expr("1 - $0"),this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this.fade.chain(this._invert,this._equalPowerA,this.a.gain),this._readOnly("fade")},o.extend(o.CrossFade),o.CrossFade.prototype.dispose=function(){return o.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},o.CrossFade}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b){(function(){var f,v=[];function h(u){var c=this,p={},m=-1;this.parameters.forEach(function(S,k){var O=v[++m]||(v[m]=new Float32Array(c.bufferSize));O.fill(S.value),p[k]=O}),this.processor.realm.exec("self.sampleRate=sampleRate="+this.context.sampleRate+";self.currentTime=currentTime="+this.context.currentTime);var g=o(u.inputBuffer),_=o(u.outputBuffer);this.instance.process([g],[_],p)}function o(u){for(var c=[],p=0;p<u.numberOfChannels;p++)c[p]=u.getChannelData(p);return c}function r(u){return u.$$processors||(u.$$processors={})}function s(u){this.$$context=u}typeof AudioWorkletNode!="function"&&(self.AudioWorkletNode=function(u,c,p){var m=r(u)[c],g=u.createScriptProcessor(void 0,2,p&&p.outputChannelCount?p.outputChannelCount[0]:2);if(g.parameters=new Map,m.properties)for(var _=0;_<m.properties.length;_++){var S=m.properties[_],k=u.createGain().gain;k.value=S.defaultValue,g.parameters.set(S.name,k)}var O=new MessageChannel;f=O.port2;var P=new m.Processor(p||{});return f=null,g.port=O.port1,g.processor=m,g.instance=P,g.onaudioprocess=h,g},Object.defineProperty((self.AudioContext||self.webkitAudioContext).prototype,"audioWorklet",{get:function(){return this.$$audioWorklet||(this.$$audioWorklet=new self.AudioWorklet(this))}}),self.AudioWorklet=(s.prototype.addModule=function(u,c){var p=this;return fetch(u).then(function(m){if(!m.ok)throw Error(m.status);return m.text()}).then(function(m){var g={sampleRate:0,currentTime:0,AudioWorkletProcessor:function(){this.port=f},registerProcessor:function(S,k){r(p.$$context)[S]={realm:_,context:g,Processor:k,properties:k.parameterDescriptors||[]}}},_=new function(S,k){var O=document.createElement("iframe");O.style.cssText="position:absolute;left:0;top:-999px;width:1px;height:1px;",k.appendChild(O);var P=O.contentWindow,R=P.document,A="var window,$hook";for(var j in P)j in S||j==="eval"||(A+=",",A+=j);for(var q in S)A+=",",A+=q,A+="=self.",A+=q;var B=R.createElement("script");B.appendChild(R.createTextNode(`function $hook(self,console) {"use strict";
        `+A+";return function() {return eval(arguments[0])}}")),R.body.appendChild(B),this.exec=P.$hook(S,console)}(g.self=g,document.documentElement);return _.exec((c&&c.transpile||String)(m)),null})},s))})()},function(T,b){(function(){function u(c){c&&(c.setTargetAtTime||(c.setTargetAtTime=c.setTargetValueAtTime))}window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=window.webkitAudioContext,typeof AudioContext.prototype.createGain!="function"&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),typeof AudioContext.prototype.createDelay!="function"&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),typeof AudioContext.prototype.createScriptProcessor!="function"&&(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),typeof AudioContext.prototype.createPeriodicWave!="function"&&(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var c=this.internal_createGain();return u(c.gain),c},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(c){var p=c?this.internal_createDelay(c):this.internal_createDelay();return u(p.delayTime),p},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var c=this.internal_createBufferSource();return c.start?(c.internal_start=c.start,c.start=function(p,m,g){typeof g<"u"?c.internal_start(p||0,m,g):c.internal_start(p||0,m||0)}):c.start=function(p,m,g){m||g?this.noteGrainOn(p||0,m,g):this.noteOn(p||0)},c.stop?(c.internal_stop=c.stop,c.stop=function(p){c.internal_stop(p||0)}):c.stop=function(p){this.noteOff(p||0)},u(c.playbackRate),c},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var c=this.internal_createDynamicsCompressor();return u(c.threshold),u(c.knee),u(c.ratio),u(c.reduction),u(c.attack),u(c.release),c},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var c=this.internal_createBiquadFilter();return u(c.frequency),u(c.detune),u(c.Q),u(c.gain),c},typeof AudioContext.prototype.createOscillator!="function"&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var c=this.internal_createOscillator();return c.start?(c.internal_start=c.start,c.start=function(p){c.internal_start(p||0)}):c.start=function(p){this.noteOn(p||0)},c.stop?(c.internal_stop=c.stop,c.stop=function(p){c.internal_stop(p||0)}):c.stop=function(p){this.noteOff(p||0)},c.setPeriodicWave||(c.setPeriodicWave=c.setWaveTable),u(c.frequency),u(c.detune),c})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext)})(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var f=document.createElement("audio");p5.prototype.isSupported=function(){return!!f.canPlayType};var v=function(){return!!f.canPlayType&&f.canPlayType('audio/ogg; codecs="vorbis"')},h=function(){return!!f.canPlayType&&f.canPlayType("audio/mpeg;")},o=function(){return!!f.canPlayType&&f.canPlayType('audio/wav; codecs="1"')},r=function(){return!!f.canPlayType&&(f.canPlayType("audio/x-m4a;")||f.canPlayType("audio/aac;"))},s=function(){return!!f.canPlayType&&f.canPlayType("audio/x-aiff;")};p5.prototype.isFileSupported=function(u){switch(u.toLowerCase()){case"mp3":return h();case"wav":return o();case"ogg":return v();case"aac":case"m4a":case"mp4":return r();case"aif":case"aiff":return s();default:return!1}}},function(T,b){var f;f=function(){return this}();try{f=f||new Function("return this")()}catch{typeof window=="object"&&(f=window)}T.exports=f},function(T,b,f){f.r(b),b.default=`function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }

function isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function _construct(Parent, args, Class) { if (isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }

function _isNativeFunction(fn) { return Function.toString.call(fn).indexOf("[native code]") !== -1; }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

// import dependencies via preval.require so that they're available as values at compile time
var processorNames = {
  "recorderProcessor": "recorder-processor",
  "soundFileProcessor": "sound-file-processor",
  "amplitudeProcessor": "amplitude-processor"
};
var RingBuffer = {
  "default":
  /*#__PURE__*/
  function () {
    /**
     * @constructor
     * @param  {number} length Buffer length in frames.
     * @param  {number} channelCount Buffer channel count.
     */
    function RingBuffer(length, channelCount) {
      _classCallCheck(this, RingBuffer);

      this._readIndex = 0;
      this._writeIndex = 0;
      this._framesAvailable = 0;
      this._channelCount = channelCount;
      this._length = length;
      this._channelData = [];

      for (var i = 0; i < this._channelCount; ++i) {
        this._channelData[i] = new Float32Array(length);
      }
    }
    /**
     * Getter for Available frames in buffer.
     *
     * @return {number} Available frames in buffer.
     */


    _createClass(RingBuffer, [{
      key: "push",

      /**
       * Push a sequence of Float32Arrays to buffer.
       *
       * @param  {array} arraySequence A sequence of Float32Arrays.
       */
      value: function push(arraySequence) {
        // The channel count of arraySequence and the length of each channel must
        // match with this buffer obejct.
        // Transfer data from the |arraySequence| storage to the internal buffer.
        var sourceLength = arraySequence[0] ? arraySequence[0].length : 0;

        for (var i = 0; i < sourceLength; ++i) {
          var writeIndex = (this._writeIndex + i) % this._length;

          for (var channel = 0; channel < this._channelCount; ++channel) {
            this._channelData[channel][writeIndex] = arraySequence[channel][i];
          }
        }

        this._writeIndex += sourceLength;

        if (this._writeIndex >= this._length) {
          this._writeIndex = 0;
        } // For excessive frames, the buffer will be overwritten.


        this._framesAvailable += sourceLength;

        if (this._framesAvailable > this._length) {
          this._framesAvailable = this._length;
        }
      }
      /**
       * Pull data out of buffer and fill a given sequence of Float32Arrays.
       *
       * @param  {array} arraySequence An array of Float32Arrays.
       */

    }, {
      key: "pull",
      value: function pull(arraySequence) {
        // The channel count of arraySequence and the length of each channel must
        // match with this buffer obejct.
        // If the FIFO is completely empty, do nothing.
        if (this._framesAvailable === 0) {
          return;
        }

        var destinationLength = arraySequence[0].length; // Transfer data from the internal buffer to the |arraySequence| storage.

        for (var i = 0; i < destinationLength; ++i) {
          var readIndex = (this._readIndex + i) % this._length;

          for (var channel = 0; channel < this._channelCount; ++channel) {
            arraySequence[channel][i] = this._channelData[channel][readIndex];
          }
        }

        this._readIndex += destinationLength;

        if (this._readIndex >= this._length) {
          this._readIndex = 0;
        }

        this._framesAvailable -= destinationLength;

        if (this._framesAvailable < 0) {
          this._framesAvailable = 0;
        }
      }
    }, {
      key: "framesAvailable",
      get: function get() {
        return this._framesAvailable;
      }
    }]);

    return RingBuffer;
  }()
}["default"];

var RecorderProcessor =
/*#__PURE__*/
function (_AudioWorkletProcesso) {
  _inherits(RecorderProcessor, _AudioWorkletProcesso);

  function RecorderProcessor(options) {
    var _this;

    _classCallCheck(this, RecorderProcessor);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(RecorderProcessor).call(this));
    var processorOptions = options.processorOptions || {};
    _this.numOutputChannels = options.outputChannelCount || 2;
    _this.numInputChannels = processorOptions.numInputChannels || 2;
    _this.bufferSize = processorOptions.bufferSize || 1024;
    _this.recording = false;

    _this.clear();

    _this.port.onmessage = function (event) {
      var data = event.data;

      if (data.name === 'start') {
        _this.record(data.duration);
      } else if (data.name === 'stop') {
        _this.stop();
      }
    };

    return _this;
  }

  _createClass(RecorderProcessor, [{
    key: "process",
    value: function process(inputs) {
      if (!this.recording) {
        return true;
      } else if (this.sampleLimit && this.recordedSamples >= this.sampleLimit) {
        this.stop();
        return true;
      }

      var input = inputs[0];
      this.inputRingBuffer.push(input);

      if (this.inputRingBuffer.framesAvailable >= this.bufferSize) {
        this.inputRingBuffer.pull(this.inputRingBufferArraySequence);

        for (var channel = 0; channel < this.numOutputChannels; ++channel) {
          var inputChannelCopy = this.inputRingBufferArraySequence[channel].slice();

          if (channel === 0) {
            this.leftBuffers.push(inputChannelCopy);

            if (this.numInputChannels === 1) {
              this.rightBuffers.push(inputChannelCopy);
            }
          } else if (channel === 1 && this.numInputChannels > 1) {
            this.rightBuffers.push(inputChannelCopy);
          }
        }

        this.recordedSamples += this.bufferSize;
      }

      return true;
    }
  }, {
    key: "record",
    value: function record(duration) {
      if (duration) {
        this.sampleLimit = Math.round(duration * sampleRate);
      }

      this.recording = true;
    }
  }, {
    key: "stop",
    value: function stop() {
      this.recording = false;
      var buffers = this.getBuffers();
      var leftBuffer = buffers[0].buffer;
      var rightBuffer = buffers[1].buffer;
      this.port.postMessage({
        name: 'buffers',
        leftBuffer: leftBuffer,
        rightBuffer: rightBuffer
      }, [leftBuffer, rightBuffer]);
      this.clear();
    }
  }, {
    key: "getBuffers",
    value: function getBuffers() {
      var buffers = [];
      buffers.push(this.mergeBuffers(this.leftBuffers));
      buffers.push(this.mergeBuffers(this.rightBuffers));
      return buffers;
    }
  }, {
    key: "mergeBuffers",
    value: function mergeBuffers(channelBuffer) {
      var result = new Float32Array(this.recordedSamples);
      var offset = 0;
      var lng = channelBuffer.length;

      for (var i = 0; i < lng; i++) {
        var buffer = channelBuffer[i];
        result.set(buffer, offset);
        offset += buffer.length;
      }

      return result;
    }
  }, {
    key: "clear",
    value: function clear() {
      var _this2 = this;

      this.leftBuffers = [];
      this.rightBuffers = [];
      this.inputRingBuffer = new RingBuffer(this.bufferSize, this.numInputChannels);
      this.inputRingBufferArraySequence = new Array(this.numInputChannels).fill(null).map(function () {
        return new Float32Array(_this2.bufferSize);
      });
      this.recordedSamples = 0;
      this.sampleLimit = null;
    }
  }]);

  return RecorderProcessor;
}(_wrapNativeSuper(AudioWorkletProcessor));

registerProcessor(processorNames.recorderProcessor, RecorderProcessor);`},function(T,b,f){f.r(b),b.default=`function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }

function isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function _construct(Parent, args, Class) { if (isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }

function _isNativeFunction(fn) { return Function.toString.call(fn).indexOf("[native code]") !== -1; }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

// import dependencies via preval.require so that they're available as values at compile time
var processorNames = {
  "recorderProcessor": "recorder-processor",
  "soundFileProcessor": "sound-file-processor",
  "amplitudeProcessor": "amplitude-processor"
};
var RingBuffer = {
  "default":
  /*#__PURE__*/
  function () {
    /**
     * @constructor
     * @param  {number} length Buffer length in frames.
     * @param  {number} channelCount Buffer channel count.
     */
    function RingBuffer(length, channelCount) {
      _classCallCheck(this, RingBuffer);

      this._readIndex = 0;
      this._writeIndex = 0;
      this._framesAvailable = 0;
      this._channelCount = channelCount;
      this._length = length;
      this._channelData = [];

      for (var i = 0; i < this._channelCount; ++i) {
        this._channelData[i] = new Float32Array(length);
      }
    }
    /**
     * Getter for Available frames in buffer.
     *
     * @return {number} Available frames in buffer.
     */


    _createClass(RingBuffer, [{
      key: "push",

      /**
       * Push a sequence of Float32Arrays to buffer.
       *
       * @param  {array} arraySequence A sequence of Float32Arrays.
       */
      value: function push(arraySequence) {
        // The channel count of arraySequence and the length of each channel must
        // match with this buffer obejct.
        // Transfer data from the |arraySequence| storage to the internal buffer.
        var sourceLength = arraySequence[0] ? arraySequence[0].length : 0;

        for (var i = 0; i < sourceLength; ++i) {
          var writeIndex = (this._writeIndex + i) % this._length;

          for (var channel = 0; channel < this._channelCount; ++channel) {
            this._channelData[channel][writeIndex] = arraySequence[channel][i];
          }
        }

        this._writeIndex += sourceLength;

        if (this._writeIndex >= this._length) {
          this._writeIndex = 0;
        } // For excessive frames, the buffer will be overwritten.


        this._framesAvailable += sourceLength;

        if (this._framesAvailable > this._length) {
          this._framesAvailable = this._length;
        }
      }
      /**
       * Pull data out of buffer and fill a given sequence of Float32Arrays.
       *
       * @param  {array} arraySequence An array of Float32Arrays.
       */

    }, {
      key: "pull",
      value: function pull(arraySequence) {
        // The channel count of arraySequence and the length of each channel must
        // match with this buffer obejct.
        // If the FIFO is completely empty, do nothing.
        if (this._framesAvailable === 0) {
          return;
        }

        var destinationLength = arraySequence[0].length; // Transfer data from the internal buffer to the |arraySequence| storage.

        for (var i = 0; i < destinationLength; ++i) {
          var readIndex = (this._readIndex + i) % this._length;

          for (var channel = 0; channel < this._channelCount; ++channel) {
            arraySequence[channel][i] = this._channelData[channel][readIndex];
          }
        }

        this._readIndex += destinationLength;

        if (this._readIndex >= this._length) {
          this._readIndex = 0;
        }

        this._framesAvailable -= destinationLength;

        if (this._framesAvailable < 0) {
          this._framesAvailable = 0;
        }
      }
    }, {
      key: "framesAvailable",
      get: function get() {
        return this._framesAvailable;
      }
    }]);

    return RingBuffer;
  }()
}["default"];

var SoundFileProcessor =
/*#__PURE__*/
function (_AudioWorkletProcesso) {
  _inherits(SoundFileProcessor, _AudioWorkletProcesso);

  function SoundFileProcessor(options) {
    var _this;

    _classCallCheck(this, SoundFileProcessor);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(SoundFileProcessor).call(this));
    var processorOptions = options.processorOptions || {};
    _this.bufferSize = processorOptions.bufferSize || 256;
    _this.inputRingBuffer = new RingBuffer(_this.bufferSize, 1);
    _this.inputRingBufferArraySequence = [new Float32Array(_this.bufferSize)];
    return _this;
  }

  _createClass(SoundFileProcessor, [{
    key: "process",
    value: function process(inputs) {
      var input = inputs[0]; // we only care about the first input channel, because that contains the position data

      this.inputRingBuffer.push([input[0]]);

      if (this.inputRingBuffer.framesAvailable >= this.bufferSize) {
        this.inputRingBuffer.pull(this.inputRingBufferArraySequence);
        var inputChannel = this.inputRingBufferArraySequence[0];
        var position = inputChannel[inputChannel.length - 1] || 0;
        this.port.postMessage({
          name: 'position',
          position: position
        });
      }

      return true;
    }
  }]);

  return SoundFileProcessor;
}(_wrapNativeSuper(AudioWorkletProcessor));

registerProcessor(processorNames.soundFileProcessor, SoundFileProcessor);`},function(T,b,f){f.r(b),b.default=`function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }

function isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function _construct(Parent, args, Class) { if (isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }

function _isNativeFunction(fn) { return Function.toString.call(fn).indexOf("[native code]") !== -1; }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

// import dependencies via preval.require so that they're available as values at compile time
var processorNames = {
  "recorderProcessor": "recorder-processor",
  "soundFileProcessor": "sound-file-processor",
  "amplitudeProcessor": "amplitude-processor"
};
var RingBuffer = {
  "default":
  /*#__PURE__*/
  function () {
    /**
     * @constructor
     * @param  {number} length Buffer length in frames.
     * @param  {number} channelCount Buffer channel count.
     */
    function RingBuffer(length, channelCount) {
      _classCallCheck(this, RingBuffer);

      this._readIndex = 0;
      this._writeIndex = 0;
      this._framesAvailable = 0;
      this._channelCount = channelCount;
      this._length = length;
      this._channelData = [];

      for (var i = 0; i < this._channelCount; ++i) {
        this._channelData[i] = new Float32Array(length);
      }
    }
    /**
     * Getter for Available frames in buffer.
     *
     * @return {number} Available frames in buffer.
     */


    _createClass(RingBuffer, [{
      key: "push",

      /**
       * Push a sequence of Float32Arrays to buffer.
       *
       * @param  {array} arraySequence A sequence of Float32Arrays.
       */
      value: function push(arraySequence) {
        // The channel count of arraySequence and the length of each channel must
        // match with this buffer obejct.
        // Transfer data from the |arraySequence| storage to the internal buffer.
        var sourceLength = arraySequence[0] ? arraySequence[0].length : 0;

        for (var i = 0; i < sourceLength; ++i) {
          var writeIndex = (this._writeIndex + i) % this._length;

          for (var channel = 0; channel < this._channelCount; ++channel) {
            this._channelData[channel][writeIndex] = arraySequence[channel][i];
          }
        }

        this._writeIndex += sourceLength;

        if (this._writeIndex >= this._length) {
          this._writeIndex = 0;
        } // For excessive frames, the buffer will be overwritten.


        this._framesAvailable += sourceLength;

        if (this._framesAvailable > this._length) {
          this._framesAvailable = this._length;
        }
      }
      /**
       * Pull data out of buffer and fill a given sequence of Float32Arrays.
       *
       * @param  {array} arraySequence An array of Float32Arrays.
       */

    }, {
      key: "pull",
      value: function pull(arraySequence) {
        // The channel count of arraySequence and the length of each channel must
        // match with this buffer obejct.
        // If the FIFO is completely empty, do nothing.
        if (this._framesAvailable === 0) {
          return;
        }

        var destinationLength = arraySequence[0].length; // Transfer data from the internal buffer to the |arraySequence| storage.

        for (var i = 0; i < destinationLength; ++i) {
          var readIndex = (this._readIndex + i) % this._length;

          for (var channel = 0; channel < this._channelCount; ++channel) {
            arraySequence[channel][i] = this._channelData[channel][readIndex];
          }
        }

        this._readIndex += destinationLength;

        if (this._readIndex >= this._length) {
          this._readIndex = 0;
        }

        this._framesAvailable -= destinationLength;

        if (this._framesAvailable < 0) {
          this._framesAvailable = 0;
        }
      }
    }, {
      key: "framesAvailable",
      get: function get() {
        return this._framesAvailable;
      }
    }]);

    return RingBuffer;
  }()
}["default"];

var AmplitudeProcessor =
/*#__PURE__*/
function (_AudioWorkletProcesso) {
  _inherits(AmplitudeProcessor, _AudioWorkletProcesso);

  function AmplitudeProcessor(options) {
    var _this;

    _classCallCheck(this, AmplitudeProcessor);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(AmplitudeProcessor).call(this));
    var processorOptions = options.processorOptions || {};
    _this.numOutputChannels = options.outputChannelCount || 1;
    _this.numInputChannels = processorOptions.numInputChannels || 2;
    _this.normalize = processorOptions.normalize || false;
    _this.smoothing = processorOptions.smoothing || 0;
    _this.bufferSize = processorOptions.bufferSize || 2048;
    _this.inputRingBuffer = new RingBuffer(_this.bufferSize, _this.numInputChannels);
    _this.outputRingBuffer = new RingBuffer(_this.bufferSize, _this.numOutputChannels);
    _this.inputRingBufferArraySequence = new Array(_this.numInputChannels).fill(null).map(function () {
      return new Float32Array(_this.bufferSize);
    });
    _this.stereoVol = [0, 0];
    _this.stereoVolNorm = [0, 0];
    _this.volMax = 0.001;

    _this.port.onmessage = function (event) {
      var data = event.data;

      if (data.name === 'toggleNormalize') {
        _this.normalize = data.normalize;
      } else if (data.name === 'smoothing') {
        _this.smoothing = Math.max(0, Math.min(1, data.smoothing));
      }
    };

    return _this;
  } // TO DO make this stereo / dependent on # of audio channels


  _createClass(AmplitudeProcessor, [{
    key: "process",
    value: function process(inputs, outputs) {
      var input = inputs[0];
      var output = outputs[0];
      var smoothing = this.smoothing;
      this.inputRingBuffer.push(input);

      if (this.inputRingBuffer.framesAvailable >= this.bufferSize) {
        this.inputRingBuffer.pull(this.inputRingBufferArraySequence);

        for (var channel = 0; channel < this.numInputChannels; ++channel) {
          var inputBuffer = this.inputRingBufferArraySequence[channel];
          var bufLength = inputBuffer.length;
          var sum = 0;

          for (var i = 0; i < bufLength; i++) {
            var x = inputBuffer[i];

            if (this.normalize) {
              sum += Math.max(Math.min(x / this.volMax, 1), -1) * Math.max(Math.min(x / this.volMax, 1), -1);
            } else {
              sum += x * x;
            }
          } // ... then take the square root of the sum.


          var rms = Math.sqrt(sum / bufLength);
          this.stereoVol[channel] = Math.max(rms, this.stereoVol[channel] * smoothing);
          this.volMax = Math.max(this.stereoVol[channel], this.volMax);
        } // calculate stero normalized volume and add volume from all channels together


        var volSum = 0;

        for (var index = 0; index < this.stereoVol.length; index++) {
          this.stereoVolNorm[index] = Math.max(Math.min(this.stereoVol[index] / this.volMax, 1), 0);
          volSum += this.stereoVol[index];
        } // volume is average of channels


        var volume = volSum / this.stereoVol.length; // normalized value

        var volNorm = Math.max(Math.min(volume / this.volMax, 1), 0);
        this.port.postMessage({
          name: 'amplitude',
          volume: volume,
          volNorm: volNorm,
          stereoVol: this.stereoVol,
          stereoVolNorm: this.stereoVolNorm
        }); // pass input through to output

        this.outputRingBuffer.push(this.inputRingBufferArraySequence);
      } // pull 128 frames out of the ring buffer
      // if the ring buffer does not have enough frames, the output will be silent


      this.outputRingBuffer.pull(output);
      return true;
    }
  }]);

  return AmplitudeProcessor;
}(_wrapNativeSuper(AudioWorkletProcessor));

registerProcessor(processorNames.amplitudeProcessor, AmplitudeProcessor);`},function(T,b,f){var v,h;v=[f(0),f(17)],h=(function(o){o.Frequency=function(u,c){if(!(this instanceof o.Frequency))return new o.Frequency(u,c);o.TimeBase.call(this,u,c)},o.extend(o.Frequency,o.TimeBase),o.Frequency.prototype._primaryExpressions=Object.create(o.TimeBase.prototype._primaryExpressions),o.Frequency.prototype._primaryExpressions.midi={regexp:/^(\d+(?:\.\d+)?midi)/,method:function(u){return this.midiToFrequency(u)}},o.Frequency.prototype._primaryExpressions.note={regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(u,c){var p=r[u.toLowerCase()]+12*(parseInt(c)+1);return this.midiToFrequency(p)}},o.Frequency.prototype._primaryExpressions.tr={regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(u,c,p){var m=1;return u&&u!=="0"&&(m*=this._beatsToUnits(this._timeSignature()*parseFloat(u))),c&&c!=="0"&&(m*=this._beatsToUnits(parseFloat(c))),p&&p!=="0"&&(m*=this._beatsToUnits(parseFloat(p)/4)),m}},o.Frequency.prototype.transpose=function(u){return this._expr=(function(c,p){return c()*this.intervalToFrequencyRatio(p)}).bind(this,this._expr,u),this},o.Frequency.prototype.harmonize=function(u){return this._expr=(function(c,p){for(var m=c(),g=[],_=0;_<p.length;_++)g[_]=m*this.intervalToFrequencyRatio(p[_]);return g}).bind(this,this._expr,u),this},o.Frequency.prototype.toMidi=function(){return this.frequencyToMidi(this.valueOf())},o.Frequency.prototype.toNote=function(){var u=this.valueOf(),c=Math.log(u/o.Frequency.A4)/Math.LN2,p=Math.round(12*c)+57,m=Math.floor(p/12);return m<0&&(p+=-12*m),s[p%12]+m.toString()},o.Frequency.prototype.toSeconds=function(){return 1/this.valueOf()},o.Frequency.prototype.toFrequency=function(){return this.valueOf()},o.Frequency.prototype.toTicks=function(){var u=this._beatsToUnits(1),c=this.valueOf()/u;return Math.floor(c*o.Transport.PPQ)},o.Frequency.prototype._frequencyToUnits=function(u){return u},o.Frequency.prototype._ticksToUnits=function(u){return 1/(60*u/(o.Transport.bpm.value*o.Transport.PPQ))},o.Frequency.prototype._beatsToUnits=function(u){return 1/o.TimeBase.prototype._beatsToUnits.call(this,u)},o.Frequency.prototype._secondsToUnits=function(u){return 1/u},o.Frequency.prototype._defaultUnits="hz";var r={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return o.Frequency.A4=440,o.Frequency.prototype.midiToFrequency=function(u){return o.Frequency.A4*Math.pow(2,(u-69)/12)},o.Frequency.prototype.frequencyToMidi=function(u){return 69+12*Math.log(u/o.Frequency.A4)/Math.LN2},o.Frequency}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(16)],h=(function(o){return o.TransportTime=function(r,s){if(!(this instanceof o.TransportTime))return new o.TransportTime(r,s);o.Time.call(this,r,s)},o.extend(o.TransportTime,o.Time),o.TransportTime.prototype._unaryExpressions=Object.create(o.Time.prototype._unaryExpressions),o.TransportTime.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(r){var s=this._secondsToTicks(r()),u=Math.ceil(o.Transport.ticks/s);return this._ticksToUnits(u*s)}},o.TransportTime.prototype._secondsToTicks=function(r){var s=r/this._beatsToUnits(1);return Math.round(s*o.Transport.PPQ)},o.TransportTime.prototype.valueOf=function(){return this._secondsToTicks(this._expr())+(this._plusNow?o.Transport.ticks:0)},o.TransportTime.prototype.toTicks=function(){return this.valueOf()},o.TransportTime.prototype.toSeconds=function(){return this._expr()+(this._plusNow?o.Transport.seconds:0)},o.TransportTime.prototype.toFrequency=function(){return 1/this.toSeconds()},o.TransportTime}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(4),f(13),f(1),f(33),f(21),f(34),f(20),f(35),f(36),f(37)],h=(function(o){function r(p,m,g){var _=new p;return g._eval(m[0]).connect(_,0,0),g._eval(m[1]).connect(_,0,1),_}function s(p,m,g){var _=new p;return g._eval(m[0]).connect(_,0,0),_}function u(p){return p?parseFloat(p):void 0}function c(p){return p&&p.args?parseFloat(p.args):void 0}return o.Expr=function(){var p=this._replacements(Array.prototype.slice.call(arguments)),m=this._parseInputs(p);this._nodes=[],this.input=new Array(m);for(var g=0;g<m;g++)this.input[g]=this.context.createGain();var _,S=this._parseTree(p);try{_=this._eval(S)}catch{throw this._disposeNodes(),new Error("Tone.Expr: Could evaluate expression: "+p)}this.output=_},o.extend(o.Expr,o.SignalBase),o.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(p){return new o.Signal(u(p))}},input:{regexp:/^\$\d/,method:function(p,m){return m.input[u(p.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:s.bind(this,o.Abs)},mod:{regexp:/^mod/,method:function(p,m){var g=c(p[1]),_=new o.Modulo(g);return m._eval(p[0]).connect(_),_}},pow:{regexp:/^pow/,method:function(p,m){var g=c(p[1]),_=new o.Pow(g);return m._eval(p[0]).connect(_),_}},a2g:{regexp:/^a2g/,method:function(p,m){var g=new o.AudioToGain;return m._eval(p[0]).connect(g),g}}},binary:{"+":{regexp:/^\+/,precedence:1,method:r.bind(this,o.Add)},"-":{regexp:/^\-/,precedence:1,method:function(p,m){return p.length===1?s(o.Negate,p,m):r(o.Subtract,p,m)}},"*":{regexp:/^\*/,precedence:0,method:r.bind(this,o.Multiply)}},unary:{"-":{regexp:/^\-/,method:s.bind(this,o.Negate)},"!":{regexp:/^\!/,method:s.bind(this,o.NOT)}}},o.Expr.prototype._parseInputs=function(p){var m=p.match(/\$\d/g),g=0;if(m!==null)for(var _=0;_<m.length;_++){var S=parseInt(m[_].substr(1))+1;g=Math.max(g,S)}return g},o.Expr.prototype._replacements=function(p){for(var m=p.shift(),g=0;g<p.length;g++)m=m.replace(/\%/i,p[g]);return m},o.Expr.prototype._tokenize=function(p){for(var m=-1,g=[];0<p.length;){var _=S(p=p.trim());g.push(_),p=p.substr(_.value.length)}function S(k){for(var O in o.Expr._Expressions){var P=o.Expr._Expressions[O];for(var R in P){var A=P[R],j=A.regexp,q=k.match(j);if(q!==null)return{type:O,value:q[0],method:A.method}}}throw new SyntaxError("Tone.Expr: Unexpected token "+k)}return{next:function(){return g[++m]},peek:function(){return g[m+1]}}},o.Expr.prototype._parseTree=function(p){var m=this._tokenize(p),g=this.isUndef.bind(this);function _(P,R){return!g(P)&&P.type==="glue"&&P.value===R}function S(P,R,A){var j=o.Expr._Expressions[R];if(!g(P))for(var q in j){var B=j[q];if(B.regexp.test(P.value)&&(g(A)||B.precedence===A))return!0}return!1}function k(P){var R;g(P)&&(P=5),R=P<0?function j(){var q,B;return q=m.peek(),S(q,"unary")?(q=m.next(),B=j(),{operator:q.value,method:q.method,args:[B]}):O()}():k(P-1);for(var A=m.peek();S(A,"binary",P);)R={operator:(A=m.next()).value,method:A.method,args:[R,k(P-1)]},A=m.peek();return R}function O(){var P,R;if(P=m.peek(),g(P))throw new SyntaxError("Tone.Expr: Unexpected termination of expression");if(P.type==="func")return function(A){var j=[];if(!_(m.next(),"("))throw new SyntaxError('Tone.Expr: Expected ( in a function call "'+A.value+'"');if(_(m.peek(),")")||(j=function(){for(var q,B=[];q=k(),!g(q)&&(B.push(q),_(m.peek(),","));)m.next();return B}()),_(m.next(),")"))return{method:A.method,args:j,name};throw new SyntaxError('Tone.Expr: Expected ) in a function call "'+A.value+'"')}(P=m.next());if(P.type==="value")return{method:(P=m.next()).method,args:P.value};if(_(P,"(")){if(m.next(),R=k(),!_(P=m.next(),")"))throw new SyntaxError("Expected )");return R}throw new SyntaxError("Tone.Expr: Parse error, cannot process token "+P.value)}return k()},o.Expr.prototype._eval=function(p){if(!this.isUndef(p)){var m=p.method(p.args,this);return this._nodes.push(m),m}},o.Expr.prototype._disposeNodes=function(){for(var p=0;p<this._nodes.length;p++){var m=this._nodes[p];this.isFunction(m.dispose)?m.dispose():this.isFunction(m.disconnect)&&m.disconnect(),m=null,this._nodes[p]=null}this._nodes=null},o.Expr.prototype.dispose=function(){o.prototype.dispose.call(this),this._disposeNodes()},o.Expr}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(21),f(13),f(2)],h=(function(o){return o.GreaterThan=function(r){this.createInsOuts(2,0),this._param=this.input[0]=new o.Subtract(r),this.input[1]=this._param.input[1],this._gtz=this.output=new o.GreaterThanZero,this._param.connect(this._gtz)},o.extend(o.GreaterThan,o.Signal),o.GreaterThan.prototype.dispose=function(){return o.prototype.dispose.call(this),this._param.dispose(),this._param=null,this._gtz.dispose(),this._gtz=null,this},o.GreaterThan}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(6),f(15)],h=(function(o){return o.Abs=function(){this._abs=this.input=this.output=new o.WaveShaper(function(r){return r===0?0:Math.abs(r)},127)},o.extend(o.Abs,o.SignalBase),o.Abs.prototype.dispose=function(){return o.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},o.Abs}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(6),f(1),f(13)],h=(function(o){return o.Modulo=function(r){this.createInsOuts(1,0),this._shaper=new o.WaveShaper(Math.pow(2,16)),this._multiply=new o.Multiply,this._subtract=this.output=new o.Subtract,this._modSignal=new o.Signal(r),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(r)},o.extend(o.Modulo,o.SignalBase),o.Modulo.prototype._setWaveShaper=function(r){this._shaper.setMap(function(s){return Math.floor((s+1e-4)/r)})},Object.defineProperty(o.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(r){this._modSignal.value=r,this._setWaveShaper(r)}}),o.Modulo.prototype.dispose=function(){return o.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},o.Modulo}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(6)],h=(function(o){return o.Pow=function(r){this._exp=this.defaultArg(r,1),this._expScaler=this.input=this.output=new o.WaveShaper(this._expFunc(this._exp),8192)},o.extend(o.Pow,o.SignalBase),Object.defineProperty(o.Pow.prototype,"value",{get:function(){return this._exp},set:function(r){this._exp=r,this._expScaler.setMap(this._expFunc(this._exp))}}),o.Pow.prototype._expFunc=function(r){return function(s){return Math.pow(Math.abs(s),r)}},o.Pow.prototype.dispose=function(){return o.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},o.Pow}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(6),f(2)],h=(function(o){return o.AudioToGain=function(){this._norm=this.input=this.output=new o.WaveShaper(function(r){return(r+1)/2})},o.extend(o.AudioToGain,o.SignalBase),o.AudioToGain.prototype.dispose=function(){return o.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},o.AudioToGain}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(6)],h=(function(o){return o.EqualPowerGain=function(){this._eqPower=this.input=this.output=new o.WaveShaper((function(r){return Math.abs(r)<.001?0:this.equalPowerScale(r)}).bind(this),4096)},o.extend(o.EqualPowerGain,o.SignalBase),o.EqualPowerGain.prototype.dispose=function(){return o.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},o.EqualPowerGain}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){var v,h;v=[f(0),f(19),f(9)],h=(function(o){return o.TimelineState=function(r){o.Timeline.call(this),this._initial=r},o.extend(o.TimelineState,o.Timeline),o.TimelineState.prototype.getValueAtTime=function(r){var s=this.get(r);return s!==null?s.state:this._initial},o.TimelineState.prototype.setStateAtTime=function(r,s){this.add({state:r,time:s})},o.TimelineState}).apply(b,v),h!==void 0&&(T.exports=h)},function(T,b,f){f.r(b),f(24),f(25);var v=f(3);function h(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function i(){h(this,i),this.input=v.a.createGain(),this.output=v.a.createGain(),this.limiter=v.a.createDynamicsCompressor(),this.limiter.threshold.value=-3,this.limiter.ratio.value=20,this.limiter.knee.value=1,this.audiocontext=v.a,this.output.disconnect(),this.input.connect(this.limiter),this.limiter.connect(this.output),this.meter=v.a.createGain(),this.fftMeter=v.a.createGain(),this.output.connect(this.meter),this.output.connect(this.fftMeter),this.output.connect(this.audiocontext.destination),this.soundArray=[],this.parts=[],this.extensions=[]},r=new o;p5.prototype.getOutputVolume=function(){return r.output.gain.value},p5.prototype.outputVolume=function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(typeof i=="number"){var n=r.audiocontext.currentTime,a=r.output.gain.value;r.output.gain.cancelScheduledValues(n+e),r.output.gain.linearRampToValueAtTime(a,n+e),r.output.gain.linearRampToValueAtTime(i,n+e+t)}else if(i)i.connect(r.output.gain);else return r.output.gain},p5.prototype.soundOut=p5.soundOut=r,p5.soundOut._silentNode=r.audiocontext.createGain(),p5.soundOut._silentNode.gain.value=0,p5.soundOut._silentNode.connect(r.audiocontext.destination);var s=r,u=f(5),c=f.n(u);function p(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?p=function(t){return typeof t}:p=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(i)}function m(){return s.audiocontext.sampleRate}function g(i){var t=Math.log(i/440)/Math.log(2),e=Math.round(12*t)+69;return e}function _(i){return 440*Math.pow(2,(i-69)/12)}function S(i){if(typeof i!="string")return i;var t={A:21,B:23,C:24,D:26,E:28,F:29,G:31},e=t[i[0].toUpperCase()],n=~~i.slice(-1);switch(e+=12*(n-1),i[1]){case"#":e+=1;break;case"b":e-=1;break}return _(e)}function k(){s.extensions=[];for(var i=0;i<arguments.length;i++)if(arguments[i]=arguments[i].toLowerCase(),["mp3","wav","ogg","m4a","aac"].indexOf(arguments[i])>-1)s.extensions.push(arguments[i]);else throw arguments[i]+" is not a valid sound format!"}function O(){for(var i=0;i<s.soundArray.length;i++)s.soundArray[i].dispose()}function P(i){var t;if(typeof i=="string"){t=i;var e=t.split(".").pop();if(["mp3","wav","ogg","m4a","aac"].indexOf(e)>-1){if(!p5.prototype.isFileSupported(e))for(var n=t.split("."),a=n[n.length-1],l=0;l<s.extensions.length;l++){var d=s.extensions[l],y=p5.prototype.isFileSupported(d);if(y){a="",n.length===2&&(a+=n[0]);for(var x=1;x<=n.length-2;x++){var w=n[x];a+="."+w}t=a+=".",t=t+=d;break}}}else for(var C=0;C<s.extensions.length;C++){var E=s.extensions[C],V=p5.prototype.isFileSupported(E);if(V){t=t+"."+E;break}}}else if(p(i)==="object")for(var N=0;N<i.length;N++){var U=i[N].split(".").pop(),eo=p5.prototype.isFileSupported(U);if(eo){t=i[N];break}}return t}function R(i,t,e,n,a){for(var l in i.mathOps)i.mathOps[l]instanceof a&&(i.mathOps[l].dispose(),e=l,e<i.mathOps.length-1&&(n=i.mathOps[l+1]));return i.mathOps[e-1].disconnect(),i.mathOps[e-1].connect(t),t.connect(n),i.mathOps[e]=t,i}function A(i){var t,e;t=i.getChannelData(0),i.numberOfChannels>1?e=i.getChannelData(1):e=t;var n=j(t,e),a=new window.ArrayBuffer(44+n.length*2),l=new window.DataView(a);q(l,0,"RIFF"),l.setUint32(4,36+n.length*2,!0),q(l,8,"WAVE"),q(l,12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,2,!0),l.setUint32(24,s.audiocontext.sampleRate,!0),l.setUint32(28,s.audiocontext.sampleRate*4,!0),l.setUint16(32,4,!0),l.setUint16(34,16,!0),q(l,36,"data"),l.setUint32(40,n.length*2,!0);for(var d=n.length,y=44,x=1,w=0;w<d;w++)l.setInt16(y,n[w]*(32767*x),!0),y+=2;return l}function j(i,t){for(var e=i.length+t.length,n=new Float32Array(e),a=0,l=0;l<e;)n[l++]=i[a],n[l++]=t[a],a++;return n}function q(i,t,e){for(var n=e.length,a=0;a<n;a++)i.setUint8(t+a,e.charCodeAt(a))}function B(i){var t=i,e=new AudioWorkletNode(s.audiocontext,c.a.soundFileProcessor);return e instanceof ScriptProcessorNode&&(t=e.bufferSize),e.disconnect(),e=null,t}function Se(i,t){var e=A(i.buffer);p5.prototype.writeFile([e],t,"wav")}var ke=function(i,t,e){var n=new Error,a,l;return n.name=i,n.originalStack=n.stack+t,a=n.stack+t,n.failedPath=e,l=a.split(`
`).filter(function(d){return!d.match(/(p5.|native code|globalInit)/g)}),n.stack=l.join(`
`),n},L=ke,Pe=[f(27).default,f(28).default,f(29).default],Ae=s.audiocontext,ee=!1;function Oe(){return Promise.all(Pe.map(function(i){var t=new Blob([i],{type:"application/javascript"}),e=URL.createObjectURL(t);return Ae.audioWorklet.addModule(e)}))}p5.prototype.registerMethod("init",function(){if(!ee){!this.preload&&!window.preload&&(this.preload=function(){}),this._incrementPreload();var i=(function(){ee=!0,this._decrementPreload()}).bind(this);Oe().then(i)}});function ne(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Ce(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function ie(i,t,e){return t&&Ce(i.prototype,t),i}var F=s.audiocontext,Et;if(typeof F.createStereoPanner<"u"){var Re=function(){function i(t,e){ne(this,i),this.stereoPanner=this.input=F.createStereoPanner(),t.connect(this.stereoPanner),this.stereoPanner.connect(e)}return ie(i,[{key:"pan",value:function(t,e){var n=e||0,a=F.currentTime+n;this.stereoPanner.pan.linearRampToValueAtTime(t,a)}},{key:"inputChannels",value:function(){}},{key:"connect",value:function(t){this.stereoPanner.connect(t)}},{key:"disconnect",value:function(){this.stereoPanner&&this.stereoPanner.disconnect()}}]),i}();Et=Re}else{var qe=function(){function i(t,e,n){ne(this,i),this.input=F.createGain(),t.connect(this.input),this.left=F.createGain(),this.right=F.createGain(),this.left.channelInterpretation="discrete",this.right.channelInterpretation="discrete",n>1?(this.splitter=F.createChannelSplitter(2),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0)):(this.input.connect(this.left),this.input.connect(this.right)),this.output=F.createChannelMerger(2),this.left.connect(this.output,0,1),this.right.connect(this.output,0,0),this.output.connect(e)}return ie(i,[{key:"pan",value:function(t,e){var n=e||0,a=F.currentTime+n,l=(t+1)/2,d=Math.cos(l*Math.PI/2),y=Math.sin(l*Math.PI/2);this.left.gain.linearRampToValueAtTime(y,a),this.right.gain.linearRampToValueAtTime(d,a)}},{key:"inputChannels",value:function(t){t===1?(this.input.disconnect(),this.input.connect(this.left),this.input.connect(this.right)):t===2&&(typeof this.splitter>"u"&&(this.splitter=F.createChannelSplitter(2)),this.input.disconnect(),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0))}},{key:"connect",value:function(t){this.output.connect(t)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}}]),i}();Et=qe}var Nt=Et;function et(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?et=function(t){return typeof t}:et=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},et(i)}function Ee(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Ne(i,t,e){return Ee(i.prototype,t),i}function re(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var M=s.audiocontext,je=function(i){for(var t=i.length,e=M.createBuffer(1,i.length,M.sampleRate),n=e.getChannelData(0),a=0;a<t;a++)n[a]=a;return e},Be=function i(t,e,n,a){re(this,i),this.callback=t,this.time=e,this.id=n,this.val=a};function Me(i){var t=i.target,e=this;t._playing=!1,t.removeEventListener("ended",e._clearOnEnd),e._onended(e),e.bufferSourceNodes.map(function(n,a){return a}).reverse().forEach(function(n){var a=e.bufferSourceNodes[n];a._playing===!1&&e.bufferSourceNodes.splice(n,1)}),e.bufferSourceNodes.length===0&&(e._playing=!1)}var oe=function(){function i(t,e,n,a){if(re(this,i),typeof t<"u"){if(typeof t=="string"||typeof t[0]=="string"){var l=p5.prototype._checkFileFormats(t);this.url=l}else if(et(t)==="object"&&!(window.File&&window.FileReader&&window.FileList&&window.Blob))throw"Unable to load file because the File API is not supported";t.file&&(t=t.file),this.file=t}this._onended=function(){},this._looping=!1,this._playing=!1,this._paused=!1,this._pauseTime=0,this._cues=[],this._cueIDCounter=0,this._lastPos=0,this._counterNode=null,this._workletNode=null,this.bufferSourceNodes=[],this.bufferSourceNode=null,this.buffer=null,this.playbackRate=1,this.input=s.audiocontext.createGain(),this.output=s.audiocontext.createGain(),this.reversed=!1,this.startTime=0,this.endTime=null,this.pauseTime=0,this.mode="sustain",this.startMillis=null,this.panPosition=0,this.panner=new Nt(this.output,s.input,2),(this.url||this.file)&&this.load(e,n),s.soundArray.push(this),typeof a=="function"?this._whileLoading=a:this._whileLoading=function(){},this._clearOnEnd=Me.bind(this),this.amp=this.setVolume,this.fade=this.setVolume}return Ne(i,[{key:"load",value:function(t,e){var n=this,a=new Error().stack;if(this.url!==void 0&&this.url!==""){var l=new XMLHttpRequest;l.addEventListener("progress",function(y){n._updateProgress(y)},!1),l.open("GET",this.url,!0),l.responseType="arraybuffer",l.onload=function(){if(l.status===200){if(!n.panner)return;M.decodeAudioData(l.response,function(w){n.panner&&(n.buffer=w,n.panner.inputChannels(w.numberOfChannels),t&&t(n))},function(){if(n.panner){var w=new L("decodeAudioData",a,n.url),C="AudioContext error at decodeAudioData for "+n.url;e?(w.msg=C,e(w)):console.error(C+`
 The error stack trace includes: 
`+w.stack)}})}else{if(!n.panner)return;var y=new L("loadSound",a,n.url),x="Unable to load "+n.url+". The request status was: "+l.status+" ("+l.statusText+")";e?(y.message=x,e(y)):console.error(x+`
 The error stack trace includes: 
`+y.stack)}},l.onerror=function(){var y=new L("loadSound",a,n.url),x="There was no response from the server at "+n.url+". Check the url and internet connectivity.";e?(y.message=x,e(y)):console.error(x+`
 The error stack trace includes: 
`+y.stack)},l.send()}else if(this.file!==void 0){var d=new FileReader;d.onload=function(){n.panner&&M.decodeAudioData(d.result,function(y){n.panner&&(n.buffer=y,n.panner.inputChannels(y.numberOfChannels),t&&t(n))})},d.onerror=function(y){n.panner&&onerror&&onerror(y)},d.readAsArrayBuffer(this.file)}}},{key:"_updateProgress",value:function(t){if(t.lengthComputable){var e=t.loaded/t.total*.99;this._whileLoading(e,t)}else this._whileLoading("size unknown")}},{key:"isLoaded",value:function(){return!!this.buffer}},{key:"play",value:function(t,e,n,a,l){if(!this.output){console.warn("SoundFile.play() called after dispose");return}var d=s.audiocontext.currentTime,y,x,w=t||0;if(w<0&&(w=0),w=w+d,typeof e<"u"&&this.rate(e),typeof n<"u"&&this.setVolume(n),this.buffer){if(this._pauseTime=0,this.mode==="restart"&&this.buffer&&this.bufferSourceNode&&(this.bufferSourceNode.stop(w),this._counterNode.stop(w)),this.mode==="untildone"&&this.isPlaying())return;if(this.bufferSourceNode=this._initSourceNode(),delete this._counterNode,this._counterNode=this._initCounterNode(),a)if(a>=0&&a<this.buffer.duration)y=a;else throw"start time out of range";else y=0;l&&(l=l<=this.buffer.duration-y?l:this.buffer.duration),this._paused?(this.bufferSourceNode.start(w,this.pauseTime,l),this._counterNode.start(w,this.pauseTime,l)):(this.bufferSourceNode.start(w,y,l),this._counterNode.start(w,y,l)),this._playing=!0,this._paused=!1,this.bufferSourceNodes.push(this.bufferSourceNode),this.bufferSourceNode._arrayIndex=this.bufferSourceNodes.length-1,this.bufferSourceNode.addEventListener("ended",this._clearOnEnd)}else throw"not ready to play file, buffer has yet to load. Try preload()";this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping,this._looping===!0&&(x=l||y-1e-15,this.bufferSourceNode.loopStart=y,this.bufferSourceNode.loopEnd=x,this._counterNode.loopStart=y,this._counterNode.loopEnd=x)}},{key:"playMode",value:function(t){var e=t.toLowerCase();if(e==="restart"&&this.buffer&&this.bufferSourceNode)for(var n=0;n<this.bufferSourceNodes.length-1;n++){var a=s.audiocontext.currentTime;this.bufferSourceNodes[n].stop(a)}if(e==="restart"||e==="sustain"||e==="untildone")this.mode=e;else throw'Invalid play mode. Must be either "restart" or "sustain"'}},{key:"pause",value:function(t){var e=s.audiocontext.currentTime,n=t||0,a=n+e;this.isPlaying()&&this.buffer&&this.bufferSourceNode?(this._paused=!0,this._playing=!1,this.pauseTime=this.currentTime(),this.bufferSourceNode.stop(a),this._counterNode.stop(a),this._pauseTime=this.currentTime()):this._pauseTime=0}},{key:"loop",value:function(t,e,n,a,l){this._looping=!0,this.play(t,e,n,a,l)}},{key:"setLoop",value:function(t){if(t===!0)this._looping=!0;else if(t===!1)this._looping=!1;else throw"Error: setLoop accepts either true or false";this.bufferSourceNode&&(this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping)}},{key:"isLooping",value:function(){return this.bufferSourceNode?this._looping===!0&&this.isPlaying()===!0:!1}},{key:"isPlaying",value:function(){return this._playing}},{key:"isPaused",value:function(){return this._paused}},{key:"stop",value:function(t){var e=t||0;if(this.mode==="sustain"||this.mode==="untildone")this.stopAll(e),this._playing=!1,this.pauseTime=0,this._paused=!1;else if(this.buffer&&this.bufferSourceNode){var n=s.audiocontext.currentTime,a=e||0;this.pauseTime=0,this.bufferSourceNode.stop(n+a),this._counterNode.stop(n+a),this._playing=!1,this._paused=!1}}},{key:"stopAll",value:function(t){var e=s.audiocontext.currentTime,n=t||0;if(this.buffer&&this.bufferSourceNode){for(var a in this.bufferSourceNodes){var l=this.bufferSourceNodes[a];if(l)try{l.stop(e+n)}catch{}}this._counterNode.stop(e+n)}}},{key:"getVolume",value:function(){return this.output.gain.value}},{key:"pan",value:function(t,e){this.panPosition=t,this.panner.pan(t,e)}},{key:"getPan",value:function(){return this.panPosition}},{key:"rate",value:function(t){var e=!1;if(typeof t>"u")return this.playbackRate;if(this.playbackRate=t,t===0?t=1e-13:t<0&&!this.reversed?(t=Math.abs(t),e=!0):t>0&&this.reversed&&(e=!0),this.bufferSourceNode){var n=s.audiocontext.currentTime;this.bufferSourceNode.playbackRate.cancelScheduledValues(n),this.bufferSourceNode.playbackRate.linearRampToValueAtTime(Math.abs(t),n),this._counterNode.playbackRate.cancelScheduledValues(n),this._counterNode.playbackRate.linearRampToValueAtTime(Math.abs(t),n)}return e&&this.reverseBuffer(),this.playbackRate}},{key:"setPitch",value:function(t){var e=_(t)/_(60);this.rate(e)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setVolume",value:function(t,e,n){if(typeof t=="number"){var a=e||0,l=n||0,d=s.audiocontext.currentTime,y=this.output.gain.value;this.output.gain.cancelScheduledValues(d+l),this.output.gain.linearRampToValueAtTime(y,d+l),this.output.gain.linearRampToValueAtTime(t,d+l+a)}else if(t)t.connect(this.output.gain);else return this.output.gain}},{key:"duration",value:function(){return this.buffer?this.buffer.duration:0}},{key:"currentTime",value:function(){return this.reversed?Math.abs(this._lastPos-this.buffer.length)/M.sampleRate:this._lastPos/M.sampleRate}},{key:"jump",value:function(t,e){if(t<0||t>this.buffer.duration)throw"jump time out of range";if(e>this.buffer.duration-t)throw"end time out of range";var n=t||0,a=e||void 0;this.isPlaying()&&(this.stop(0),this.play(0,this.playbackRate,this.output.gain.value,n,a))}},{key:"channels",value:function(){return this.buffer.numberOfChannels}},{key:"sampleRate",value:function(){return this.buffer.sampleRate}},{key:"frames",value:function(){return this.buffer.length}},{key:"getPeaks",value:function(t){if(this.buffer){if(t||(t=window.width*5),this.buffer){for(var e=this.buffer,n=e.length/t,a=~~(n/10)||1,l=e.numberOfChannels,d=new Float32Array(Math.round(t)),y=0;y<l;y++)for(var x=e.getChannelData(y),w=0;w<t;w++){for(var C=~~(w*n),E=~~(C+n),V=0,N=C;N<E;N+=a){var U=x[N];(U>V||-U>V)&&(V=U)}(y===0||Math.abs(V)>d[w])&&(d[w]=V)}return d}}else throw"Cannot load peaks yet, buffer is not loaded"}},{key:"reverseBuffer",value:function(){if(this.buffer){var t=this._lastPos/M.sampleRate,e=this.getVolume();this.setVolume(0,.001);for(var n=this.buffer.numberOfChannels,a=0;a<n;a++)this.buffer.getChannelData(a).reverse();this.reversed=!this.reversed,this.isPlaying()&&t&&this.jump(this.duration()-t),this.setVolume(e,.001)}else throw"SoundFile is not done loading"}},{key:"onended",value:function(t){return this._onended=t,this}},{key:"add",value:function(){}},{key:"dispose",value:function(){var t=s.audiocontext.currentTime,e=s.soundArray.indexOf(this);if(s.soundArray.splice(e,1),this.stop(t),this.buffer&&this.bufferSourceNode){for(var n=0;n<this.bufferSourceNodes.length-1;n++)if(this.bufferSourceNodes[n]!==null){this.bufferSourceNodes[n].disconnect();try{this.bufferSourceNodes[n].stop(t)}catch{console.warn("no buffer source node to dispose")}this.bufferSourceNodes[n]=null}if(this.isPlaying()){try{this._counterNode.stop(t)}catch(a){console.log(a)}this._counterNode=null}}this.output&&(this.output.disconnect(),this.output=null),this.panner&&(this.panner.disconnect(),this.panner=null)}},{key:"connect",value:function(t){t?t.hasOwnProperty("input")?this.panner.connect(t.input):this.panner.connect(t):this.panner.connect(s.input)}},{key:"disconnect",value:function(){this.panner&&this.panner.disconnect()}},{key:"getLevel",value:function(){console.warn("p5.SoundFile.getLevel has been removed from the library. Use p5.Amplitude instead")}},{key:"setPath",value:function(t,e){var n=p5.prototype._checkFileFormats(t);this.url=n,this.load(e)}},{key:"setBuffer",value:function(t){var e=t.length,n=t[0].length,a=M.createBuffer(e,n,M.sampleRate);t[0]instanceof Float32Array||(t[0]=new Float32Array(t[0]));for(var l=0;l<e;l++){var d=a.getChannelData(l);d.set(t[l])}this.buffer=a,this.panner.inputChannels(e)}},{key:"_initCounterNode",value:function(){var t=this,e=this,n=M.currentTime,a=M.createBufferSource(),l=B(256);return e._workletNode&&(e._workletNode.disconnect(),delete e._workletNode),e._workletNode=new AudioWorkletNode(M,c.a.soundFileProcessor,{processorOptions:{bufferSize:l}}),e._workletNode.port.onmessage=function(d){if(d.data.name==="position"){if(d.data.position===0)return;t._lastPos=d.data.position,t._onTimeUpdate(e._lastPos)}},a.buffer=je(e.buffer),a.playbackRate.setValueAtTime(e.playbackRate,n),a.connect(e._workletNode),e._workletNode.connect(p5.soundOut._silentNode),a}},{key:"_initSourceNode",value:function(){var t=M.createBufferSource();return t.buffer=this.buffer,t.playbackRate.value=this.playbackRate,t.connect(this.output),t}},{key:"processPeaks",value:function(t,e,n,a){console.warn("processPeaks is deprecated")}},{key:"addCue",value:function(t,e,n){var a=this._cueIDCounter++,l=new Be(e,t,a,n);return this._cues.push(l),a}},{key:"removeCue",value:function(t){for(var e=this._cues.length,n=0;n<e;n++){var a=this._cues[n];if(a.id===t){this._cues.splice(n,1);break}}this._cues.length}},{key:"clearCues",value:function(){this._cues=[]}},{key:"_onTimeUpdate",value:function(t){for(var e=t/this.buffer.sampleRate,n=this._cues.length,a=0;a<n;a++){var l=this._cues[a],d=l.time,y=l.val,x=this._prevUpdateTime||0,w=e;x<=d&&d<=w&&l.callback(y)}this._prevUpdateTime=e}},{key:"save",value:function(t){p5.prototype.saveSound(this,t,"wav")}},{key:"getBlob",value:function(){var t=A(this.buffer);return new Blob([t],{type:"audio/wav"})}}]),i}();function Ve(i,t,e,n){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&window.alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var a=this,l=new oe(i,function(){typeof t=="function"&&t.apply(a,arguments),typeof a._decrementPreload=="function"&&a._decrementPreload()},e,n);return l}var Fe=oe;function De(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Ie(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Ue(i,t,e){return Ie(i.prototype,t),i}var Ge=function(){function i(t){De(this,i),this.bufferSize=B(2048),this.audiocontext=s.audiocontext,this._workletNode=new AudioWorkletNode(this.audiocontext,c.a.amplitudeProcessor,{outputChannelCount:[1],parameterData:{smoothing:t||0},processorOptions:{normalize:!1,smoothing:t||0,numInputChannels:2,bufferSize:this.bufferSize}}),this._workletNode.port.onmessage=(function(e){e.data.name==="amplitude"&&(this.volume=e.data.volume,this.volNorm=e.data.volNorm,this.stereoVol=e.data.stereoVol,this.stereoVolNorm=e.data.stereoVolNorm)}).bind(this),this.input=this._workletNode,this.output=this.audiocontext.createGain(),this.volume=0,this.volNorm=0,this.stereoVol=[0,0],this.stereoVolNorm=[0,0],this.normalize=!1,this._workletNode.connect(this.output),this.output.gain.value=0,this.output.connect(this.audiocontext.destination),s.meter.connect(this._workletNode),s.soundArray.push(this)}return Ue(i,[{key:"setInput",value:function(t,e){s.meter.disconnect(),e&&(this._workletNode.parameters.get("smoothing").value=e),t==null?(console.log("Amplitude input source is not ready! Connecting to main output instead"),s.meter.connect(this._workletNode)):t?(t.connect(this._workletNode),this._workletNode.disconnect(),this._workletNode.connect(this.output)):s.meter.connect(this._workletNode)}},{key:"connect",value:function(t){t?t.hasOwnProperty("input")?this.output.connect(t.input):this.output.connect(t):this.output.connect(this.panner.connect(s.input))}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"getLevel",value:function(t){return typeof t<"u"?this.normalize?this.stereoVolNorm[t]:this.stereoVol[t]:this.normalize?this.volNorm:this.volume}},{key:"toggleNormalize",value:function(t){typeof t=="boolean"?this.normalize=t:this.normalize=!this.normalize,this._workletNode.port.postMessage({name:"toggleNormalize",normalize:this.normalize})}},{key:"smooth",value:function(t){t>=0&&t<1?this._workletNode.port.postMessage({name:"smoothing",smoothing:t}):console.log("Error: smoothing must be between 0 and 1")}},{key:"dispose",value:function(){var t=s.soundArray.indexOf(this);s.soundArray.splice(t,1),this.input&&(this.input.disconnect(),delete this.input),this.output&&(this.output.disconnect(),delete this.output),this._workletNode.disconnect(),delete this._workletNode}}]),i}(),se=Ge;function Le(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function ze(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function We(i,t,e){return ze(i.prototype,t),i}var Ze=function(){function i(t,e){Le(this,i),this.input=this.analyser=s.audiocontext.createAnalyser(),Object.defineProperties(this,{bins:{get:function(){return this.analyser.fftSize/2},set:function(n){this.analyser.fftSize=n*2},configurable:!0,enumerable:!0},smoothing:{get:function(){return this.analyser.smoothingTimeConstant},set:function(n){this.analyser.smoothingTimeConstant=n},configurable:!0,enumerable:!0}}),this.smooth(t),this.bins=e||1024,s.fftMeter.connect(this.analyser),this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.bass=[20,140],this.lowMid=[140,400],this.mid=[400,2600],this.highMid=[2600,5200],this.treble=[5200,14e3],s.soundArray.push(this)}return We(i,[{key:"setInput",value:function(t){t?(t.output?t.output.connect(this.analyser):t.connect&&t.connect(this.analyser),s.fftMeter.disconnect()):s.fftMeter.connect(this.analyser)}},{key:"waveform",value:function(){for(var t,e,n=new Array,a=0;a<arguments.length;a++)typeof arguments[a]=="number"&&(t=arguments[a],this.analyser.fftSize=t*2),typeof arguments[a]=="string"&&(e=arguments[a]);if(e&&!p5.prototype._isSafari())return He(this,this.timeDomain),this.analyser.getFloatTimeDomainData(this.timeDomain),this.timeDomain;$e(this,this.timeDomain),this.analyser.getByteTimeDomainData(this.timeDomain);for(var l=0;l<this.timeDomain.length;l++){var d=p5.prototype.map(this.timeDomain[l],0,255,-1,1);n.push(d)}return n}},{key:"analyze",value:function(){for(var t,e=0;e<arguments.length;e++)typeof arguments[e]=="number"&&(this.bins=arguments[e],this.analyser.fftSize=this.bins*2),typeof arguments[e]=="string"&&(t=arguments[e]);if(t&&t.toLowerCase()==="db")return Xe(this),this.analyser.getFloatFrequencyData(this.freqDomain),this.freqDomain;Ye(this,this.freqDomain),this.analyser.getByteFrequencyData(this.freqDomain);var n=Array.apply([],this.freqDomain);return n}},{key:"getEnergy",value:function(t,e){var n=s.audiocontext.sampleRate/2;if(t==="bass"?(t=this.bass[0],e=this.bass[1]):t==="lowMid"?(t=this.lowMid[0],e=this.lowMid[1]):t==="mid"?(t=this.mid[0],e=this.mid[1]):t==="highMid"?(t=this.highMid[0],e=this.highMid[1]):t==="treble"&&(t=this.treble[0],e=this.treble[1]),typeof t!="number")throw"invalid input for getEnergy()";if(e)if(t&&e){if(t>e){var a=e;e=t,t=a}for(var l=Math.round(t/n*this.freqDomain.length),d=Math.round(e/n*this.freqDomain.length),y=0,x=0,w=l;w<=d;w++)y+=this.freqDomain[w],x+=1;var C=y/x;return C}else throw"invalid input for getEnergy()";else{var E=Math.round(t/n*this.freqDomain.length);return this.freqDomain[E]}}},{key:"getFreq",value:function(t,e){console.log("getFreq() is deprecated. Please use getEnergy() instead.");var n=this.getEnergy(t,e);return n}},{key:"getCentroid",value:function(){for(var t=s.audiocontext.sampleRate/2,e=0,n=0,a=0;a<this.freqDomain.length;a++)e+=a*this.freqDomain[a],n+=this.freqDomain[a];var l=0;n!==0&&(l=e/n);var d=l*(t/this.freqDomain.length);return d}},{key:"smooth",value:function(t){return typeof t<"u"&&(this.smoothing=t),this.smoothing}},{key:"dispose",value:function(){var t=s.soundArray.indexOf(this);s.soundArray.splice(t,1),this.analyser&&(this.analyser.disconnect(),delete this.analyser)}},{key:"linAverages",value:function(t){for(var e=t||16,n=this.freqDomain,a=n.length,l=Math.floor(a/e),d=new Array(e),y=0,x=0;x<a;x++)d[y]=d[y]!==void 0?(d[y]+n[x])/2:n[x],x%l===l-1&&y++;return d}},{key:"logAverages",value:function(t){for(var e=s.audiocontext.sampleRate/2,n=this.freqDomain,a=n.length,l=new Array(t.length),d=0,y=0;y<a;y++){var x=Math.round(y*e/this.freqDomain.length);x>t[d].hi&&d++,l[d]=l[d]!==void 0?(l[d]+n[y])/2:n[y]}return l}},{key:"getOctaveBands",value:function(t,e){var n=t||3,a=e||15.625,l=[],d={lo:a/Math.pow(2,1/(2*n)),ctr:a,hi:a*Math.pow(2,1/(2*n))};l.push(d);for(var y=s.audiocontext.sampleRate/2;d.hi<y;){var x={};x.lo=d.hi,x.ctr=d.ctr*Math.pow(2,1/n),x.hi=x.ctr*Math.pow(2,1/(2*n)),l.push(x),d=x}return l}}]),i}();function Xe(i){i.freqDomain instanceof Float32Array||(i.freqDomain=new Float32Array(i.analyser.frequencyBinCount))}function Ye(i){i.freqDomain instanceof Uint8Array||(i.freqDomain=new Uint8Array(i.analyser.frequencyBinCount))}function He(i){i.timeDomain instanceof Float32Array||(i.timeDomain=new Float32Array(i.analyser.frequencyBinCount))}function $e(i){i.timeDomain instanceof Uint8Array||(i.timeDomain=new Uint8Array(i.analyser.frequencyBinCount))}var Qe=Ze,Je=f(4),nt=f.n(Je),Ke=f(1),z=f.n(Ke),tn=f(8),it=f.n(tn);function rt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?rt=function(t){return typeof t}:rt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(i)}function ot(i,t){return t&&(rt(t)==="object"||typeof t=="function")?t:en(i)}function en(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function W(i){return W=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},W(i)}function st(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&jt(i,t)}function jt(i,t){return jt=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},jt(i,t)}function Z(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function nn(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function rn(i,t,e){return nn(i.prototype,t),i}function Bt(i,t,e,n,a){var l=i.oscillator;for(var d in i.mathOps)i.mathOps[d]instanceof a&&(l.disconnect(),i.mathOps[d].dispose(),e=d,e<i.mathOps.length-2&&(n=i.mathOps[d+1]));return e===i.mathOps.length-1&&i.mathOps.push(n),d>0&&(l=i.mathOps[d-1]),l.disconnect(),l.connect(t),t.connect(n),i.mathOps[e]=t,i}var X=function(){function i(t,e){if(Z(this,i),typeof t=="string"){var n=e;e=t,t=n}if(typeof e=="number"){var a=e;e=t,t=a}this.started=!1,this.phaseAmount=void 0,this.oscillator=s.audiocontext.createOscillator(),this.f=t||440,this.oscillator.type=e||"sine",this.oscillator.frequency.setValueAtTime(this.f,s.audiocontext.currentTime),this.output=s.audiocontext.createGain(),this._freqMods=[],this.output.gain.value=.5,this.output.gain.setValueAtTime(.5,s.audiocontext.currentTime),this.oscillator.connect(this.output),this.panPosition=0,this.connection=s.input,this.panner=new Nt(this.output,this.connection,1),this.mathOps=[this.output],s.soundArray.push(this),this.fade=this.amp}return rn(i,[{key:"start",value:function(t,e){if(this.started){var n=s.audiocontext.currentTime;this.stop(n)}if(!this.started){var a=e||this.f,l=this.oscillator.type;this.oscillator&&(this.oscillator.disconnect(),delete this.oscillator),this.oscillator=s.audiocontext.createOscillator(),this.oscillator.frequency.value=Math.abs(a),this.oscillator.type=l,this.oscillator.connect(this.output),t=t||0,this.oscillator.start(t+s.audiocontext.currentTime),this.freqNode=this.oscillator.frequency;for(var d in this._freqMods)typeof this._freqMods[d].connect<"u"&&this._freqMods[d].connect(this.oscillator.frequency);this.started=!0}}},{key:"stop",value:function(t){if(this.started){var e=t||0,n=s.audiocontext.currentTime;this.oscillator.stop(e+n),this.started=!1}}},{key:"amp",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(typeof t=="number"){var a=s.audiocontext.currentTime;this.output.gain.linearRampToValueAtTime(t,a+n+e)}else if(t)t.connect(this.output.gain);else return this.output.gain}},{key:"getAmp",value:function(){return this.output.gain.value}},{key:"freq",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(typeof t=="number"&&!isNaN(t)){this.f=t;var a=s.audiocontext.currentTime;e===0?this.oscillator.frequency.setValueAtTime(t,n+a):t>0?this.oscillator.frequency.exponentialRampToValueAtTime(t,n+e+a):this.oscillator.frequency.linearRampToValueAtTime(t,n+e+a),this.phaseAmount&&this.phase(this.phaseAmount)}else if(t)t.output&&(t=t.output),t.connect(this.oscillator.frequency),this._freqMods.push(t);else return this.oscillator.frequency}},{key:"getFreq",value:function(){return this.oscillator.frequency.value}},{key:"setType",value:function(t){this.oscillator.type=t}},{key:"getType",value:function(){return this.oscillator.type}},{key:"connect",value:function(t){t?t.hasOwnProperty("input")?(this.panner.connect(t.input),this.connection=t.input):(this.panner.connect(t),this.connection=t):this.panner.connect(s.input)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect(),this.panner&&(this.panner.disconnect(),this.output&&this.output.connect(this.panner)),this.oscMods=[]}},{key:"pan",value:function(t,e){this.panPosition=t,this.panner.pan(t,e)}},{key:"getPan",value:function(){return this.panPosition}},{key:"dispose",value:function(){var t=s.soundArray.indexOf(this);if(s.soundArray.splice(t,1),this.oscillator){var e=s.audiocontext.currentTime;this.stop(e),this.disconnect(),this.panner=null,this.oscillator=null}this.osc2&&this.osc2.dispose()}},{key:"phase",value:function(t){var e=p5.prototype.map(t,0,1,0,1/this.f),n=s.audiocontext.currentTime;this.phaseAmount=t,this.dNode||(this.dNode=s.audiocontext.createDelay(),this.oscillator.disconnect(),this.oscillator.connect(this.dNode),this.dNode.connect(this.output)),this.dNode.delayTime.setValueAtTime(e,n)}},{key:"add",value:function(t){var e=new nt.a(t),n=this.mathOps.length-1,a=this.output;return Bt(this,e,n,a,nt.a)}},{key:"mult",value:function(t){var e=new z.a(t),n=this.mathOps.length-1,a=this.output;return Bt(this,e,n,a,z.a)}},{key:"scale",value:function(t,e,n,a){var l,d;arguments.length===4?(l=p5.prototype.map(n,t,e,0,1)-.5,d=p5.prototype.map(a,t,e,0,1)-.5):(l=arguments[0],d=arguments[1]);var y=new it.a(l,d),x=this.mathOps.length-1,w=this.output;return Bt(this,y,x,w,it.a)}}]),i}(),on=function(i){st(t,i);function t(e){return Z(this,t),ot(this,W(t).call(this,e,"sine"))}return t}(X),sn=function(i){st(t,i);function t(e){return Z(this,t),ot(this,W(t).call(this,e,"triangle"))}return t}(X),ae=function(i){st(t,i);function t(e){return Z(this,t),ot(this,W(t).call(this,e,"sawtooth"))}return t}(X),an=function(i){st(t,i);function t(e){return Z(this,t),ot(this,W(t).call(this,e,"square"))}return t}(X),at=X,un=f(7),Mt=f.n(un);p5.Envelope=function(i,t,e,n,a,l){this.aTime=i||.1,this.aLevel=t||1,this.dTime=e||.5,this.dLevel=n||0,this.rTime=a||0,this.rLevel=l||0,this._rampHighPercentage=.98,this._rampLowPercentage=.02,this.output=s.audiocontext.createGain(),this.control=new Mt.a,this._init(),this.control.connect(this.output),this.connection=null,this.mathOps=[this.control],this.isExponential=!1,this.sourceToClear=null,this.wasTriggered=!1,s.soundArray.push(this)},p5.Envelope.prototype._init=function(){var i=s.audiocontext.currentTime,t=i;this.control.setTargetAtTime(1e-5,t,.001),this._setRampAD(this.aTime,this.dTime)},p5.Envelope.prototype.set=function(i,t,e,n,a,l){this.aTime=i,this.aLevel=t,this.dTime=e||0,this.dLevel=n||0,this.rTime=a||0,this.rLevel=l||0,this._setRampAD(i,e)},p5.Envelope.prototype.setADSR=function(i,t,e,n){this.aTime=i,this.dTime=t||0,this.sPercent=e||0,this.dLevel=typeof e<"u"?e*(this.aLevel-this.rLevel)+this.rLevel:0,this.rTime=n||0,this._setRampAD(i,t)},p5.Envelope.prototype.setRange=function(i,t){this.aLevel=i||1,this.rLevel=t||0},p5.Envelope.prototype._setRampAD=function(i,t){this._rampAttackTime=this.checkExpInput(i),this._rampDecayTime=this.checkExpInput(t);var e=1;e=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=i/this.checkExpInput(e),e=Math.log(1/this._rampLowPercentage),this._rampDecayTC=t/this.checkExpInput(e)},p5.Envelope.prototype.setRampPercentages=function(i,t){this._rampHighPercentage=this.checkExpInput(i),this._rampLowPercentage=this.checkExpInput(t);var e=1;e=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=this._rampAttackTime/this.checkExpInput(e),e=Math.log(1/this._rampLowPercentage),this._rampDecayTC=this._rampDecayTime/this.checkExpInput(e)},p5.Envelope.prototype.setInput=function(){for(var i=0;i<arguments.length;i++)this.connect(arguments[i])},p5.Envelope.prototype.setExp=function(i){this.isExponential=i},p5.Envelope.prototype.checkExpInput=function(i){return i<=0&&(i=1e-8),i},p5.Envelope.prototype.play=function(i,t,e){var n=t||0;i&&this.connection!==i&&this.connect(i),this.triggerAttack(i,n),this.triggerRelease(i,n+this.aTime+this.dTime+~~e)},p5.Envelope.prototype.triggerAttack=function(i,t){var e=s.audiocontext.currentTime,n=t||0,a=e+n;this.lastAttack=a,this.wasTriggered=!0,i&&this.connection!==i&&this.connect(i);var l=this.control.getValueAtTime(a);this.isExponential===!0?this.control.exponentialRampToValueAtTime(this.checkExpInput(l),a):this.control.linearRampToValueAtTime(l,a),a+=this.aTime,this.isExponential===!0?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.aLevel),a),l=this.checkExpInput(this.control.getValueAtTime(a)),this.control.cancelScheduledValues(a),this.control.exponentialRampToValueAtTime(l,a)):(this.control.linearRampToValueAtTime(this.aLevel,a),l=this.control.getValueAtTime(a),this.control.cancelScheduledValues(a),this.control.linearRampToValueAtTime(l,a)),a+=this.dTime,this.isExponential===!0?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.dLevel),a),l=this.checkExpInput(this.control.getValueAtTime(a)),this.control.cancelScheduledValues(a),this.control.exponentialRampToValueAtTime(l,a)):(this.control.linearRampToValueAtTime(this.dLevel,a),l=this.control.getValueAtTime(a),this.control.cancelScheduledValues(a),this.control.linearRampToValueAtTime(l,a))},p5.Envelope.prototype.triggerRelease=function(i,t){if(this.wasTriggered){var e=s.audiocontext.currentTime,n=t||0,a=e+n;i&&this.connection!==i&&this.connect(i);var l=this.control.getValueAtTime(a);this.isExponential===!0?this.control.exponentialRampToValueAtTime(this.checkExpInput(l),a):this.control.linearRampToValueAtTime(l,a),a+=this.rTime,this.isExponential===!0?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.rLevel),a),l=this.checkExpInput(this.control.getValueAtTime(a)),this.control.cancelScheduledValues(a),this.control.exponentialRampToValueAtTime(l,a)):(this.control.linearRampToValueAtTime(this.rLevel,a),l=this.control.getValueAtTime(a),this.control.cancelScheduledValues(a),this.control.linearRampToValueAtTime(l,a)),this.wasTriggered=!1}},p5.Envelope.prototype.ramp=function(i,t,e,n){var a=s.audiocontext.currentTime,l=t||0,d=a+l,y=this.checkExpInput(e),x=typeof n<"u"?this.checkExpInput(n):void 0;i&&this.connection!==i&&this.connect(i);var w=this.checkExpInput(this.control.getValueAtTime(d));y>w?(this.control.setTargetAtTime(y,d,this._rampAttackTC),d+=this._rampAttackTime):y<w&&(this.control.setTargetAtTime(y,d,this._rampDecayTC),d+=this._rampDecayTime),x!==void 0&&(x>y?this.control.setTargetAtTime(x,d,this._rampAttackTC):x<y&&this.control.setTargetAtTime(x,d,this._rampDecayTC))},p5.Envelope.prototype.connect=function(i){this.connection=i,(i instanceof p5.Oscillator||i instanceof p5.SoundFile||i instanceof p5.AudioIn||i instanceof p5.Reverb||i instanceof p5.Noise||i instanceof p5.Filter||i instanceof p5.Delay)&&(i=i.output.gain),i instanceof AudioParam&&i.setValueAtTime(0,s.audiocontext.currentTime),this.output.connect(i)},p5.Envelope.prototype.disconnect=function(){this.output&&this.output.disconnect()},p5.Envelope.prototype.add=function(i){var t=new nt.a(i),e=this.mathOps.length,n=this.output;return p5.prototype._mathChain(this,t,e,n,nt.a)},p5.Envelope.prototype.mult=function(i){var t=new z.a(i),e=this.mathOps.length,n=this.output;return p5.prototype._mathChain(this,t,e,n,z.a)},p5.Envelope.prototype.scale=function(i,t,e,n){var a=new it.a(i,t,e,n),l=this.mathOps.length,d=this.output;return p5.prototype._mathChain(this,a,l,d,it.a)},p5.Envelope.prototype.dispose=function(){var i=s.soundArray.indexOf(this);s.soundArray.splice(i,1),this.disconnect(),this.control&&(this.control.dispose(),this.control=null);for(var t=1;t<this.mathOps.length;t++)this.mathOps[t].dispose()},p5.Env=function(i,t,e,n,a,l){console.warn("WARNING: p5.Env is now deprecated and may be removed in future versions. Please use the new p5.Envelope instead."),p5.Envelope.call(this,i,t,e,n,a,l)},p5.Env.prototype=Object.create(p5.Envelope.prototype);var cn=p5.Envelope,ln=cn;function ut(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ut=function(t){return typeof t}:ut=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(i)}function pn(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function hn(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function fn(i,t,e){return hn(i.prototype,t),i}function dn(i,t){return t&&(ut(t)==="object"||typeof t=="function")?t:mn(i)}function mn(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Vt(i){return Vt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Vt(i)}function yn(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Ft(i,t)}function Ft(i,t){return Ft=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},Ft(i,t)}var Dt=function(){for(var i=2*s.audiocontext.sampleRate,t=s.audiocontext.createBuffer(1,i,s.audiocontext.sampleRate),e=t.getChannelData(0),n=0;n<i;n++)e[n]=Math.random()*2-1;return t.type="white",t}(),ue=function(){var i=2*s.audiocontext.sampleRate,t=s.audiocontext.createBuffer(1,i,s.audiocontext.sampleRate),e=t.getChannelData(0),n,a,l,d,y,x,w;n=a=l=d=y=x=w=0;for(var C=0;C<i;C++){var E=Math.random()*2-1;n=.99886*n+E*.0555179,a=.99332*a+E*.0750759,l=.969*l+E*.153852,d=.8665*d+E*.3104856,y=.55*y+E*.5329522,x=-.7616*x-E*.016898,e[C]=n+a+l+d+y+x+w+E*.5362,e[C]*=.11,w=E*.115926}return t.type="pink",t}(),ce=function(){for(var i=2*s.audiocontext.sampleRate,t=s.audiocontext.createBuffer(1,i,s.audiocontext.sampleRate),e=t.getChannelData(0),n=0,a=0;a<i;a++){var l=Math.random()*2-1;e[a]=(n+.02*l)/1.02,n=e[a],e[a]*=3.5}return t.type="brown",t}(),vn=function(i){yn(t,i);function t(e){var n;pn(this,t),n=dn(this,Vt(t).call(this));var a;return delete n.f,delete n.freq,delete n.oscillator,e==="brown"?a=ce:e==="pink"?a=ue:a=Dt,n.buffer=a,n}return fn(t,[{key:"setType",value:function(e){switch(e){case"white":this.buffer=Dt;break;case"pink":this.buffer=ue;break;case"brown":this.buffer=ce;break;default:this.buffer=Dt}if(this.started){var n=s.audiocontext.currentTime;this.stop(n),this.start(n+.01)}}},{key:"getType",value:function(){return this.buffer.type}},{key:"start",value:function(){this.started&&this.stop(),this.noise=s.audiocontext.createBufferSource(),this.noise.buffer=this.buffer,this.noise.loop=!0,this.noise.connect(this.output);var e=s.audiocontext.currentTime;this.noise.start(e),this.started=!0}},{key:"stop",value:function(){var e=s.audiocontext.currentTime;this.noise&&(this.noise.stop(e),this.started=!1)}},{key:"dispose",value:function(){var e=s.audiocontext.currentTime,n=s.soundArray.indexOf(this);s.soundArray.splice(n,1),this.noise&&(this.noise.disconnect(),this.stop(e)),this.output&&this.output.disconnect(),this.panner&&this.panner.disconnect(),this.output=null,this.panner=null,this.buffer=null,this.noise=null}}]),t}(at),gn=vn,_n=f(2),bn=f.n(_n);function ct(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ct=function(t){return typeof t}:ct=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ct(i)}function Tn(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function wn(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function xn(i,t,e){return wn(i.prototype,t),i}function Sn(i,t){return t&&(ct(t)==="object"||typeof t=="function")?t:kn(i)}function kn(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function It(i){return It=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},It(i)}function Pn(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Ut(i,t)}function Ut(i,t){return Ut=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},Ut(i,t)}var An=function(i){Pn(t,i);function t(e,n){var a;Tn(this,t),a=Sn(this,It(t).call(this,e,"sawtooth")),a.w=n||0,a.osc2=new ae(e),a.dNode=s.audiocontext.createDelay(),a.dcOffset=le(),a.dcGain=s.audiocontext.createGain(),a.dcOffset.connect(a.dcGain),a.dcGain.connect(a.output),a.f=e||440;var l=a.w/a.oscillator.frequency.value;return a.dNode.delayTime.value=l,a.dcGain.gain.value=1.7*(.5-a.w),a.osc2.disconnect(),a.osc2.panner.disconnect(),a.osc2.amp(-1),a.osc2.output.connect(a.dNode),a.dNode.connect(a.output),a.output.gain.value=1,a.output.connect(a.panner),a}return xn(t,[{key:"width",value:function(e){if(typeof e=="number"){if(e<=1&&e>=0){this.w=e;var n=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=n}this.dcGain.gain.value=1.7*(.5-this.w)}else{e.connect(this.dNode.delayTime);var a=new bn.a(-.5);e.connect(a);var l=new z.a(-1),d=new z.a(1.7);a=a.connect(l).connect(d),a.connect(this.dcGain.gain)}}},{key:"start",value:function(e,n){var a=s.audiocontext.currentTime,l=n||0;if(!this.started){var d=e||this.f,y=this.oscillator.type;this.oscillator=s.audiocontext.createOscillator(),this.oscillator.frequency.setValueAtTime(d,a),this.oscillator.type=y,this.oscillator.connect(this.output),this.oscillator.start(l+a),this.osc2.oscillator=s.audiocontext.createOscillator(),this.osc2.oscillator.frequency.setValueAtTime(d,l+a),this.osc2.oscillator.type=y,this.osc2.oscillator.connect(this.osc2.output),this.osc2.start(l+a),this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency],this.dcOffset=le(),this.dcOffset.connect(this.dcGain),this.dcOffset.start(l+a),this.mods!==void 0&&this.mods.frequency!==void 0&&(this.mods.frequency.connect(this.freqNode[0]),this.mods.frequency.connect(this.freqNode[1])),this.started=!0,this.osc2.started=!0}}},{key:"stop",value:function(e){if(this.started){var n=e||0,a=s.audiocontext.currentTime;this.oscillator.stop(n+a),this.osc2.oscillator&&this.osc2.oscillator.stop(n+a),this.dcOffset.stop(n+a),this.started=!1,this.osc2.started=!1}}},{key:"freq",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(typeof e=="number"){this.f=e;var l=s.audiocontext.currentTime,d=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(l),this.oscillator.frequency.setValueAtTime(d,l+a),this.oscillator.frequency.exponentialRampToValueAtTime(e,a+n+l),this.osc2.oscillator.frequency.cancelScheduledValues(l),this.osc2.oscillator.frequency.setValueAtTime(d,l+a),this.osc2.oscillator.frequency.exponentialRampToValueAtTime(e,a+n+l),this.freqMod&&(this.freqMod.output.disconnect(),this.freqMod=null)}else e.output&&(e.output.disconnect(),e.output.connect(this.oscillator.frequency),e.output.connect(this.osc2.oscillator.frequency),this.freqMod=e)}}]),t}(at);function le(){for(var i=s.audiocontext,t=i.createBuffer(1,2048,i.sampleRate),e=t.getChannelData(0),n=0;n<2048;n++)e[n]=1;var a=i.createBufferSource();return a.buffer=t,a.loop=!0,a}var On=An;function Cn(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Rn(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function qn(i,t,e){return Rn(i.prototype,t),i}s.inputSources=[];var En=function(){function i(t){Cn(this,i),this.input=s.audiocontext.createGain(),this.output=s.audiocontext.createGain(),this.stream=null,this.mediaStream=null,this.currentSource=null,this.enabled=!1,this.amplitude=new se,this.output.connect(this.amplitude.input),(!window.MediaStreamTrack||!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia)&&(t?t():window.alert("This browser does not support MediaStreamTrack and mediaDevices")),s.soundArray.push(this)}return qn(i,[{key:"start",value:function(t,e){var n=this;this.stream&&this.stop();var a=s.inputSources[n.currentSource],l={audio:{sampleRate:s.audiocontext.sampleRate,echoCancellation:!1}};s.inputSources[this.currentSource]&&(l.audio.deviceId=a.deviceId),window.navigator.mediaDevices.getUserMedia(l).then(function(d){n.stream=d,n.enabled=!0,n.mediaStream=s.audiocontext.createMediaStreamSource(d),n.mediaStream.connect(n.output),n.amplitude.setInput(n.output),t&&t()}).catch(function(d){e?e(d):console.error(d)})}},{key:"stop",value:function(){this.stream&&(this.stream.getTracks().forEach(function(t){t.stop()}),this.mediaStream.disconnect(),delete this.mediaStream,delete this.stream)}},{key:"connect",value:function(t){t?t.hasOwnProperty("input")?this.output.connect(t.input):t.hasOwnProperty("analyser")?this.output.connect(t.analyser):this.output.connect(t):this.output.connect(s.input)}},{key:"disconnect",value:function(){this.output&&(this.output.disconnect(),this.output.connect(this.amplitude.input))}},{key:"getLevel",value:function(t){return t&&(this.amplitude.smoothing=t),this.amplitude.getLevel()}},{key:"amp",value:function(t,e){if(e){var n=e||0,a=this.output.gain.value;this.output.gain.cancelScheduledValues(s.audiocontext.currentTime),this.output.gain.setValueAtTime(a,s.audiocontext.currentTime),this.output.gain.linearRampToValueAtTime(t,n+s.audiocontext.currentTime)}else this.output.gain.cancelScheduledValues(s.audiocontext.currentTime),this.output.gain.setValueAtTime(t,s.audiocontext.currentTime)}},{key:"getSources",value:function(t,e){return new Promise(function(n,a){window.navigator.mediaDevices.enumerateDevices().then(function(l){s.inputSources=l.filter(function(d){return d.kind==="audioinput"}),n(s.inputSources),t&&t(s.inputSources)}).catch(function(l){a(l),e?e(l):console.error("This browser does not support MediaStreamTrack.getSources()")})})}},{key:"setSource",value:function(t){s.inputSources.length>0&&t<s.inputSources.length?(this.currentSource=t,console.log("set source to ",s.inputSources[this.currentSource])):console.log("unable to set input source"),this.stream&&this.stream.active&&this.start()}},{key:"dispose",value:function(){var t=s.soundArray.indexOf(this);s.soundArray.splice(t,1),this.stop(),this.output&&this.output.disconnect(),this.amplitude&&this.amplitude.disconnect(),delete this.amplitude,delete this.output}}]),i}(),Nn=En,jn=f(23),Bn=f.n(jn);function Mn(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Vn(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Fn(i,t,e){return Vn(i.prototype,t),i}var Dn=function(){function i(){Mn(this,i),this.ac=s.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this._drywet=new Bn.a(1),this.wet=this.ac.createGain(),this.input.connect(this._drywet.a),this.wet.connect(this._drywet.b),this._drywet.connect(this.output),this.connect(),s.soundArray.push(this)}return Fn(i,[{key:"amp",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=s.audiocontext.currentTime,l=a+n,d=l+e+.001,y=this.output.gain.value;this.output.gain.cancelScheduledValues(a),this.output.gain.linearRampToValueAtTime(y,l+.001),this.output.gain.linearRampToValueAtTime(t,d)}},{key:"chain",value:function(){if(arguments.length>0){this.connect(arguments[0]);for(var t=1;t<arguments.length;t+=1)arguments[t-1].connect(arguments[t])}return this}},{key:"drywet",value:function(t){return typeof t<"u"&&(this._drywet.fade.value=t),this._drywet.fade.value}},{key:"connect",value:function(t){var e=t||p5.soundOut.input;this.output.connect(e.input?e.input:e)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"dispose",value:function(){var t=s.soundArray.indexOf(this);s.soundArray.splice(t,1),this.input&&(this.input.disconnect(),delete this.input),this.output&&(this.output.disconnect(),delete this.output),this._drywet&&(this._drywet.disconnect(),delete this._drywet),this.wet&&(this.wet.disconnect(),delete this.wet),this.ac=void 0}}]),i}(),D=Dn;function lt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?lt=function(t){return typeof t}:lt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lt(i)}function pt(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function In(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Un(i,t,e){return In(i.prototype,t),i}function ht(i,t){return t&&(lt(t)==="object"||typeof t=="function")?t:Gn(i)}function Gn(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function ft(i,t,e){return typeof Reflect<"u"&&Reflect.get?ft=Reflect.get:ft=function(n,a,l){var d=Ln(n,a);if(d){var y=Object.getOwnPropertyDescriptor(d,a);return y.get?y.get.call(l):y.value}},ft(i,t,e||i)}function Ln(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&(i=I(i),i!==null););return i}function I(i){return I=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},I(i)}function dt(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&Gt(i,t)}function Gt(i,t){return Gt=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},Gt(i,t)}var mt=function(i){dt(t,i);function t(e){var n;return pt(this,t),n=ht(this,I(t).call(this)),n.biquad=n.ac.createBiquadFilter(),n.input.connect(n.biquad),n.biquad.connect(n.wet),e&&n.setType(e),n._on=!0,n._untoggledType=n.biquad.type,n}return Un(t,[{key:"process",value:function(e,n,a,l){e.connect(this.input),this.set(n,a,l)}},{key:"set",value:function(e,n,a){e&&this.freq(e,a),n&&this.res(n,a)}},{key:"freq",value:function(e,n){var a=n||0;return e<=0&&(e=1),typeof e=="number"?(this.biquad.frequency.cancelScheduledValues(this.ac.currentTime+.01+a),this.biquad.frequency.exponentialRampToValueAtTime(e,this.ac.currentTime+.02+a)):e&&e.connect(this.biquad.frequency),this.biquad.frequency.value}},{key:"res",value:function(e,n){var a=n||0;return typeof e=="number"?(this.biquad.Q.value=e,this.biquad.Q.cancelScheduledValues(this.ac.currentTime+.01+a),this.biquad.Q.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):e&&e.connect(this.biquad.Q),this.biquad.Q.value}},{key:"gain",value:function(e,n){var a=n||0;return typeof e=="number"?(this.biquad.gain.value=e,this.biquad.gain.cancelScheduledValues(this.ac.currentTime+.01+a),this.biquad.gain.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):e&&e.connect(this.biquad.gain),this.biquad.gain.value}},{key:"toggle",value:function(){return this._on=!this._on,this._on===!0?this.biquad.type=this._untoggledType:this._on===!1&&(this.biquad.type="allpass"),this._on}},{key:"setType",value:function(e){this.biquad.type=e,this._untoggledType=this.biquad.type}},{key:"dispose",value:function(){ft(I(t.prototype),"dispose",this).call(this),this.biquad&&(this.biquad.disconnect(),delete this.biquad)}}]),t}(D),zn=function(i){dt(t,i);function t(){return pt(this,t),ht(this,I(t).call(this,"lowpass"))}return t}(mt),Wn=function(i){dt(t,i);function t(){return pt(this,t),ht(this,I(t).call(this,"highpass"))}return t}(mt),Zn=function(i){dt(t,i);function t(){return pt(this,t),ht(this,I(t).call(this,"bandpass"))}return t}(mt),yt=mt;function vt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vt=function(t){return typeof t}:vt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vt(i)}function Xn(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Yn(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Hn(i,t,e){return Yn(i.prototype,t),i}function $n(i,t){return t&&(vt(t)==="object"||typeof t=="function")?t:Qn(i)}function Qn(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Lt(i){return Lt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Lt(i)}function Jn(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),zt(i,t)}function zt(i,t){return zt=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},zt(i,t)}var Kn=function(i){Jn(t,i);function t(e,n){var a;return Xn(this,t),a=$n(this,Lt(t).call(this,"peaking")),a.disconnect(),a.set(e,n),a.biquad.gain.value=0,delete a.input,delete a.output,delete a._drywet,delete a.wet,a}return Hn(t,[{key:"amp",value:function(){console.warn("`amp()` is not available for p5.EQ bands. Use `.gain()`")}},{key:"drywet",value:function(){console.warn("`drywet()` is not available for p5.EQ bands.")}},{key:"connect",value:function(e){var n=e||p5.soundOut.input;this.biquad?this.biquad.connect(n.input?n.input:n):this.output.connect(n.input?n.input:n)}},{key:"disconnect",value:function(){this.biquad&&this.biquad.disconnect()}},{key:"dispose",value:function(){var e=s.soundArray.indexOf(this);s.soundArray.splice(e,1),this.disconnect(),delete this.biquad}}]),t}(yt),ti=Kn;function gt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?gt=function(t){return typeof t}:gt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gt(i)}function ei(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function ni(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function ii(i,t,e){return ni(i.prototype,t),i}function ri(i,t){return t&&(gt(t)==="object"||typeof t=="function")?t:oi(i)}function oi(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function _t(i,t,e){return typeof Reflect<"u"&&Reflect.get?_t=Reflect.get:_t=function(n,a,l){var d=si(n,a);if(d){var y=Object.getOwnPropertyDescriptor(d,a);return y.get?y.get.call(l):y.value}},_t(i,t,e||i)}function si(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&(i=Y(i),i!==null););return i}function Y(i){return Y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Y(i)}function ai(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Wt(i,t)}function Wt(i,t){return Wt=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},Wt(i,t)}var ui=function(i){ai(t,i);function t(e){var n;ei(this,t),n=ri(this,Y(t).call(this)),e=e===3||e===8?e:3;var a;e===3?a=Math.pow(2,3):a=2,n.bands=[];for(var l,d,y=0;y<e;y++)y===e-1?(l=21e3,d=.01):y===0?(l=100,d=.1):y===1?(l=e===3?360*a:360,d=1):(l=n.bands[y-1].freq()*a,d=1),n.bands[y]=n._newBand(l,d),y>0?n.bands[y-1].connect(n.bands[y].biquad):n.input.connect(n.bands[y].biquad);return n.bands[e-1].connect(n.output),n}return ii(t,[{key:"process",value:function(e){e.connect(this.input)}},{key:"set",value:function(){if(arguments.length===this.bands.length*2)for(var e=0;e<arguments.length;e+=2)this.bands[e/2].freq(arguments[e]),this.bands[e/2].gain(arguments[e+1]);else console.error("Argument mismatch. .set() should be called with "+this.bands.length*2+" arguments. (one frequency and gain value pair for each band of the eq)")}},{key:"_newBand",value:function(e,n){return new ti(e,n)}},{key:"dispose",value:function(){if(_t(Y(t.prototype),"dispose",this).call(this),this.bands){for(;this.bands.length>0;)delete this.bands.pop().dispose();delete this.bands}}}]),t}(D),ci=ui;function li(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function pi(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function hi(i,t,e){return pi(i.prototype,t),i}var fi=function(){function i(t){li(this,i),this.ac=s.audiocontext,this.listener=this.ac.listener}return hi(i,[{key:"process",value:function(t){t.connect(this.input)}},{key:"position",value:function(t,e,n,a){return this.positionX(t,a),this.positionY(e,a),this.positionZ(n,a),[this.listener.positionX.value,this.listener.positionY.value,this.listener.positionZ.value]}},{key:"positionX",value:function(t,e){var n=e||0;return typeof t=="number"?(this.listener.positionX.value=t,this.listener.positionX.cancelScheduledValues(this.ac.currentTime+.01+n),this.listener.positionX.linearRampToValueAtTime(t,this.ac.currentTime+.02+n)):t&&t.connect(this.listener.positionX),this.listener.positionX.value}},{key:"positionY",value:function(t,e){var n=e||0;return typeof t=="number"?(this.listener.positionY.value=t,this.listener.positionY.cancelScheduledValues(this.ac.currentTime+.01+n),this.listener.positionY.linearRampToValueAtTime(t,this.ac.currentTime+.02+n)):t&&t.connect(this.listener.positionY),this.listener.positionY.value}},{key:"positionZ",value:function(t,e){var n=e||0;return typeof t=="number"?(this.listener.positionZ.value=t,this.listener.positionZ.cancelScheduledValues(this.ac.currentTime+.01+n),this.listener.positionZ.linearRampToValueAtTime(t,this.ac.currentTime+.02+n)):t&&t.connect(this.listener.positionZ),this.listener.positionZ.value}},{key:"orient",value:function(t,e,n,a,l,d,y){return arguments.length===3||arguments.length===4?(y=arguments[3],this.orientForward(t,e,n,y)):(arguments.length===6||arguments===7)&&(this.orientForward(t,e,n),this.orientUp(a,l,d,y)),[this.listener.forwardX.value,this.listener.forwardY.value,this.listener.forwardZ.value,this.listener.upX.value,this.listener.upY.value,this.listener.upZ.value]}},{key:"orientForward",value:function(t,e,n,a){return this.forwardX(t,a),this.forwardY(e,a),this.forwardZ(n,a),[this.listener.forwardX,this.listener.forwardY,this.listener.forwardZ]}},{key:"orientUp",value:function(t,e,n,a){return this.upX(t,a),this.upY(e,a),this.upZ(n,a),[this.listener.upX,this.listener.upY,this.listener.upZ]}},{key:"forwardX",value:function(t,e){var n=e||0;return typeof t=="number"?(this.listener.forwardX.value=t,this.listener.forwardX.cancelScheduledValues(this.ac.currentTime+.01+n),this.listener.forwardX.linearRampToValueAtTime(t,this.ac.currentTime+.02+n)):t&&t.connect(this.listener.forwardX),this.listener.forwardX.value}},{key:"forwardY",value:function(t,e){var n=e||0;return typeof t=="number"?(this.listener.forwardY.value=t,this.listener.forwardY.cancelScheduledValues(this.ac.currentTime+.01+n),this.listener.forwardY.linearRampToValueAtTime(t,this.ac.currentTime+.02+n)):t&&t.connect(this.listener.forwardY),this.listener.forwardY.value}},{key:"forwardZ",value:function(t,e){var n=e||0;return typeof t=="number"?(this.listener.forwardZ.value=t,this.listener.forwardZ.cancelScheduledValues(this.ac.currentTime+.01+n),this.listener.forwardZ.linearRampToValueAtTime(t,this.ac.currentTime+.02+n)):t&&t.connect(this.listener.forwardZ),this.listener.forwardZ.value}},{key:"upX",value:function(t,e){var n=e||0;return typeof t=="number"?(this.listener.upX.value=t,this.listener.upX.cancelScheduledValues(this.ac.currentTime+.01+n),this.listener.upX.linearRampToValueAtTime(t,this.ac.currentTime+.02+n)):t&&t.connect(this.listener.upX),this.listener.upX.value}},{key:"upY",value:function(t,e){var n=e||0;return typeof t=="number"?(this.listener.upY.value=t,this.listener.upY.cancelScheduledValues(this.ac.currentTime+.01+n),this.listener.upY.linearRampToValueAtTime(t,this.ac.currentTime+.02+n)):t&&t.connect(this.listener.upY),this.listener.upY.value}},{key:"upZ",value:function(t,e){var n=e||0;return typeof t=="number"?(this.listener.upZ.value=t,this.listener.upZ.cancelScheduledValues(this.ac.currentTime+.01+n),this.listener.upZ.linearRampToValueAtTime(t,this.ac.currentTime+.02+n)):t&&t.connect(this.listener.upZ),this.listener.upZ.value}}]),i}(),di=fi;function bt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?bt=function(t){return typeof t}:bt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bt(i)}function mi(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function yi(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function vi(i,t,e){return yi(i.prototype,t),i}function gi(i,t){return t&&(bt(t)==="object"||typeof t=="function")?t:_i(i)}function _i(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Tt(i,t,e){return typeof Reflect<"u"&&Reflect.get?Tt=Reflect.get:Tt=function(n,a,l){var d=bi(n,a);if(d){var y=Object.getOwnPropertyDescriptor(d,a);return y.get?y.get.call(l):y.value}},Tt(i,t,e||i)}function bi(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&(i=H(i),i!==null););return i}function H(i){return H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},H(i)}function Ti(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Zt(i,t)}function Zt(i,t){return Zt=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},Zt(i,t)}var wi=function(i){Ti(t,i);function t(){var e;return mi(this,t),e=gi(this,H(t).call(this)),e.panner=e.ac.createPanner(),e.panner.panningModel="HRTF",e.panner.distanceModel="linear",e.panner.connect(e.output),e.input.connect(e.panner),e}return vi(t,[{key:"process",value:function(e){e.connect(this.input)}},{key:"set",value:function(e,n,a,l){return this.positionX(e,l),this.positionY(n,l),this.positionZ(a,l),[this.panner.positionX.value,this.panner.positionY.value,this.panner.positionZ.value]}},{key:"positionX",value:function(e,n){var a=n||0;return typeof e=="number"?(this.panner.positionX.value=e,this.panner.positionX.cancelScheduledValues(this.ac.currentTime+.01+a),this.panner.positionX.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):e&&e.connect(this.panner.positionX),this.panner.positionX.value}},{key:"positionY",value:function(e,n){var a=n||0;return typeof e=="number"?(this.panner.positionY.value=e,this.panner.positionY.cancelScheduledValues(this.ac.currentTime+.01+a),this.panner.positionY.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):e&&e.connect(this.panner.positionY),this.panner.positionY.value}},{key:"positionZ",value:function(e,n){var a=n||0;return typeof e=="number"?(this.panner.positionZ.value=e,this.panner.positionZ.cancelScheduledValues(this.ac.currentTime+.01+a),this.panner.positionZ.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):e&&e.connect(this.panner.positionZ),this.panner.positionZ.value}},{key:"orient",value:function(e,n,a,l){return this.orientX(e,l),this.orientY(n,l),this.orientZ(a,l),[this.panner.orientationX.value,this.panner.orientationY.value,this.panner.orientationZ.value]}},{key:"orientX",value:function(e,n){var a=n||0;return typeof e=="number"?(this.panner.orientationX.value=e,this.panner.orientationX.cancelScheduledValues(this.ac.currentTime+.01+a),this.panner.orientationX.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):e&&e.connect(this.panner.orientationX),this.panner.orientationX.value}},{key:"orientY",value:function(e,n){var a=n||0;return typeof e=="number"?(this.panner.orientationY.value=e,this.panner.orientationY.cancelScheduledValues(this.ac.currentTime+.01+a),this.panner.orientationY.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):e&&e.connect(this.panner.orientationY),this.panner.orientationY.value}},{key:"orientZ",value:function(e,n){var a=n||0;return typeof e=="number"?(this.panner.orientationZ.value=e,this.panner.orientationZ.cancelScheduledValues(this.ac.currentTime+.01+a),this.panner.orientationZ.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):e&&e.connect(this.panner.orientationZ),this.panner.orientationZ.value}},{key:"setFalloff",value:function(e,n){this.maxDist(e),this.rolloff(n)}},{key:"maxDist",value:function(e){return typeof e=="number"&&(this.panner.maxDistance=e),this.panner.maxDistance}},{key:"rolloff",value:function(e){return typeof e=="number"&&(this.panner.rolloffFactor=e),this.panner.rolloffFactor}},{key:"dispose",value:function(){Tt(H(t.prototype),"dispose",this).call(this),this.panner&&(this.panner.disconnect(),delete this.panner)}}]),t}(D),xi=wi;function wt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?wt=function(t){return typeof t}:wt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wt(i)}function Si(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function ki(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Pi(i,t,e){return ki(i.prototype,t),i}function Ai(i,t){return t&&(wt(t)==="object"||typeof t=="function")?t:Oi(i)}function Oi(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function xt(i,t,e){return typeof Reflect<"u"&&Reflect.get?xt=Reflect.get:xt=function(n,a,l){var d=Ci(n,a);if(d){var y=Object.getOwnPropertyDescriptor(d,a);return y.get?y.get.call(l):y.value}},xt(i,t,e||i)}function Ci(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&(i=$(i),i!==null););return i}function $(i){return $=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},$(i)}function Ri(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Xt(i,t)}function Xt(i,t){return Xt=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},Xt(i,t)}var qi=function(i){Ri(t,i);function t(){var e;return Si(this,t),e=Ai(this,$(t).call(this)),e._split=e.ac.createChannelSplitter(2),e._merge=e.ac.createChannelMerger(2),e._leftGain=e.ac.createGain(),e._rightGain=e.ac.createGain(),e.leftDelay=e.ac.createDelay(),e.rightDelay=e.ac.createDelay(),e._leftFilter=new yt,e._rightFilter=new yt,e._leftFilter.disconnect(),e._rightFilter.disconnect(),e._leftFilter.biquad.frequency.setValueAtTime(1200,e.ac.currentTime),e._rightFilter.biquad.frequency.setValueAtTime(1200,e.ac.currentTime),e._leftFilter.biquad.Q.setValueAtTime(.3,e.ac.currentTime),e._rightFilter.biquad.Q.setValueAtTime(.3,e.ac.currentTime),e.input.connect(e._split),e.leftDelay.connect(e._leftGain),e.rightDelay.connect(e._rightGain),e._leftGain.connect(e._leftFilter.input),e._rightGain.connect(e._rightFilter.input),e._merge.connect(e.wet),e._leftFilter.biquad.gain.setValueAtTime(1,e.ac.currentTime),e._rightFilter.biquad.gain.setValueAtTime(1,e.ac.currentTime),e.setType(0),e._maxDelay=e.leftDelay.delayTime.maxValue,e.feedback(.5),e}return Pi(t,[{key:"process",value:function(e,n,a,l){var d=a||0,y=n||0;if(d>=1)throw new Error("Feedback value will force a positive feedback loop.");if(y>=this._maxDelay)throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.");e.connect(this.input),this.leftDelay.delayTime.setValueAtTime(y,this.ac.currentTime),this.rightDelay.delayTime.setValueAtTime(y,this.ac.currentTime),this._leftGain.gain.value=d,this._rightGain.gain.value=d,l&&(this._leftFilter.freq(l),this._rightFilter.freq(l))}},{key:"delayTime",value:function(e){typeof e!="number"?(e.connect(this.leftDelay.delayTime),e.connect(this.rightDelay.delayTime)):(this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.leftDelay.delayTime.linearRampToValueAtTime(e,this.ac.currentTime),this.rightDelay.delayTime.linearRampToValueAtTime(e,this.ac.currentTime))}},{key:"feedback",value:function(e){if(e&&typeof e!="number")e.connect(this._leftGain.gain),e.connect(this._rightGain.gain);else{if(e>=1)throw new Error("Feedback value will force a positive feedback loop.");typeof e=="number"&&(this._leftGain.gain.value=e,this._rightGain.gain.value=e)}return this._leftGain.gain.value}},{key:"filter",value:function(e,n){this._leftFilter.set(e,n),this._rightFilter.set(e,n)}},{key:"setType",value:function(e){switch(e===1&&(e="pingPong"),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._split.connect(this.leftDelay,0),this._split.connect(this.rightDelay,1),e){case"pingPong":this._rightFilter.setType(this._leftFilter.biquad.type),this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.rightDelay),this._rightFilter.output.connect(this.leftDelay);break;default:this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.leftDelay),this._rightFilter.output.connect(this.rightDelay)}}},{key:"dispose",value:function(){xt($(t.prototype),"dispose",this).call(this),this._split.disconnect(),this._leftFilter.dispose(),this._rightFilter.dispose(),this._merge.disconnect(),this._leftGain.disconnect(),this._rightGain.disconnect(),this.leftDelay.disconnect(),this.rightDelay.disconnect(),this._split=void 0,this._leftFilter=void 0,this._rightFilter=void 0,this._merge=void 0,this._leftGain=void 0,this._rightGain=void 0,this.leftDelay=void 0,this.rightDelay=void 0}}]),t}(D),Ei=qi;function St(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?St=function(t){return typeof t}:St=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},St(i)}function pe(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Ni(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function he(i,t,e){return t&&Ni(i.prototype,t),i}function fe(i,t){return t&&(St(t)==="object"||typeof t=="function")?t:ji(i)}function ji(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Q(i,t,e){return typeof Reflect<"u"&&Reflect.get?Q=Reflect.get:Q=function(n,a,l){var d=Bi(n,a);if(d){var y=Object.getOwnPropertyDescriptor(d,a);return y.get?y.get.call(l):y.value}},Q(i,t,e||i)}function Bi(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&(i=G(i),i!==null););return i}function G(i){return G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},G(i)}function de(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&Yt(i,t)}function Yt(i,t){return Yt=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},Yt(i,t)}var me=function(i){de(t,i);function t(){var e;return pe(this,t),e=fe(this,G(t).call(this)),e._initConvolverNode(),e.input.gain.value=.5,e._seconds=3,e._decay=2,e._reverse=!1,e._buildImpulse(),e}return he(t,[{key:"_initConvolverNode",value:function(){this.convolverNode=this.ac.createConvolver(),this.input.connect(this.convolverNode),this.convolverNode.connect(this.wet)}},{key:"_teardownConvolverNode",value:function(){this.convolverNode&&(this.convolverNode.disconnect(),delete this.convolverNode)}},{key:"_setBuffer",value:function(e){this._teardownConvolverNode(),this._initConvolverNode(),this.convolverNode.buffer=e}},{key:"process",value:function(e,n,a,l){e.connect(this.input);var d=!1;n&&(this._seconds=n,d=!0),a&&(this._decay=a),l&&(this._reverse=l),d&&this._buildImpulse()}},{key:"set",value:function(e,n,a){var l=!1;e&&(this._seconds=e,l=!0),n&&(this._decay=n),a&&(this._reverse=a),l&&this._buildImpulse()}},{key:"_buildImpulse",value:function(){var e=this.ac.sampleRate,n=e*this._seconds,a=this._decay,l=this.ac.createBuffer(2,n,e),d=l.getChannelData(0),y=l.getChannelData(1),x,w;for(w=0;w<n;w++)x=this._reverse?n-w:w,d[w]=(Math.random()*2-1)*Math.pow(1-x/n,a),y[w]=(Math.random()*2-1)*Math.pow(1-x/n,a);this._setBuffer(l)}},{key:"dispose",value:function(){Q(G(t.prototype),"dispose",this).call(this),this._teardownConvolverNode()}}]),t}(D),ye=function(i){de(t,i);function t(e,n,a){var l;return pe(this,t),l=fe(this,G(t).call(this)),l._initConvolverNode(),l.input.gain.value=.5,e?(l.impulses=[],l._loadBuffer(e,n,a)):(l._seconds=3,l._decay=2,l._reverse=!1,l._buildImpulse()),l.impulses=[],l.set=null,l}return he(t,[{key:"_loadBuffer",value:function(e,n,a){var l=p5.prototype._checkFileFormats(e),d=this,y=new Error().stack,x=Object(v.b)(),w=new XMLHttpRequest;w.open("GET",l,!0),w.responseType="arraybuffer",w.onload=function(){if(w.status===200)x.decodeAudioData(w.response,function(V){var N={},U=l.split("/");N.name=U[U.length-1],N.audioBuffer=V,d.impulses.push(N),d._setBuffer(N.audioBuffer),n&&n(N)},function(){var V=new L("decodeAudioData",y,d.url),N="AudioContext error at decodeAudioData for "+d.url;a?(V.msg=N,a(V)):console.error(N+`
 The error stack trace includes: 
`+V.stack)});else{var C=new L("loadConvolver",y,d.url),E="Unable to load "+d.url+". The request status was: "+w.status+" ("+w.statusText+")";a?(C.message=E,a(C)):console.error(E+`
 The error stack trace includes: 
`+C.stack)}},w.onerror=function(){var C=new L("loadConvolver",y,d.url),E="There was no response from the server at "+d.url+". Check the url and internet connectivity.";a?(C.message=E,a(C)):console.error(E+`
 The error stack trace includes: 
`+C.stack)},w.send()}},{key:"process",value:function(e){e.connect(this.input)}},{key:"addImpulse",value:function(e,n,a){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this._loadBuffer(e,n,a)}},{key:"resetImpulse",value:function(e,n,a){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this.impulses=[],this._loadBuffer(e,n,a)}},{key:"toggleImpulse",value:function(e){if(typeof e=="number"&&e<this.impulses.length&&this._setBuffer(this.impulses[e].audioBuffer),typeof e=="string"){for(var n=0;n<this.impulses.length;n++)if(this.impulses[n].name===e){this._setBuffer(this.impulses[n].audioBuffer);break}}}},{key:"dispose",value:function(){Q(G(t.prototype),"dispose",this).call(this);for(var e in this.impulses)this.impulses[e]&&(this.impulses[e]=null)}}]),t}(me);function Mi(i,t,e){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var n=this,a=new ye(i,function(l){typeof t=="function"&&t(l),typeof n._decrementPreload=="function"&&n._decrementPreload()},e);return a.impulses=[],a}var Vi=f(11),ve=f.n(Vi);function Fi(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Di(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Ii(i,t,e){return Di(i.prototype,t),i}var Ui=function(){function i(){Fi(this,i),this.clock=new ve.a({callback:this.ontick.bind(this)}),this.syncedParts=[],this.bpm=120,this._init(),this.prevTick=0,this.tatumTime=0,this.tickCallback=function(){}}return Ii(i,[{key:"ontick",value:function(t){var e=t-this.prevTick,n=t-s.audiocontext.currentTime;if(!(e-this.tatumTime<=-.02)){this.prevTick=t;var a=this;this.syncedParts.forEach(function(l){l.isPlaying&&(l.incrementStep(n),l.phrases.forEach(function(d){var y=d.sequence,x=a.metroTicks%y.length;y[x]!==0&&(a.metroTicks<y.length||!d.looping)&&d.callback(n,y[x])}))}),this.metroTicks+=1,this.tickCallback(n)}}},{key:"setBPM",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=60/(t*this.tatums),a=s.audiocontext.currentTime;this.tatumTime=n,this.clock.frequency.setValueAtTime(this.clock.frequency.value,a),this.clock.frequency.linearRampToValueAtTime(t,a+e),this.bpm=t}},{key:"getBPM",value:function(){return this.clock.getRate()/this.tatums*60}},{key:"_init",value:function(){this.metroTicks=0}},{key:"resetSync",value:function(t){this.syncedParts=[t]}},{key:"pushSync",value:function(t){this.syncedParts.push(t)}},{key:"start",value:function(t){var e=t||0,n=s.audiocontext.currentTime;this.clock.start(n+e),this.setBPM(this.bpm)}},{key:"stop",value:function(t){var e=t||0,n=s.audiocontext.currentTime;this.clock.stop(n+e)}},{key:"beatLength",value:function(t){this.tatums=1/t/4}}]),i}(),ge=Ui;function Gi(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function _e(i,t,e){return t&&Gi(i.prototype,t),i}function Ht(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var be=120;p5.prototype.setBPM=function(i,t){be=i;for(var e in s.parts)s.parts[e]&&s.parts[e].setBPM(i,t)};var $t=function i(t,e,n){Ht(this,i),this.phraseStep=0,this.name=t,this.callback=e,this.sequence=n},Li=function(){function i(t,e){Ht(this,i),this.length=t||0,this.partStep=0,this.phrases=[],this.isPlaying=!1,this.noLoop(),this.tatums=e||.0625,this.metro=new ge,this.metro._init(),this.metro.beatLength(this.tatums),this.metro.setBPM(be),s.parts.push(this),this.callback=function(){}}return _e(i,[{key:"setBPM",value:function(t,e){this.metro.setBPM(t,e)}},{key:"getBPM",value:function(){return this.metro.getBPM()}},{key:"start",value:function(t){if(!this.isPlaying){this.isPlaying=!0,this.metro.resetSync(this);var e=t||0;this.metro.start(e)}}},{key:"loop",value:function(t){this.looping=!0,this.onended=function(){this.partStep=0};var e=t||0;this.start(e)}},{key:"noLoop",value:function(){this.looping=!1,this.onended=function(){this.stop()}}},{key:"stop",value:function(t){this.partStep=0,this.pause(t)}},{key:"pause",value:function(t){this.isPlaying=!1;var e=t||0;this.metro.stop(e)}},{key:"addPhrase",value:function(t,e,n){var a;if(arguments.length===3)a=new $t(t,e,n);else if(arguments[0]instanceof $t)a=arguments[0];else throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase";this.phrases.push(a),a.sequence.length>this.length&&(this.length=a.sequence.length)}},{key:"removePhrase",value:function(t){for(var e in this.phrases)this.phrases[e].name===t&&this.phrases.splice(e,1)}},{key:"getPhrase",value:function(t){for(var e in this.phrases)if(this.phrases[e].name===t)return this.phrases[e]}},{key:"replaceSequence",value:function(t,e){for(var n in this.phrases)this.phrases[n].name===t&&(this.phrases[n].sequence=e)}},{key:"incrementStep",value:function(t){this.partStep<this.length-1?(this.callback(t),this.partStep+=1):!this.looping&&this.partStep===this.length-1&&this.onended()}},{key:"onStep",value:function(t){this.callback=t}}]),i}(),zi=function(){function i(){Ht(this,i),this.parts=[],this.currentPart=new Array(arguments.length);var t=this;for(var e in arguments)this.parts[e]=arguments[e],this.parts[e].nextPart=this.parts[e+1],this.parts[e].onended=function(){t.resetPart(e),Wi(t)};this.looping=!1}return _e(i,[{key:"onended",value:function(){this.looping?this.parts[0].start():this.parts[this.parts.length-1].onended=function(){this.stop(),this.resetParts()},this.currentPart=0}},{key:"start",value:function(){this.parts[this.currentPart].start(),this.scoreStep=0}},{key:"stop",value:function(){this.parts[this.currentPart].stop(),this.currentPart=0,this.scoreStep=0}},{key:"pause",value:function(){this.parts[this.currentPart].stop()}},{key:"loop",value:function(){this.looping=!0,this.start()}},{key:"noLoop",value:function(){this.looping=!1}},{key:"resetParts",value:function(){var t=this;this.parts.forEach(function(e){t.resetParts[e]})}},{key:"resetPart",value:function(t){this.parts[t].stop(),this.parts[t].partStep=0;for(var e in this.parts[t].phrases)this.parts[t]&&(this.parts[t].phrases[e].phraseStep=0)}},{key:"setBPM",value:function(t,e){for(var n in this.parts)this.parts[n]&&this.parts[n].setBPM(t,e)}}]),i}();function Wi(i){i.currentPart++,i.currentPart>=i.parts.length?(i.scoreStep=0,i.onended()):(i.scoreStep=0,i.parts[i.currentPart-1].stop(),i.parts[i.currentPart].start())}function Zi(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Xi(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Yi(i,t,e){return Xi(i.prototype,t),i}var Hi=function(){function i(t,e){Zi(this,i),Object.defineProperty(this,"bpm",{get:function(){return this._bpm},set:function(a){this.musicalTimeMode||console.warn('Changing the BPM in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)'),this._bpm=a,this._update()}}),Object.defineProperty(this,"timeSignature",{get:function(){return this._timeSignature},set:function(a){this.musicalTimeMode||console.warn('Changing the timeSignature in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)'),this._timeSignature=a,this._update()}}),Object.defineProperty(this,"interval",{get:function(){return this._interval},set:function(a){this.musicalTimeMode=typeof a!="number",this._interval=a,this._update()}}),Object.defineProperty(this,"iterations",{get:function(){return this.clock.ticks}}),this.callback=t,this.musicalTimeMode=typeof this._interval!="number",this._interval=e||1,this._timeSignature=4,this._bpm=60,this.isPlaying=!1,this.maxIterations=1/0;var n=this;this.clock=new ve.a({callback:function(a){var l=a-s.audiocontext.currentTime;l>0&&n.iterations<=n.maxIterations&&n.callback(l)},frequency:this._calcFreq()})}return Yi(i,[{key:"start",value:function(t){var e=t||0,n=s.audiocontext.currentTime;this.isPlaying||(this.clock.start(n+e),this.isPlaying=!0)}},{key:"stop",value:function(t){var e=t||0,n=s.audiocontext.currentTime;this.isPlaying&&(this.clock.stop(n+e),this.isPlaying=!1)}},{key:"pause",value:function(t){var e=t||0,n=s.audiocontext.currentTime;this.isPlaying&&(this.clock.pause(n+e),this.isPlaying=!1)}},{key:"syncedStart",value:function(t,e){var n=e||0,a=s.audiocontext.currentTime;if(!t.isPlaying)t.clock.start(a+n),t.isPlaying=!0,this.clock.start(a+n),this.isPlaying=!0;else if(t.isPlaying){var l=t.clock._nextTick-s.audiocontext.currentTime;this.clock.start(a+l),this.isPlaying=!0}}},{key:"_update",value:function(){this.clock.frequency.value=this._calcFreq()}},{key:"_calcFreq",value:function(){if(typeof this._interval=="number")return this.musicalTimeMode=!1,1/this._interval;if(typeof this._interval=="string")return this.musicalTimeMode=!0,this._bpm/60/this._convertNotation(this._interval)*(this._timeSignature/4)}},{key:"_convertNotation",value:function(t){var e=t.slice(-1);switch(t=Number(t.slice(0,-1)),e){case"m":return this._measure(t);case"n":return this._note(t);default:console.warn("Specified interval is not formatted correctly. See Tone.js timing reference for more info: https://github.com/Tonejs/Tone.js/wiki/Time")}}},{key:"_measure",value:function(t){return t*this._timeSignature}},{key:"_note",value:function(t){return this._timeSignature/t}}]),i}(),$i=Hi;function kt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?kt=function(t){return typeof t}:kt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(i)}function Qi(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Ji(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Ki(i,t,e){return Ji(i.prototype,t),i}function tr(i,t){return t&&(kt(t)==="object"||typeof t=="function")?t:er(i)}function er(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Pt(i,t,e){return typeof Reflect<"u"&&Reflect.get?Pt=Reflect.get:Pt=function(n,a,l){var d=nr(n,a);if(d){var y=Object.getOwnPropertyDescriptor(d,a);return y.get?y.get.call(l):y.value}},Pt(i,t,e||i)}function nr(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&(i=J(i),i!==null););return i}function J(i){return J=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},J(i)}function ir(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Qt(i,t)}function Qt(i,t){return Qt=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},Qt(i,t)}var rr=function(i){ir(t,i);function t(){var e;return Qi(this,t),e=tr(this,J(t).call(this)),e.compressor=e.ac.createDynamicsCompressor(),e.input.connect(e.compressor),e.compressor.connect(e.wet),e}return Ki(t,[{key:"process",value:function(e,n,a,l,d,y){e.connect(this.input),this.set(n,a,l,d,y)}},{key:"set",value:function(e,n,a,l,d){typeof e<"u"&&this.attack(e),typeof n<"u"&&this.knee(n),typeof a<"u"&&this.ratio(a),typeof l<"u"&&this.threshold(l),typeof d<"u"&&this.release(d)}},{key:"attack",value:function(e,n){var a=n||0;return typeof e=="number"?(this.compressor.attack.value=e,this.compressor.attack.cancelScheduledValues(this.ac.currentTime+.01+a),this.compressor.attack.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):typeof e<"u"&&e.connect(this.compressor.attack),this.compressor.attack.value}},{key:"knee",value:function(e,n){var a=n||0;return typeof e=="number"?(this.compressor.knee.value=e,this.compressor.knee.cancelScheduledValues(this.ac.currentTime+.01+a),this.compressor.knee.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):typeof e<"u"&&e.connect(this.compressor.knee),this.compressor.knee.value}},{key:"ratio",value:function(e,n){var a=n||0;return typeof e=="number"?(this.compressor.ratio.value=e,this.compressor.ratio.cancelScheduledValues(this.ac.currentTime+.01+a),this.compressor.ratio.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):typeof e<"u"&&e.connect(this.compressor.ratio),this.compressor.ratio.value}},{key:"threshold",value:function(e,n){var a=n||0;return typeof e=="number"?(this.compressor.threshold.value=e,this.compressor.threshold.cancelScheduledValues(this.ac.currentTime+.01+a),this.compressor.threshold.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):typeof e<"u"&&e.connect(this.compressor.threshold),this.compressor.threshold.value}},{key:"release",value:function(e,n){var a=n||0;return typeof e=="number"?(this.compressor.release.value=e,this.compressor.release.cancelScheduledValues(this.ac.currentTime+.01+a),this.compressor.release.linearRampToValueAtTime(e,this.ac.currentTime+.02+a)):typeof number<"u"&&e.connect(this.compressor.release),this.compressor.release.value}},{key:"reduction",value:function(){return this.compressor.reduction.value}},{key:"dispose",value:function(){Pt(J(t.prototype),"dispose",this).call(this),this.compressor&&(this.compressor.disconnect(),delete this.compressor)}}]),t}(D),or=rr;function sr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function ar(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function ur(i,t,e){return ar(i.prototype,t),i}var cr=function(){function i(t,e,n,a){sr(this,i),this.framesPerPeak=a||20,this.framesSinceLastPeak=0,this.decayRate=.95,this.threshold=n||.35,this.cutoff=0,this.cutoffMult=1.5,this.energy=0,this.penergy=0,this.currentValue=0,this.isDetected=!1,this.f1=t||40,this.f2=e||2e4,this._onPeak=function(){}}return ur(i,[{key:"update",value:function(t){var e=this.energy=t.getEnergy(this.f1,this.f2)/255;e>this.cutoff&&e>this.threshold&&e-this.penergy>0?(this._onPeak(),this.isDetected=!0,this.cutoff=e*this.cutoffMult,this.framesSinceLastPeak=0):(this.isDetected=!1,this.framesSinceLastPeak<=this.framesPerPeak?this.framesSinceLastPeak++:(this.cutoff*=this.decayRate,this.cutoff=Math.max(this.cutoff,this.threshold))),this.currentValue=e,this.penergy=e}},{key:"onPeak",value:function(t,e){var n=this;n._onPeak=function(){t(n.energy,e)}}}]),i}(),Te=cr;function lr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function pr(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function hr(i,t,e){return pr(i.prototype,t),i}var At=s.audiocontext,fr=function(){function i(){lr(this,i),this.input=At.createGain(),this.output=At.createGain(),this._inputChannels=2,this._outputChannels=2;var t=B(1024);this._workletNode=new AudioWorkletNode(At,c.a.recorderProcessor,{outputChannelCount:[this._outputChannels],processorOptions:{numInputChannels:this._inputChannels,bufferSize:t}}),this._workletNode.port.onmessage=(function(e){if(e.data.name==="buffers"){var n=[new Float32Array(e.data.leftBuffer),new Float32Array(e.data.rightBuffer)];this._callback(n)}}).bind(this),this._callback=function(){},this._workletNode.connect(p5.soundOut._silentNode),this.setInput(),s.soundArray.push(this)}return hr(i,[{key:"setInput",value:function(t){this.input.disconnect(),this.input=null,this.input=At.createGain(),this.input.connect(this._workletNode),this.input.connect(this.output),t?t.connect(this.input):p5.soundOut.output.connect(this.input)}},{key:"record",value:function(t,e,n){this._workletNode.port.postMessage({name:"start",duration:e}),t&&n?this._callback=function(a){t.setBuffer(a),n()}:t&&(this._callback=function(a){t.setBuffer(a)})}},{key:"stop",value:function(){this._workletNode.port.postMessage({name:"stop"})}},{key:"dispose",value:function(){var t=s.soundArray.indexOf(this);s.soundArray.splice(t,1),this._callback=function(){},this.input&&this.input.disconnect(),this.input=null,this._workletNode=null}}]),i}(),dr=fr;function Ot(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ot=function(t){return typeof t}:Ot=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ot(i)}function mr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function yr(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function vr(i,t,e){return yr(i.prototype,t),i}function gr(i,t){return t&&(Ot(t)==="object"||typeof t=="function")?t:_r(i)}function _r(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Ct(i,t,e){return typeof Reflect<"u"&&Reflect.get?Ct=Reflect.get:Ct=function(n,a,l){var d=br(n,a);if(d){var y=Object.getOwnPropertyDescriptor(d,a);return y.get?y.get.call(l):y.value}},Ct(i,t,e||i)}function br(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&(i=K(i),i!==null););return i}function K(i){return K=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},K(i)}function Tr(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Jt(i,t)}function Jt(i,t){return Jt=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},Jt(i,t)}function we(i){for(var t=typeof i=="number"?i:50,e=44100,n=new Float32Array(e),a=Math.PI/180,l=0,d;l<e;++l)d=l*2/e-1,n[l]=(3+t)*d*20*a/(Math.PI+t*Math.abs(d));return n}var wr=function(i){Tr(t,i);function t(e,n){var a;if(mr(this,t),a=gr(this,K(t).call(this)),typeof e>"u"&&(e=.25),typeof e!="number")throw new Error("amount must be a number");if(typeof n>"u"&&(n="2x"),typeof n!="string")throw new Error("oversample must be a String");var l=p5.prototype.map(e,0,1,0,2e3);return a.waveShaperNode=a.ac.createWaveShaper(),a.amount=l,a.waveShaperNode.curve=we(l),a.waveShaperNode.oversample=n,a.input.connect(a.waveShaperNode),a.waveShaperNode.connect(a.wet),a}return vr(t,[{key:"process",value:function(e,n,a){e.connect(this.input),this.set(n,a)}},{key:"set",value:function(e,n){if(e){var a=p5.prototype.map(e,0,1,0,2e3);this.amount=a,this.waveShaperNode.curve=we(a)}n&&(this.waveShaperNode.oversample=n)}},{key:"getAmount",value:function(){return this.amount}},{key:"getOversample",value:function(){return this.waveShaperNode.oversample}},{key:"dispose",value:function(){Ct(K(t.prototype),"dispose",this).call(this),this.waveShaperNode&&(this.waveShaperNode.disconnect(),this.waveShaperNode=null)}}]),t}(D),xr=wr;function Sr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function kr(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Pr(i,t,e){return kr(i.prototype,t),i}var Ar=function(){function i(){Sr(this,i),this.ac=s.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.output),s.soundArray.push(this)}return Pr(i,[{key:"setInput",value:function(t){t.connect(this.input)}},{key:"connect",value:function(t){var e=t||p5.soundOut.input;this.output.connect(e.input?e.input:e)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"amp",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=s.audiocontext.currentTime,l=this.output.gain.value;this.output.gain.cancelScheduledValues(a),this.output.gain.linearRampToValueAtTime(l,a+n),this.output.gain.linearRampToValueAtTime(t,a+n+e)}},{key:"dispose",value:function(){var t=s.soundArray.indexOf(this);s.soundArray.splice(t,1),this.output&&(this.output.disconnect(),delete this.output),this.input&&(this.input.disconnect(),delete this.input)}}]),i}(),Or=Ar;function Cr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Rr(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function qr(i,t,e){return Rr(i.prototype,t),i}var Er=function(){function i(){Cr(this,i),this.ac=s.audiocontext,this.output=this.ac.createGain(),this.connect(),s.soundArray.push(this)}return qr(i,[{key:"play",value:function(t,e,n,a){}},{key:"triggerAttack",value:function(t,e,n){}},{key:"triggerRelease",value:function(t){}},{key:"amp",value:function(t,e){}},{key:"connect",value:function(t){var e=t||s.input;this.output.connect(e.input?e.input:e)}},{key:"disconnect",value:function(){this.output.disconnect()}},{key:"dispose",value:function(){this.output&&(this.output.disconnect(),delete this.output)}}]),i}(),xe=Er;function Rt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Rt=function(t){return typeof t}:Rt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rt(i)}function Nr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function jr(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Br(i,t,e){return jr(i.prototype,t),i}function Mr(i,t){return t&&(Rt(t)==="object"||typeof t=="function")?t:Kt(i)}function Kt(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function qt(i,t,e){return typeof Reflect<"u"&&Reflect.get?qt=Reflect.get:qt=function(n,a,l){var d=Vr(n,a);if(d){var y=Object.getOwnPropertyDescriptor(d,a);return y.get?y.get.call(l):y.value}},qt(i,t,e||i)}function Vr(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&(i=tt(i),i!==null););return i}function tt(i){return tt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},tt(i)}function Fr(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),te(i,t)}function te(i,t){return te=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},te(i,t)}var Dr=.15,Ir=function(i){Fr(t,i);function t(){var e;return Nr(this,t),e=Mr(this,tt(t).call(this)),e.oscillator=new at,e.env=new ln,e.env.setRange(1,0),e.env.setExp(!0),e.setADSR(.02,.25,.05,.35),e.oscillator.disconnect(),e.oscillator.connect(e.output),e.env.disconnect(),e.env.setInput(e.output.gain),e.oscillator.output.gain.value=1,e.oscillator.start(),e.connect(),s.soundArray.push(Kt(e)),Object.defineProperties(Kt(e),{attack:{get:function(){return this.env.aTime},set:function(n){this.env.setADSR(n,this.env.dTime,this.env.sPercent,this.env.rTime)}},decay:{get:function(){return this.env.dTime},set:function(n){this.env.setADSR(this.env.aTime,n,this.env.sPercent,this.env.rTime)}},sustain:{get:function(){return this.env.sPercent},set:function(n){this.env.setADSR(this.env.aTime,this.env.dTime,n,this.env.rTime)}},release:{get:function(){return this.env.rTime},set:function(n){this.env.setADSR(this.env.aTime,this.env.dTime,this.env.sPercent,n)}}}),e}return Br(t,[{key:"play",value:function(e,n,a,l){this.triggerAttack(e,n,~~a),this.triggerRelease(~~a+(l||Dr))}},{key:"triggerAttack",value:function(e,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=S(e),d=n||.1;this.oscillator.freq(l,0,a),this.env.ramp(this.output.gain,a,d)}},{key:"triggerRelease",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.env.ramp(this.output.gain,e,0)}},{key:"setADSR",value:function(e,n,a,l){this.env.setADSR(e,n,a,l)}},{key:"amp",value:function(e,n){var a=n||0;return typeof e<"u"&&this.oscillator.amp(e,a),this.oscillator.amp().value}},{key:"connect",value:function(e){var n=e||s.input;this.output.connect(n.input?n.input:n)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"dispose",value:function(){qt(tt(t.prototype),"dispose",this).call(this),this.env&&this.env.dispose(),this.oscillator&&this.oscillator.dispose()}}]),t}(xe),Ur=Ir;function Gr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Lr(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function zr(i,t,e){return Lr(i.prototype,t),i}var Wr=function(){function i(t,e,n,a){Gr(this,i),this.isDetected=!1,this.freqLow=t,this.freqHigh=e,this.treshold=n,this.energy=0,this.penergy=0,this.sensitivity=500,this.callback=a}return zr(i,[{key:"update",value:function(t,e){if(this.energy=t.getEnergy(this.freqLow,this.freqHigh)/255,this.isDetected===!1&&this.energy-this.penergy>this.treshold){this.isDetected=!0,this.callback?this.callback(this.energy):e&&e(this.energy);var n=this;setTimeout(function(){n.isDetected=!1},this.sensitivity)}this.penergy=this.energy}}]),i}(),Zr=Wr;function Xr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Yr(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Hr(i,t,e){return Yr(i.prototype,t),i}var $r=function(){function i(t,e){Xr(this,i),this.audiovoices=[],this.notes={},this._newest=0,this._oldest=0,this.maxVoices=e||8,this.AudioVoice=t===void 0?p5.MonoSynth:t,this._voicesInUse=new Mt.a(0),this.output=s.audiocontext.createGain(),this.connect(),this._allocateVoices(),s.soundArray.push(this)}return Hr(i,[{key:"_allocateVoices",value:function(){for(var t=0;t<this.maxVoices;t++)this.audiovoices.push(new this.AudioVoice),this.audiovoices[t].disconnect(),this.audiovoices[t].connect(this.output)}},{key:"play",value:function(t,e,n){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;this.noteAttack(t,e,n),this.noteRelease(t,n+a)}},{key:"noteADSR",value:function(t,e,n,a,l){var d=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,y=s.audiocontext.currentTime,x=y+d;this.audiovoices[this.notes[t].getValueAtTime(x)].setADSR(e,n,a,l)}},{key:"setADSR",value:function(t,e,n,a){this.audiovoices.forEach(function(l){l.setADSR(t,e,n,a)})}},{key:"noteAttack",value:function(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=s.audiocontext.currentTime+n,l=S(t),d=e||.1,y;this.notes[l]&&this.notes[l].getValueAtTime(a)!==null&&this.noteRelease(l,0),this._voicesInUse.getValueAtTime(a)<this.maxVoices?y=Math.max(~~this._voicesInUse.getValueAtTime(a),0):(y=this._oldest,oldestNote=g(this.audiovoices[this._oldest].oscillator.freq().value),this.noteRelease(oldestNote),this._oldest=(this._oldest+1)%(this.maxVoices-1)),this.notes[l]=new Mt.a,this.notes[l].setValueAtTime(y,a);var x=this._voicesInUse._searchBefore(a)===null?0:this._voicesInUse._searchBefore(a).value;if(this._voicesInUse.setValueAtTime(x+1,a),this._updateAfter(a,1),this._newest=y,typeof d=="number"){var w=1/this._voicesInUse.getValueAtTime(a)*2;d=d>w?w:d}this.audiovoices[y].triggerAttack(l,d,n)}},{key:"_updateAfter",value:function(t,e){if(this._voicesInUse._searchAfter(t)!==null){this._voicesInUse._searchAfter(t).value+=e;var n=this._voicesInUse._searchAfter(t).time;this._updateAfter(n,e)}}},{key:"noteRelease",value:function(t,e){var n=s.audiocontext.currentTime,a=e||0,l=n+a;if(!t){this.audiovoices.forEach(function(w){w.triggerRelease(a)}),this._voicesInUse.setValueAtTime(0,l);for(var d in this.notes)this.notes[d].dispose(),delete this.notes[d];return}var y=S(t);if(!this.notes[y]||this.notes[y].getValueAtTime(l)===null)console.warn("Cannot release a note that is not already playing");else{var x=Math.max(~~this._voicesInUse.getValueAtTime(l).value,1);this._voicesInUse.setValueAtTime(x-1,l),x>0&&this._updateAfter(l,-1),this.audiovoices[this.notes[y].getValueAtTime(l)].triggerRelease(a),this.notes[y].dispose(),delete this.notes[y],this._newest=this._newest===0?0:(this._newest-1)%(this.maxVoices-1)}}},{key:"connect",value:function(t){var e=t||s.input;this.output.connect(e.input?e.input:e)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"dispose",value:function(){this.audiovoices.forEach(function(t){t.dispose()}),this.output&&(this.output.disconnect(),delete this.output)}}]),i}(),Qr=$r;function Jr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var Kr=function i(){Jr(this,i),console.warn("p5.Signal is deprecated , Use Tone.js Signal instead ")},to=Kr;p5.prototype.getAudioContext=v.b,p5.prototype.userStartAudio=v.c,p5.prototype.sampleRate=m,p5.prototype.freqToMidi=g,p5.prototype.midiToFreq=_,p5.prototype.noteToFreq=S,p5.prototype.soundFormats=k,p5.prototype.disposeSound=O,p5.prototype._checkFileFormats=P,p5.prototype._mathChain=R,p5.prototype.convertToWav=A,p5.prototype.interleave=j,p5.prototype.writeUTFBytes=q,p5.prototype.safeBufferSize=B,p5.prototype.saveSound=Se,p5.prototype.registerMethod("remove",p5.prototype.disposeSound),p5.Panner=Nt,p5.SoundFile=Fe,p5.prototype.loadSound=Ve,p5.prototype.registerPreloadMethod("loadSound",p5.prototype),p5.Amplitude=se,p5.FFT=Qe,p5.Oscillator=at,p5.SinOsc=on,p5.TriOsc=sn,p5.SawOsc=ae,p5.SqrOsc=an,p5.Noise=gn,p5.Pulse=On,p5.AudioIn=Nn,p5.Effect=D,p5.Filter=yt,p5.LowPass=zn,p5.HighPass=Wn,p5.BandPass=Zn,p5.EQ=ci,p5.listener3D=di,p5.Panner3D=xi,p5.Delay=Ei,p5.Reverb=me,p5.Convolver=ye,p5.prototype.createConvolver=Mi,p5.prototype.registerPreloadMethod("createConvolver",p5.prototype),p5.Metro=ge,p5.Phrase=$t,p5.Part=Li,p5.Score=zi,p5.SoundLoop=$i,p5.Compressor=or,p5.peakDetect=Te,p5.SoundRecorder=dr,p5.Distortion=xr,p5.Gain=Or,p5.AudioVoice=xe,p5.MonoSynth=Ur,p5.OnsetDetect=Zr,p5.PolySynth=Qr,p5.PeakDetect=Te,p5.Signal=to}])})();var ro=no(io);export{ro as default};
