<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.0">
<title>Falling Sand | Tronicart</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="../_observablehq/theme-parchment.d89d0dee.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="../_observablehq/theme-parchment.d89d0dee.css">
<link rel="modulepreload" href="../_observablehq/client.a725201a.js">
<link rel="modulepreload" href="../_observablehq/runtime.f168f711.js">
<link rel="modulepreload" href="../_observablehq/stdlib.0e911bb9.js">
<link rel="modulepreload" href="https://early.webawesome.com/webawesome@3.0.0-alpha.8/dist/webawesome.loader.js">
<link rel="modulepreload" href="../_import/components/sketch.96f782c4.js">
<link rel="modulepreload" href="../_import/lib/palette.79fe7a6d.js">
<link rel="modulepreload" href="../_import/components/p5.08228e06.js">
<link rel="modulepreload" href="../_import/lib/helpers.23012005.js">
<link rel="modulepreload" href="../_import/lib/dom.46cf68a8.js">
<link rel="modulepreload" href="../_node/color-scheme@1.0.1/index.e992fd29.js">
<link rel="modulepreload" href="../_node/p5@1.11.2/index.8e5b333a.js">

<meta name="description" content="Falling Sand">
<meta name="keywords" content="creative, code, art, github">
<meta name="author" content="Patrick Rabier">

<meta property="og:title" content="Falling Sand">
<meta property="og:type" content="article">
<meta property="og:url" content="/playgrounds/falling-sand">
<meta property="og:image" content="https://tronica.io/_file/data/static/og-thumb.png">
<meta name="twitter:card" content="Falling Sand">
<meta name="twitter:site" content="@tronicapps">
<meta name="twitter:creator" content="@tronicapps">

<link rel="icon" href="../_file/data/static/favicon-32x32.6f5dce35.png" sizes="32x32">
<link rel="icon" href="../_file/data/static/favicon-16x16.827eb093.png" sizes="16x16">
<link rel="apple-touch-icon" href="../_file/data/static/apple-touch-icon.045844fa.png">
<link rel="manifest" href="../_file/data/static/manifest.7a9e07ce.json">

<link rel="stylesheet" href="https://early.webawesome.com/webawesome@3.0.0-alpha.8/dist/styles/themes/default.css">
<script type="module" src="https://early.webawesome.com/webawesome@3.0.0-alpha.8/dist/webawesome.loader.js"></script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Falling Sand",
  "image": "https://tronica.io/_file/data/static/og-thumb.png,
  "keywords": "creative code art github",
  "publisher": "Tronica",
  "url": "https://tronica.io/playgrounds/falling-sand",
  "description": "Falling Sand",
  "author": {
    "@type": "Person",
    "name": "Patrick Rabier"
  }
}
</script>


<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-GCRE839L0Y"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GCRE839L0Y');
</script>
  

<script type="module">

import {define} from "../_observablehq/client.a725201a.js";

define({id: "9a4d11d3", outputs: ["sketch","Palette"], body: async () => {
const [{sketch}, {Palette}] = await Promise.all([import("../_import/components/sketch.96f782c4.js"), import("../_import/lib/palette.79fe7a6d.js")]);

return {sketch,Palette};
}});

define({id: "076a941f", outputs: ["tileSize","h","w","makeGrid","get","oob","set","empty"], body: () => {
const tileSize = 2
const h = 350
const w = 500
const makeGrid = (w, h, tileSize) => {
  const tileCountX = Math.floor(w / tileSize)
  const tileCountY = Math.floor(h / tileSize)
  const arr = new Array(tileCountX * tileCountY).fill(null)
  arr.w = Math.floor(w / tileSize)
  arr.h = Math.floor(h / tileSize)
  arr.tileSize = tileSize
  return arr
}

const get = (g, x, y) => g[y * g.w + x]
const oob = (g, x, y) => x < 0 || x >= g.w || y < 0 || y >= g.h
const set = (g, x, y, v) => {
  if (oob(g, x, y)) return false
  const idx = y * g.w + x
  if (!g[idx]) {
    g[idx] = v
    return true
  }
  return false
}
const empty = (g, x, y) => {
  if (oob(g, x, y)) return false
  return !g[y * g.w + x]
}
return {tileSize,h,w,makeGrid,get,oob,set,empty};
}});

define({id: "57617d90", inputs: ["sketch","makeGrid","w","h","tileSize","Palette","set","get","empty","display"], body: async (sketch,makeGrid,w,h,tileSize,Palette,set,get,empty,display) => {
display(await(
sketch((p5) => {
  let grid = makeGrid(w, h, tileSize)
  let nextGrid = makeGrid(w, h, tileSize)
  let tick = 0
  let source = null
  let framesPerPile = 50
  const palette = new Palette({ p5, scheme: "mono" })

  p5.setup = () => {
    p5.createCanvas(w, h)
    p5.noStroke()
    source = p5.createVector(
      p5.random(p5.width * 0.1, p5.width * 0.9),
      p5.height * 0.1,
    )
  }

  /**
   * Spawns particles at a given position.
   * @param {number} realX - The real X coordinate where particles will spawn.
   * @param {number} realY - The real Y coordinate where particles will spawn.
   */
  const spawn = (realX, realY) => {
    const x = Math.floor(realX / tileSize)
    const y = Math.floor(realY / tileSize)
    for (let i = 0; i < 10; i++) {
      const dx = Math.floor(p5.random(-3, 3))
      const dy = Math.floor(p5.random(-3, 3))
      set(grid, x + dx, y + dy, palette.lerped(100))
    }
  }

  p5.draw = () => {
    p5.background(255)

    // Switch source every `framesPerPile` frames
    if (++tick % framesPerPile === 0) {
      tick = 0

      source = p5.createVector(
        p5.random(p5.width * 0.1, p5.width * 0.9),
        p5.height * 0.1,
      )
    }

    if (source && p5.frameCount < 2500) {
      spawn(source.x, source.y)
    }

    // Compute the next version of the grid
    nextGrid = makeGrid(w, h, tileSize)
    for (let x = grid.w - 1; x >= 0; x--) {
      for (let y = grid.h - 1; y >= 0; y--) {
        const v = get(grid, x, y)

        if (v) {
          if (y === grid.h - 1) {
            set(nextGrid, x, y, v)
          } else if (empty(grid, x, y + 1)) {
            set(nextGrid, x, y + 1, v)
          } else if (empty(grid, x + 1, y + 1)) {
            set(nextGrid, x + 1, y + 1, v)
          } else if (empty(grid, x - 1, y + 1)) {
            set(nextGrid, x - 1, y + 1, v)
          } else {
            set(nextGrid, x, y, v)
          }
        }
      }
    }

    // Draw the sand particles
    for (let x = 0; x < grid.w; x++) {
      for (let y = 0; y < grid.h; y++) {
        const v = get(nextGrid, x, y)
        if (v) {
          p5.fill(v)
          p5.rect(x * tileSize, y * tileSize, tileSize, tileSize)
        }
      }
    }

    grid = nextGrid
  }
})
))
}});

</script>
</head>
<body>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="../">Tronicart</a></li>
  </ol>
  <div id="observablehq-search"><input type="search" placeholder="Search"></div>
  <div id="observablehq-search-results"></div>
  <script>{const o=document.querySelector("#observablehq-search");o.setAttribute("data-shortcut",`${/Mac|iPhone/.test(navigator.platform)?"\u2318":"Alt-"}K`);const t=o.querySelector("input"),r=()=>import("../_observablehq/search.59969b84.js");t.addEventListener("focus",r,{once:!0}),t.addEventListener("keydown",r,{once:!0});const c=document.querySelector("#observablehq-sidebar-toggle");addEventListener("keydown",e=>{(e.code==="KeyK"&&e.metaKey&&!e.altKey&&!e.ctrlKey||e.key==="/"&&!e.metaKey&&!e.altKey&&!e.ctrlKey&&e.target===document.body)&&(c.checked?t.focus():(c.click(),t.focus(),c.click()),t.select(),e.preventDefault())});}</script>
  <section>
    <summary>Experiments</summary>
    <ol>
    <li class="observablehq-link"><a href="../experiments/raytracing-wasm">Raytracing with Go and Wasm</a></li>
    <li class="observablehq-link"><a href="../experiments/three-body-problem">Three body problem</a></li>
    <li class="observablehq-link"><a href="../experiments/hand-drawn">Hand-drawn lines</a></li>
    <li class="observablehq-link"><a href="../experiments/bitwise-tiles">Bitwise creativity</a></li>
    </ol>
  </section>
  <details open>
    <summary>Creative algorithms</summary>
    <ol>
    <li class="observablehq-link"><a href="../algorithms/composition">Composable sketches</a></li>
    <li class="observablehq-link"><a href="../algorithms/differential-growth-basics">Differential growth</a></li>
    <li class="observablehq-link"><a href="../algorithms/orbital-mechanics">Orbital mechanics</a></li>
    </ol>
  </details>
  <details>
    <summary>Articles</summary>
    <ol>
    <li class="observablehq-link"><a href="../articles/state-management">An outlook on state management</a></li>
    <li class="observablehq-link"><a href="../articles/custom-react-hook">Custom React API hook</a></li>
    <li class="observablehq-link"><a href="../articles/observable-seo">Observable SEO</a></li>
    </ol>
  </details>
  <details open class="observablehq-section-active">
    <summary>Playgrounds</summary>
    <ol>
    <li class="observablehq-link observablehq-link-active"><a href="./falling-sand">Falling sand</a></li>
    <li class="observablehq-link"><a href="./triangles">Triangles</a></li>
    <li class="observablehq-link"><a href="./hexmesh/">Hexmesh</a></li>
    </ol>
  </details>
  <ol>
    <li class="observablehq-link"><a href="https://github.com/patrixr" target="_blank"><span>Github</span></a></li>
    <li class="observablehq-link"><a href="https://x.com/tronicapps" target="_blank"><span>Twitter</span></a></li>
    <li class="observablehq-link"><a href="https://objkt.com/users/tz1dQEFRNPdx2TXqfcprr1XCKdcUfir9geTP" target="_blank"><span>NFTs</span></a></li>
  </ol>
</nav>
<script>{const e=document.querySelector("#observablehq-sidebar"),o=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?o.checked=r==="true":o.indeterminate=!0;for(const t of document.querySelectorAll("#observablehq-sidebar summary")){const s=t.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${t.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
</nav>
</aside>
<main id="observablehq-main" class="observablehq">
<h1 id="falling-sand" tabindex="-1"><a class="observablehq-header-anchor" href="#falling-sand">Falling Sand</a></h1>
<p>Trying out a falling sand simulation in p5.js. This is a simple simulation where particles fall down and pile up. This is based on a Coding Train challenge by Daniel Shiffman.</p>
<div class="observablehq observablehq--block"><!--:9a4d11d3:--></div>
<div class="observablehq observablehq--block"><!--:076a941f:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:57617d90:--></div>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="../articles/observable-seo"><span>Observable SEO</span></a><a rel="next" href="./triangles"><span>Triangles</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2025-01-12T12:11:07">Jan 12, 2025</a>.</div>
</footer>
</div>
</body>
</html>
