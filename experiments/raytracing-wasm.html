<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.0">
<title>Raytracing using Go and WebAssembly | Tronicart</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="../_observablehq/theme-parchment.d89d0dee.css">
<link rel="preload" as="style" href="../_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="../_observablehq/theme-parchment.d89d0dee.css">
<link rel="stylesheet" type="text/css" href="../_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="modulepreload" href="../_observablehq/client.24f05b63.js">
<link rel="modulepreload" href="../_observablehq/runtime.f168f711.js">
<link rel="modulepreload" href="../_observablehq/stdlib.0e911bb9.js">
<link rel="modulepreload" href="https://early.webawesome.com/webawesome@3.0.0-alpha.8/dist/webawesome.loader.js">
<link rel="modulepreload" href="../_import/components/raytracing.eafe8cb7.js">
<link rel="modulepreload" href="../_import/components/canvas.f4db0867.js">
<link rel="modulepreload" href="../_observablehq/stdlib/mermaid.e4ef739c.js">
<link rel="modulepreload" href="../_observablehq/stdlib/inputs.36969e44.js">
<link rel="modulepreload" href="../_npm/htl@0.3.1/063eb405.js">
<link rel="modulepreload" href="../_npm/isoformat@0.2.1/c68fbd73.js">
<link rel="modulepreload" href="../_npm/mermaid@11.4.1/dist/mermaid.esm.min.mjs.aaab8952.js">

<meta name="description" content="Creative coding and art">
<meta name="keywords" content="creative, code, art, github">
<meta name="author" content="Patrick Rabier">

<meta property="og:title" content="Raytracing using Go and WebAssembly">
<meta property="og:type" content="article">
<meta property="og:url" content="/experiments/raytracing-wasm">
<meta property="og:image" content="https://tronica.io/_file/data/images/og-thumb.png">
<meta name="twitter:card" content="Creative coding and art">
<meta name="twitter:site" content="@tronicapps">
<meta name="twitter:creator" content="@tronicapps">

<link rel="stylesheet" href="https://early.webawesome.com/webawesome@3.0.0-alpha.8/dist/styles/themes/default.css">
<script type="module" src="https://early.webawesome.com/webawesome@3.0.0-alpha.8/dist/webawesome.loader.js"></script>


<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-GCRE839L0Y"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GCRE839L0Y');
</script>
  

<script type="module">

import {define} from "../_observablehq/client.24f05b63.js";
import {registerFile} from "../_observablehq/stdlib.0e911bb9.js";

registerFile("../data/rtconfig.json", {"name":"../data/rtconfig.json","mimeType":"application/json","path":"../_file/data/rtconfig.9833053a.json","lastModified":1736433162022,"size":964});

define({id: "4338bdb9", outputs: ["render","wasmScript","raytracerScript","canvas"], body: async () => {
const [{render, wasmScript, raytracerScript}, {canvas}] = await Promise.all([import("../_import/components/raytracing.eafe8cb7.js"), import("../_import/components/canvas.f4db0867.js")]);

return {render,wasmScript,raytracerScript,canvas};
}});

define({id: "8be527aa", outputs: ["mermaid"], body: async () => {
const {default: mermaid} = await import("../_observablehq/stdlib/mermaid.e4ef739c.js");

return {mermaid};
}});

define({id: "4eb883e2", inputs: ["mermaid","display"], body: async (mermaid,display) => {
display(await(
await mermaid`sequenceDiagram
    participant W as Browser (JS)
    participant B as Bridge (Go/Wasm)
    participant R as Engine (Go/Wasm)
    W->>B: Queued async <br> render request
    loop
        B->>R: Renders scene
        R-->>B: Image data
        B-->>W: Callback with <br>  byte array
    end
    Note over W: Browser`
))
}});

define({id: "0864e47b", mode: "inline", inputs: ["raytracerScript","display"], body: async (raytracerScript,display) => {
display(await(
raytracerScript()
))
}});

define({id: "884842c7", mode: "inline", inputs: ["wasmScript","display"], body: async (wasmScript,display) => {
display(await(
wasmScript()
))
}});

define({id: "4a5b3f8e", mode: "inline", inputs: ["canvas","display"], body: async (canvas,display) => {
display(await(
canvas(525, 295)
))
}});

define({id: "ff4116d1", inputs: ["view","Inputs","render","config"], outputs: ["renderButton"], body: (view,Inputs,render,config) => {
const renderButton = view(
  Inputs.button(
    [
      ["Low-res preview", () => render(config, "defaultCanvas0", true)],
      ["Full size", () => render(config, "defaultCanvas0")],
    ],
    { value: 0, label: "Render" },
  ),
)
return {renderButton};
}});

define({id: "ea9ec351", inputs: ["view","Inputs"], outputs: ["samples","size"], body: (view,Inputs) => {
const samples = view(Inputs.range([1, 500], { step: 1, label: "Samples" }))
const size = view(Inputs.range([300, 750], { step: 1, label: "Width" }))
return {samples,size};
}});

define({id: "d3db6065", inputs: ["FileAttachment","samples","size"], outputs: ["config"], body: async (FileAttachment,samples,size) => {
const config = await FileAttachment("../data/rtconfig.json").json()
config.antialiasing.samples = samples
config.size = size
return {config};
}});

define({id: "6ee4a877", inputs: ["display","config"], body: (display,config) => {
display(config)
}});

</script>
</head>
<body>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="../">Tronicart</a></li>
  </ol>
  <div id="observablehq-search"><input type="search" placeholder="Search"></div>
  <div id="observablehq-search-results"></div>
  <script>{const o=document.querySelector("#observablehq-search");o.setAttribute("data-shortcut",`${/Mac|iPhone/.test(navigator.platform)?"\u2318":"Alt-"}K`);const t=o.querySelector("input"),r=()=>import("../_observablehq/search.a1212c59.js");t.addEventListener("focus",r,{once:!0}),t.addEventListener("keydown",r,{once:!0});const c=document.querySelector("#observablehq-sidebar-toggle");addEventListener("keydown",e=>{(e.code==="KeyK"&&e.metaKey&&!e.altKey&&!e.ctrlKey||e.key==="/"&&!e.metaKey&&!e.altKey&&!e.ctrlKey&&e.target===document.body)&&(c.checked?t.focus():(c.click(),t.focus(),c.click()),t.select(),e.preventDefault())});}</script>
  <section class="observablehq-section-active">
    <summary>Experiments</summary>
    <ol>
    <li class="observablehq-link observablehq-link-active"><a href="./raytracing-wasm">Raytracing with Go and Wasm</a></li>
    <li class="observablehq-link"><a href="./three-body-problem">Three body problem</a></li>
    <li class="observablehq-link"><a href="./hand-drawn">Hand-drawn lines</a></li>
    <li class="observablehq-link"><a href="./bitwise-tiles">Bitwise creativity</a></li>
    </ol>
  </section>
  <details open>
    <summary>Creative algorithms</summary>
    <ol>
    <li class="observablehq-link"><a href="../algorithms/composition">Composable sketches</a></li>
    <li class="observablehq-link"><a href="../algorithms/differential-growth-basics">Differential growth</a></li>
    <li class="observablehq-link"><a href="../algorithms/orbital-mechanics">Orbital mechanics</a></li>
    </ol>
  </details>
  <details>
    <summary>Articles</summary>
    <ol>
    <li class="observablehq-link"><a href="../articles/state-management">An outlook on state management</a></li>
    <li class="observablehq-link"><a href="../articles/custom-react-hook">Custom React API hook</a></li>
    <li class="observablehq-link"><a href="../articles/observable-seo">Observable SEO</a></li>
    </ol>
  </details>
  <details>
    <summary>Playgrounds</summary>
    <ol>
    <li class="observablehq-link"><a href="../playgrounds/falling-sand">Falling sand</a></li>
    <li class="observablehq-link"><a href="../playgrounds/triangles">Triangles</a></li>
    <li class="observablehq-link"><a href="../playgrounds/hexmesh/">Hexmesh</a></li>
    </ol>
  </details>
  <ol>
    <li class="observablehq-link"><a href="https://github.com/patrixr" target="_blank"><span>Github</span></a></li>
    <li class="observablehq-link"><a href="https://x.com/tronicapps" target="_blank"><span>Twitter</span></a></li>
    <li class="observablehq-link"><a href="https://objkt.com/users/tz1dQEFRNPdx2TXqfcprr1XCKdcUfir9geTP" target="_blank"><span>NFTs</span></a></li>
  </ol>
</nav>
<script>{const e=document.querySelector("#observablehq-sidebar"),o=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?o.checked=r==="true":o.indeterminate=!0;for(const t of document.querySelectorAll("#observablehq-sidebar summary")){const s=t.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${t.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#the-setup">The setup</a></li>
<li class="observablehq-secondary-link"><a href="#limitations">Limitations</a></li>
<li class="observablehq-secondary-link"><a href="#try-it-out">Try it out</a></li>
<li class="observablehq-secondary-link"><a href="#configuration">Configuration</a></li>
</ol>
</nav>
</aside>
<main id="observablehq-main" class="observablehq">
<h1 id="raytracing-using-go-and-web-assembly" tabindex="-1"><a class="observablehq-header-anchor" href="#raytracing-using-go-and-web-assembly">Raytracing using Go and WebAssembly</a></h1>
<div class="observablehq observablehq--block"><!--:4338bdb9:--></div>
<div class="observablehq observablehq--block"><!--:8be527aa:--></div>
<p>This is an experiment in using Golang and WebAssembly to render a simple raytraced scene. The scene is rendered using a Go program that is compiled to WebAssembly and run in the browser.</p>
<p>The Go program is a simple raytracer based on the <a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html" target="_blank" rel="noopener noreferrer">Ray Tracing in One Weekend</a> book by Peter Shirley. The program defines a simple scene which is then piped to the browser using a <code>Uint8Array</code>. The browser then renders the scene using the <code>ImageData</code> API.</p>
<p><img src="../_file/data/images/rt-render-1.73846890.png" alt=""></p>
<h2 id="the-setup" tabindex="-1"><a class="observablehq-header-anchor" href="#the-setup">The setup</a></h2>
<p>This is a high-level overview of the different components involved:</p>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:4eb883e2:--></div>
<h2 id="limitations" tabindex="-1"><a class="observablehq-header-anchor" href="#limitations">Limitations</a></h2>
<p>I've discovered a main limitation with this approach: Goroutines are not supported in WebAssembly. This means that the Go program can't take advantage of parallelism to speed up the rendering process. Things still work fine but go routines will run sequentially instead of concurrently.</p>
<h2 id="try-it-out" tabindex="-1"><a class="observablehq-header-anchor" href="#try-it-out">Try it out</a></h2>
<p>Click on the controls located below the canvas to render the scene. The "Low-res preview" button will render a low-resolution version of the scene just to try it out, while the "Full size" button will render the scene at full resolution.</p>
<div class="warning" label="Warningï¸">
  Raytracing can be computationally expensive. Rendering the scene at full resolution with a high number of samples can take a while.
</div>
<p><observablehq-loading></observablehq-loading><!--:0864e47b:-->
<observablehq-loading></observablehq-loading><!--:884842c7:-->
<observablehq-loading></observablehq-loading><!--:4a5b3f8e:--></p>
<h2 id="configuration" tabindex="-1"><a class="observablehq-header-anchor" href="#configuration">Configuration</a></h2>
<div class="observablehq observablehq--block"><!--:ff4116d1:--></div>
<h3 id="config" tabindex="-1"><a class="observablehq-header-anchor" href="#config">Config</a></h3>
<div class="observablehq observablehq--block"><!--:ea9ec351:--></div>
<div class="observablehq observablehq--block"><!--:d3db6065:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:6ee4a877:--></div>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="../"><span>Tronicart</span></a><a rel="next" href="./three-body-problem"><span>Three body problem</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2025-01-09T14:32:55">Jan 9, 2025</a>.</div>
</footer>
</div>
</body>
</html>
